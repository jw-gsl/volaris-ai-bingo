<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aha Moment Bingo - CSI Revenue Signals Accelerator</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ===== CSS Custom Properties ===== */
        :root {
            --navy: #0B2340;
            --lime: #BFD731;
            --teal: #008AB0;
            --dark-gray: #464646;
            --off-white: #FAF9F6;
            --white: #ffffff;
            --amber: #F59E0B;
            --bg: var(--off-white);
            --card-bg: var(--white);
            --text: var(--dark-gray);
            --heading: var(--navy);
            --cell-bg: var(--white);
            --cell-border: var(--navy);
            --cell-text: var(--navy);
            --marked-bg: var(--lime);
            --marked-text: var(--navy);
            --free-bg: var(--lime);
            --overlay-bg: rgba(11, 35, 64, 0.92);
            --shadow: rgba(11, 35, 64, 0.12);
            --shadow-strong: rgba(11, 35, 64, 0.25);
            --toast-bg: var(--navy);
            --toast-text: var(--white);
            --toggle-bg: #d1d5db;
            --toggle-active: var(--teal);
            --footer-bg: rgba(11, 35, 64, 0.06);
            --footer-text: var(--dark-gray);
            --insight-bg: var(--navy);
            --insight-text: var(--white);
            --bingo-row-glow: rgba(191, 215, 49, 0.5);
            --track-leadership: #F59E0B;
            --track-product: #008AB0;
            --track-rnd: #BFD731;
            --track-general: #9CA3AF;
        }

        [data-theme="dark"] {
            --bg: #0f1729;
            --card-bg: #1a2744;
            --text: #d1d5db;
            --heading: var(--off-white);
            --cell-bg: #1e2d4a;
            --cell-border: #2a3f66;
            --cell-text: var(--off-white);
            --marked-bg: #4a6b0a;
            --marked-text: var(--off-white);
            --free-bg: #4a6b0a;
            --overlay-bg: rgba(15, 23, 41, 0.95);
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-strong: rgba(0, 0, 0, 0.5);
            --toast-bg: var(--lime);
            --toast-text: var(--navy);
            --toggle-bg: #374151;
            --footer-bg: rgba(255, 255, 255, 0.05);
            --footer-text: #9ca3af;
            --insight-bg: #0d1b30;
            --insight-text: var(--off-white);
            --bingo-row-glow: rgba(191, 215, 49, 0.3);
        }

        /* ===== Reset & Base ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Barlow', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }

        /* Denver mountain range - dramatic layered background */
        body::before {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100vh;
            background:
                /* Stars in sky (dark mode enhanced) */
                radial-gradient(1px 1px at 10% 15%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 25% 8%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1.5px 1.5px at 40% 20%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 55% 12%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 70% 5%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1.5px 1.5px at 85% 18%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 15% 25%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 62% 22%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 92% 10%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1.5px 1.5px at 48% 3%, var(--star-color) 50%, transparent 100%),
                /* Sky gradient */
                var(--sky-gradient);
            pointer-events: none;
            z-index: 0;
        }

        /* Mountain SVG layer - sits on top of sky */
        body::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 45vh;
            background: var(--mountain-scene);
            background-size: 100% auto;
            background-repeat: no-repeat;
            background-position: bottom center;
            pointer-events: none;
            z-index: 0;
        }

        :root {
            --star-color: transparent;
            --sky-gradient: linear-gradient(180deg, transparent 0%, rgba(11, 35, 64, 0.02) 60%, rgba(11, 35, 64, 0.06) 100%);
            --mountain-scene: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 80' preserveAspectRatio='xMidYMax meet'%3E%3Cpath d='M0,80 L0,42 L40,48 L80,28 L110,38 L150,18 L180,32 L210,12 L250,30 L280,22 L310,35 L340,15 L380,28 L420,10 L460,25 L500,18 L540,32 L570,24 L600,30 L600,80Z' fill='%230B2340' opacity='0.07'/%3E%3Cpath d='M0,80 L0,52 L50,48 L100,36 L140,44 L190,28 L230,40 L270,24 L310,38 L360,30 L400,42 L440,28 L480,38 L530,32 L580,40 L600,36 L600,80Z' fill='%230B2340' opacity='0.12'/%3E%3Cpath d='M0,80 L0,60 L60,56 L120,62 L180,54 L240,58 L300,52 L360,58 L420,54 L480,60 L540,56 L600,58 L600,80Z' fill='%230B2340' opacity='0.18'/%3E%3Cpath d='M205,14 L210,12 L216,17 L210,15Z' fill='white' opacity='0.6'/%3E%3Cpath d='M207,16 L210,12 L220,20 L212,18Z' fill='white' opacity='0.25'/%3E%3Cpath d='M415,12 L420,10 L426,16 L420,13Z' fill='white' opacity='0.6'/%3E%3Cpath d='M417,14 L420,10 L428,18 L422,16Z' fill='white' opacity='0.25'/%3E%3Cpath d='M145,20 L150,18 L156,24 L150,21Z' fill='white' opacity='0.55'/%3E%3Cpath d='M147,22 L150,18 L158,26 L152,23Z' fill='white' opacity='0.2'/%3E%3Cpath d='M335,17 L340,15 L346,21 L340,18Z' fill='white' opacity='0.55'/%3E%3Cpath d='M337,19 L340,15 L348,23 L342,20Z' fill='white' opacity='0.2'/%3E%3Cpath d='M75,30 L80,28 L86,34 L80,31Z' fill='white' opacity='0.5'/%3E%3Cpath d='M77,32 L80,28 L88,36 L82,33Z' fill='white' opacity='0.18'/%3E%3Cpath d='M495,20 L500,18 L506,24 L500,21Z' fill='white' opacity='0.5'/%3E%3Cpath d='M497,22 L500,18 L508,26 L502,23Z' fill='white' opacity='0.18'/%3E%3Cpath d='M268,23 L272,21 L276,25Z' fill='white' opacity='0.35'/%3E%3Cpath d='M108,39 L112,37 L116,41Z' fill='white' opacity='0.3'/%3E%3Cpath d='M538,33 L542,31 L546,35Z' fill='white' opacity='0.3'/%3E%3C/svg%3E");
        }

        [data-theme="dark"] {
            --star-color: rgba(255, 255, 255, 0.5);
            --sky-gradient: linear-gradient(180deg, transparent 0%, transparent 40%, rgba(15, 25, 50, 0.2) 65%, rgba(20, 35, 65, 0.4) 85%, rgba(15, 23, 41, 0.6) 100%);
            --mountain-scene: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 80' preserveAspectRatio='xMidYMax meet'%3E%3Cpath d='M0,80 L0,42 L40,48 L80,28 L110,38 L150,18 L180,32 L210,12 L250,30 L280,22 L310,35 L340,15 L380,28 L420,10 L460,25 L500,18 L540,32 L570,24 L600,30 L600,80Z' fill='%238ba4c4' opacity='0.2'/%3E%3Cpath d='M0,80 L0,52 L50,48 L100,36 L140,44 L190,28 L230,40 L270,24 L310,38 L360,30 L400,42 L440,28 L480,38 L530,32 L580,40 L600,36 L600,80Z' fill='%236b8ab0' opacity='0.3'/%3E%3Cpath d='M0,80 L0,60 L60,56 L120,62 L180,54 L240,58 L300,52 L360,58 L420,54 L480,60 L540,56 L600,58 L600,80Z' fill='%234a6e96' opacity='0.35'/%3E%3Cpath d='M205,14 L210,12 L216,17 L210,15Z' fill='%23E8F0FF' opacity='0.85'/%3E%3Cpath d='M207,16 L210,12 L220,20 L212,18Z' fill='%23E8F0FF' opacity='0.35'/%3E%3Cpath d='M415,12 L420,10 L426,16 L420,13Z' fill='%23E8F0FF' opacity='0.85'/%3E%3Cpath d='M417,14 L420,10 L428,18 L422,16Z' fill='%23E8F0FF' opacity='0.35'/%3E%3Cpath d='M145,20 L150,18 L156,24 L150,21Z' fill='%23E8F0FF' opacity='0.85'/%3E%3Cpath d='M147,22 L150,18 L158,26 L152,23Z' fill='%23E8F0FF' opacity='0.3'/%3E%3Cpath d='M335,17 L340,15 L346,21 L340,18Z' fill='%23E8F0FF' opacity='0.85'/%3E%3Cpath d='M337,19 L340,15 L348,23 L342,20Z' fill='%23E8F0FF' opacity='0.3'/%3E%3Cpath d='M75,30 L80,28 L86,34 L80,31Z' fill='%23E8F0FF' opacity='0.85'/%3E%3Cpath d='M77,32 L80,28 L88,36 L82,33Z' fill='%23E8F0FF' opacity='0.25'/%3E%3Cpath d='M495,20 L500,18 L506,24 L500,21Z' fill='%23E8F0FF' opacity='0.85'/%3E%3Cpath d='M497,22 L500,18 L508,26 L502,23Z' fill='%23E8F0FF' opacity='0.25'/%3E%3Cpath d='M268,23 L272,21 L276,25Z' fill='%23E8F0FF' opacity='0.5'/%3E%3Cpath d='M108,39 L112,37 L116,41Z' fill='%23E8F0FF' opacity='0.45'/%3E%3Cpath d='M538,33 L542,31 L546,35Z' fill='%23E8F0FF' opacity='0.45'/%3E%3C/svg%3E");
        }

        /* ===== Layout ===== */
        .container {
            max-width: 820px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ===== Header ===== */
        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-area {
            margin-bottom: 12px;
        }

        .logo-area img {
            height: 40px;
            width: auto;
            transition: filter 0.3s;
        }

        [data-theme="dark"] .logo-area img {
            filter: brightness(0) invert(1);
        }

        .logo-subtitle {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 4px;
        }

        .title {
            font-weight: 900;
            font-size: clamp(1.6rem, 5vw, 2.4rem);
            color: var(--heading);
            line-height: 1.1;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }

        .title .bulb {
            display: inline-block;
            animation: bulbPulse 2s ease-in-out infinite;
        }

        @keyframes bulbPulse {
            0%, 100% { filter: drop-shadow(0 0 4px rgba(245,158,11,0.4)); }
            50% { filter: drop-shadow(0 0 12px rgba(245,158,11,0.8)); transform: scale(1.1); }
        }

        .tagline {
            font-size: 0.85rem;
            color: var(--text);
            opacity: 0.8;
            font-style: italic;
        }

        .event-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 8px;
            font-size: 0.72rem;
            font-weight: 600;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .event-info span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Denver mountain header decoration */
        .mountain-header {
            width: 100vw;
            margin-left: calc(-50vw + 50%);
            margin-bottom: 20px;
            display: block;
            line-height: 0;
        }

        .mountain-header svg {
            width: 100%;
            height: auto;
            display: block;
        }

        [data-theme="dark"] .mountain-header .mtn-far {
            fill: #8ba4c4;
            opacity: 0.2;
        }

        [data-theme="dark"] .mountain-header .mtn-mid {
            fill: #6b8ab0;
            opacity: 0.3;
        }

        [data-theme="dark"] .mountain-header .mtn-near {
            fill: #4a6e96;
            opacity: 0.35;
        }

        [data-theme="dark"] .mountain-header svg path[fill="white"] {
            opacity: 0.85;
        }

        /* ===== Track Filter ===== */
        .track-filter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .track-btn {
            font-family: 'Barlow', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 5px 12px;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            background: var(--cell-bg);
            color: var(--text);
        }

        .track-btn:hover { transform: scale(1.05); }
        .track-btn:active { transform: scale(0.96); }

        .track-btn.active {
            color: var(--navy);
            font-weight: 800;
        }

        .track-btn[data-track="all"].active { background: var(--off-white); border-color: var(--navy); color: var(--navy); }
        .track-btn[data-track="leadership"].active { background: var(--track-leadership); border-color: var(--track-leadership); }
        .track-btn[data-track="product"].active { background: var(--track-product); border-color: var(--track-product); color: var(--white); }
        .track-btn[data-track="rnd"].active { background: var(--track-rnd); border-color: var(--track-rnd); }

        [data-theme="dark"] .track-btn[data-track="all"].active { background: var(--cell-bg); border-color: var(--off-white); color: var(--off-white); }

        /* ===== Controls Bar ===== */
        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 12px;
            font-size: 0.8rem;
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toggle-label {
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--text);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
        }

        .toggle-label.active {
            opacity: 1;
            color: var(--teal);
        }

        .toggle-switch {
            position: relative;
            width: 36px;
            height: 20px;
            cursor: pointer;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--toggle-bg);
            border-radius: 20px;
            transition: background 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            left: 2px;
            bottom: 2px;
            background: var(--white);
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--toggle-active);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(16px);
        }

        /* ===== Card Info Bar ===== */
        .card-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 0 2px;
        }

        .card-id {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text);
            opacity: 0.5;
            font-family: monospace;
        }

        .score {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--teal);
        }

        /* ===== Day indicator ===== */
        .day-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 14px;
        }

        .day-dot {
            padding: 6px 14px;
            border-radius: 20px;
            border: 2px solid var(--cell-border);
            background: var(--cell-bg);
            font-family: 'Barlow', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--cell-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.5;
            position: relative;
            overflow: hidden;
        }

        .day-dot:hover { transform: scale(1.05); opacity: 0.8; }
        .day-dot.active {
            background: var(--teal);
            border-color: var(--teal);
            color: var(--white);
            opacity: 1;
        }

        .day-dot.completed {
            background: var(--lime);
            border-color: var(--lime);
            color: var(--navy);
            opacity: 1;
        }

        /* Progress bar on day pills */
        .day-dot::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: calc(var(--day-progress, 0) * 1%);
            background: var(--lime);
            transition: width 0.3s ease;
            border-radius: 0 0 20px 20px;
        }
        .day-dot.active::after {
            background: rgba(255,255,255,0.6);
        }

        .day-journal-btn {
            margin-left: 8px;
            padding: 6px 14px !important;
            font-size: 0.75rem !important;
            border-radius: 20px !important;
        }

        /* ===== Welcome Overlay ===== */
        .welcome-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: var(--bg);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .welcome-overlay.show { display: flex; }
        .welcome-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px 32px;
            max-width: 440px;
            width: 100%;
            box-shadow: 0 8px 40px var(--shadow-strong);
            text-align: center;
        }
        .welcome-logo { margin-bottom: 16px; }
        .welcome-logo img { height: 36px; width: auto; }
        [data-theme="dark"] .welcome-logo img { filter: brightness(0) invert(1); }
        .welcome-title {
            font-weight: 900;
            font-size: 1.8rem;
            color: var(--heading);
            margin-bottom: 4px;
        }
        .welcome-subtitle {
            font-size: 0.85rem;
            color: var(--teal);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
        }
        .welcome-desc {
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 24px;
            opacity: 0.8;
        }
        .welcome-field {
            text-align: left;
            margin-bottom: 14px;
        }
        .welcome-field label {
            display: block;
            font-size: 0.78rem;
            font-weight: 700;
            color: var(--heading);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .welcome-field input,
        .welcome-field select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--cell-border);
            border-radius: 10px;
            background: var(--cell-bg);
            color: var(--cell-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        .welcome-field input:focus,
        .welcome-field select:focus {
            outline: none;
            border-color: var(--teal);
        }
        .welcome-submit {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border: none;
            border-radius: 12px;
            background: var(--teal);
            color: var(--white);
            font-family: 'Barlow', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .welcome-submit:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(0,138,176,0.4);
        }

        /* User greeting near card info */
        .user-greeting {
            font-size: 0.78rem;
            color: var(--text);
            opacity: 0.7;
        }
        .user-greeting a {
            color: var(--teal);
            text-decoration: none;
            cursor: pointer;
            font-weight: 600;
        }
        .user-greeting a:hover { text-decoration: underline; }

        /* ===== Bingo Card ===== */
        .bingo-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 24px var(--shadow), 0 1px 4px var(--shadow);
            transition: background 0.3s ease;
        }

        /* Card + Side Panel layout */
        .card-layout {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            transition: max-width 0.4s ease;
        }

        .card-layout .bingo-card {
            flex: 1 1 auto;
            min-width: 0;
            transition: flex 0.4s ease;
        }

        .side-panel {
            display: none;
            flex: 0 0 340px;
            background: var(--insight-bg);
            border-radius: 16px;
            padding: 24px 20px;
            border: 1px solid rgba(191, 215, 49, 0.2);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: slideInRight 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            max-height: 80vh;
            overflow-y: auto;
        }

        .side-panel.show {
            display: block;
        }

        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(40px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .side-panel-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: var(--insight-text);
            font-size: 1.4rem;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
            line-height: 1;
        }

        .side-panel-close:hover { opacity: 1; }

        .side-panel .insight-track-badge {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 3px 12px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .side-panel-aha {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            opacity: 0.8;
            line-height: 1.3;
        }

        .side-panel-insight {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--insight-text);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .side-panel-source {
            font-size: 0.7rem;
            color: var(--teal);
            font-style: italic;
            margin-bottom: 14px;
        }

        .side-panel-journal {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .side-panel-journal textarea {
            width: 100%;
            min-height: 100px;
            border-radius: 8px;
            border: 1px solid rgba(191, 215, 49, 0.3);
            background: rgba(255, 255, 255, 0.06);
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            padding: 10px;
            resize: vertical;
        }

        .side-panel-journal textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .side-panel-journal textarea:focus {
            outline: 2px solid var(--lime);
            outline-offset: 1px;
        }

        .side-panel-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 12px;
        }

        .side-panel-saved {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--lime);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .side-panel-saved.show { opacity: 1; }

        .side-panel-gotit {
            background: var(--lime);
            color: var(--navy);
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-family: 'Barlow', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.15s;
        }

        .side-panel-gotit:hover { transform: scale(1.05); }

        .side-panel-share {
            background: rgba(255,255,255,0.1);
            color: var(--insight-text);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .side-panel-share:hover { opacity: 0.8; }

        /* When side panel is open, widen the container */
        .container.panel-open {
            max-width: 1200px;
        }

        /* On small screens, stack vertically */
        @media (max-width: 900px) {
            .card-layout {
                flex-direction: column;
            }
            .side-panel {
                flex: none;
                width: 100%;
                max-height: none;
            }
            .container.panel-open {
                max-width: 820px;
            }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        /* ===== Bingo Cell ===== */
        .cell {
            aspect-ratio: 1 / 1.15;
            border: 2px solid var(--cell-border);
            border-radius: 8px;
            background: var(--cell-bg);
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 6px;
            text-align: center;
            transition: transform 0.15s ease, background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            user-select: none;
            outline: none;
        }

        .cell:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .cell:active {
            transform: scale(0.97);
        }

        .cell:focus-visible {
            outline: 3px solid var(--teal);
            outline-offset: 2px;
        }

        .cell .aha-text {
            font-size: clamp(0.58rem, 1.7vw, 0.88rem);
            font-weight: 600;
            color: var(--cell-text);
            line-height: 1.25;
            z-index: 2;
            transition: opacity 0.3s ease;
            word-break: break-word;
            hyphens: auto;
        }

        /* Track indicator dot */
        .cell .track-dot {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 3;
            opacity: 0.7;
        }

        .cell.marked .track-dot { opacity: 0.5; }

        /* Marked state */
        .cell.marked {
            background: var(--marked-bg);
            border-color: var(--marked-bg);
        }

        .cell.marked .aha-text {
            color: var(--marked-text);
        }

        .cell.marked .bulb-icon {
            opacity: 1;
        }

        /* Bulb stamp animation */
        .cell.stamp-animate {
            animation: stampPop 0.35s ease;
        }

        @keyframes stampPop {
            0% { transform: scale(1); }
            30% { transform: scale(0.88); }
            60% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .bulb-icon {
            position: absolute;
            top: 2px;
            right: 3px;
            width: 16px;
            height: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 3;
            font-size: 12px;
            line-height: 1;
        }

        /* Info button */
        .info-btn {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: none;
            background: var(--teal);
            color: var(--white);
            font-family: 'Barlow', sans-serif;
            font-size: 0.6rem;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.5;
            transition: opacity 0.2s, transform 0.15s;
            z-index: 5;
            padding: 0;
            line-height: 1;
        }

        .info-btn:hover, .info-btn:focus-visible {
            opacity: 1;
            transform: scale(1.15);
        }

        .cell.marked .info-btn {
            background: var(--navy);
            color: var(--white);
            opacity: 0.6;
        }

        .cell.marked .info-btn:hover {
            opacity: 1;
        }

        /* Free space */
        .cell.free-space {
            background: var(--free-bg);
            border-color: var(--free-bg);
        }

        .cell.free-space .aha-text {
            font-weight: 800;
            color: var(--navy);
        }

        [data-theme="dark"] .cell.free-space .aha-text {
            color: var(--off-white);
        }

        .cell.free-space .info-btn {
            display: none;
        }

        .cell.free-space .track-dot {
            display: none;
        }

        /* Bingo row highlight */
        .cell.bingo-cell {
            box-shadow: 0 0 12px var(--bingo-row-glow), 0 0 24px var(--bingo-row-glow);
            animation: bingoGlow 1.5s ease-in-out infinite alternate;
        }

        @keyframes bingoGlow {
            from { box-shadow: 0 0 8px var(--bingo-row-glow); }
            to { box-shadow: 0 0 20px var(--bingo-row-glow), 0 0 40px var(--bingo-row-glow); }
        }

        /* ===== In-Grid Expanded Cell ===== */
        .cell-expanded {
            grid-column: 1 / -1;
            background: var(--insight-bg);
            border-radius: 12px;
            padding: 24px 20px;
            text-align: center;
            border: 2px solid rgba(191, 215, 49, 0.25);
            animation: gridExpand 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        @keyframes gridExpand {
            0% { opacity: 0; transform: scaleY(0.3); max-height: 0; }
            60% { opacity: 1; }
            100% { transform: scaleY(1); max-height: 600px; }
        }

        .cell-expanded .expanded-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: var(--insight-text);
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .cell-expanded .expanded-close:hover { opacity: 1; }

        .cell-expanded .insight-track-badge {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 3px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .cell-expanded .expanded-aha {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .cell-expanded .expanded-insight {
            font-size: 1rem;
            font-weight: 500;
            color: var(--insight-text);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .cell-expanded .expanded-source {
            font-size: 0.7rem;
            color: var(--teal);
            font-style: italic;
            margin-bottom: 12px;
        }

        .cell-expanded .expanded-journal {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .cell-expanded .expanded-journal textarea {
            width: 100%;
            min-height: 70px;
            border-radius: 8px;
            border: 1px solid rgba(191, 215, 49, 0.3);
            background: rgba(255, 255, 255, 0.06);
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            padding: 10px;
            resize: vertical;
        }

        .cell-expanded .expanded-journal textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .cell-expanded .expanded-journal textarea:focus {
            outline: 2px solid var(--lime);
            outline-offset: 1px;
        }

        .cell-expanded .expanded-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .cell-expanded .expanded-gotit {
            background: var(--lime);
            color: var(--navy);
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-family: 'Barlow', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.15s, background 0.2s;
        }

        .cell-expanded .expanded-gotit:hover { transform: scale(1.05); }

        .cell-expanded .expanded-saved {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--lime);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .cell-expanded .expanded-saved.show { opacity: 1; }

        /* Legacy overlay - keep for info button click */
        .insight-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .insight-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .insight-card {
            background: var(--insight-bg);
            border-radius: 16px;
            padding: 28px 24px;
            max-width: 480px;
            width: 100%;
            text-align: center;
            position: relative;
            border: 1px solid rgba(191, 215, 49, 0.15);
        }

        .journal-bonus-hint {
            background: rgba(191, 215, 49, 0.12);
            border: 1px dashed rgba(191, 215, 49, 0.4);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--lime);
            text-align: center;
        }

        .journal-bonus-hint .bonus-amount {
            font-family: monospace;
            font-size: 0.85rem;
            font-weight: 800;
        }

        .journal-char-count {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--teal);
            text-align: right;
            margin-top: 4px;
            opacity: 0.8;
            transition: color 0.3s;
        }

        .journal-char-count.multiplier-2x { color: #BFD731; }
        .journal-char-count.multiplier-3x { color: #F59E0B; }
        .journal-char-count.multiplier-5x { color: #EF4444; font-weight: 800; }

        .insight-track-badge {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 3px 12px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .insight-aha {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            opacity: 0.8;
        }

        .insight-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--insight-text);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .insight-source {
            font-size: 0.75rem;
            color: var(--insight-text);
            opacity: 0.5;
            font-style: italic;
            margin-bottom: 20px;
        }

        .insight-close {
            background: var(--lime);
            color: var(--navy);
            border: none;
            padding: 10px 28px;
            border-radius: 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .insight-close:hover {
            opacity: 0.85;
        }

        /* ===== Journal Note in Insight Modal ===== */
        .journal-section {
            margin-top: 16px;
            margin-bottom: 16px;
            text-align: left;
        }

        .journal-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--lime);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .journal-textarea {
            width: 100%;
            min-height: 60px;
            background: rgba(255,255,255,0.08);
            border: 1.5px solid rgba(191, 215, 49, 0.3);
            border-radius: 8px;
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            padding: 10px;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }

        .journal-textarea:focus {
            border-color: var(--lime);
        }

        .journal-textarea::placeholder {
            color: rgba(255,255,255,0.3);
            font-style: italic;
        }

        .journal-saved {
            font-size: 0.65rem;
            color: var(--lime);
            opacity: 0;
            transition: opacity 0.3s;
            margin-top: 4px;
        }

        .journal-saved.show {
            opacity: 0.7;
        }

        /* ===== Token Counter ===== */
        .token-counter {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--amber);
        }

        .token-counter .token-icon {
            font-size: 1rem;
        }

        .token-count {
            font-family: monospace;
            font-size: 0.9rem;
        }

        /* ===== Journal Export Button ===== */
        .btn-journal {
            background: var(--amber);
            color: var(--navy);
        }

        /* ===== Journal View Overlay ===== */
        .journal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 150;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            animation: fadeIn 0.2s ease;
        }

        .journal-overlay.show {
            display: flex;
        }

        .journal-view {
            background: var(--insight-bg);
            border-radius: 16px;
            padding: 32px;
            max-width: 560px;
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
            animation: slideUp 0.3s ease;
        }

        .journal-view h2 {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--lime);
            margin-bottom: 4px;
            text-align: center;
        }

        .journal-view .journal-subtitle {
            font-size: 0.75rem;
            color: var(--insight-text);
            opacity: 0.5;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Journal stats banner */
        .journal-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .journal-stat {
            text-align: center;
            background: rgba(255,255,255,0.06);
            border-radius: 10px;
            padding: 12px 6px;
        }
        .journal-stat-value {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--lime);
        }
        .journal-stat-label {
            font-size: 0.62rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--insight-text);
            opacity: 0.5;
            margin-top: 2px;
        }

        /* Journal day sections */
        .journal-day-section {
            margin-bottom: 16px;
        }
        .journal-day-header {
            font-size: 0.78rem;
            font-weight: 800;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 8px;
        }

        .journal-entry {
            border-bottom: 1px solid rgba(255,255,255,0.06);
            padding: 12px 0;
            position: relative;
        }

        .journal-entry:last-child {
            border-bottom: none;
        }

        .journal-entry-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .journal-entry-aha {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--lime);
            flex: 1;
        }

        .journal-entry-time {
            font-size: 0.65rem;
            color: var(--insight-text);
            opacity: 0.4;
            white-space: nowrap;
        }

        .journal-entry-track {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 2px 8px;
            border-radius: 8px;
            margin-bottom: 6px;
        }

        .journal-entry-note {
            font-size: 0.9rem;
            color: var(--insight-text);
            line-height: 1.5;
            opacity: 0.9;
        }

        /* Inline edit textarea */
        .journal-entry-edit {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--teal);
            border-radius: 8px;
            background: rgba(255,255,255,0.06);
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.88rem;
            resize: vertical;
            min-height: 60px;
        }
        .journal-entry-edit:focus { outline: none; border-color: var(--lime); }

        /* Entry action buttons */
        .journal-entry-actions {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }
        .journal-entry-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.78rem;
            padding: 2px 6px;
            border-radius: 4px;
            opacity: 0.5;
            transition: opacity 0.15s;
            color: var(--insight-text);
        }
        .journal-entry-actions button:hover { opacity: 1; }
        .journal-entry-actions .je-delete:hover { color: #EF4444; }

        .journal-empty {
            text-align: center;
            color: var(--insight-text);
            opacity: 0.4;
            font-style: italic;
            padding: 32px 0;
        }

        .journal-footer {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .journal-close, .journal-export {
            background: var(--lime);
            color: var(--navy);
            border: none;
            padding: 10px 28px;
            border-radius: 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .journal-export {
            background: rgba(255,255,255,0.1);
            color: var(--insight-text);
        }

        .journal-close:hover, .journal-export:hover {
            opacity: 0.85;
        }

        /* ===== Action Buttons ===== */
        .actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .btn {
            font-family: 'Barlow', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s ease, opacity 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover { opacity: 0.88; }
        .btn:active { transform: scale(0.96); }

        .btn-primary {
            background: var(--teal);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--navy);
            color: var(--white);
        }

        .btn-accent {
            background: var(--lime);
            color: var(--navy);
        }

        /* ===== BINGO Celebration Overlay ===== */
        .bingo-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 200;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
            animation: fadeIn 0.3s ease;
        }

        .bingo-overlay.show {
            display: flex;
        }

        .bingo-title {
            font-size: clamp(3rem, 12vw, 6rem);
            font-weight: 900;
            color: var(--lime);
            letter-spacing: 4px;
            text-shadow: 0 4px 20px rgba(191, 215, 49, 0.4);
            animation: bingoPop 0.6s ease;
            text-align: center;
            line-height: 1.1;
        }

        .bingo-subtitle {
            font-size: 1.1rem;
            color: var(--off-white);
            opacity: 0.8;
            text-align: center;
            max-width: 400px;
            padding: 0 20px;
        }

        .bingo-overlay .btn {
            margin-top: 8px;
        }

        @keyframes bingoPop {
            0% { transform: scale(0.3); opacity: 0; }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ===== Confetti Canvas ===== */
        #confettiCanvas {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 210;
        }

        /* ===== Toast ===== */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: var(--toast-bg);
            color: var(--toast-text);
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 300;
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            pointer-events: none;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ===== Footer / Attribution ===== */
        .footer {
            margin-top: 24px;
            padding: 16px;
            background: var(--footer-bg);
            border-radius: 12px;
            text-align: center;
        }

        .footer-primary {
            font-size: 0.78rem;
            color: var(--footer-text);
            line-height: 1.6;
            margin-bottom: 6px;
        }

        .footer-secondary {
            font-size: 0.68rem;
            color: var(--footer-text);
            opacity: 0.6;
            line-height: 1.6;
        }

        .footer strong {
            font-weight: 700;
        }

        .how-to-play {
            font-size: 0.75rem;
            color: var(--text);
            opacity: 0.7;
            margin-top: 12px;
            line-height: 1.5;
            text-align: center;
        }

        .how-to-play strong {
            color: var(--teal);
        }

        /* ===== Mute Button ===== */
        .mute-btn {
            background: none;
            border: 1.5px solid var(--cell-border);
            border-radius: 6px;
            padding: 3px 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.72rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .mute-btn:hover { opacity: 1; }

        .mute-btn .mute-icon {
            font-size: 0.85rem;
            line-height: 1;
        }

        /* ===== Animations ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.4s ease; }
        .slide-down { animation: slideDown 0.4s ease; }

        /* ===== Responsive ===== */
        @media (max-width: 520px) {
            body { padding: 10px; }
            .bingo-card { padding: 8px; }
            .grid { gap: 4px; }
            .cell { padding: 4px 3px; border-width: 1.5px; border-radius: 5px; }
            .cell .aha-text { font-size: clamp(0.48rem, 2.8vw, 0.65rem); line-height: 1.2; }
            .cell .track-dot { width: 5px; height: 5px; top: 2px; left: 2px; }
            .actions { gap: 6px; }
            .btn { padding: 8px 14px; font-size: 0.72rem; }
            .controls { gap: 10px; }
            .bulb-icon { width: 12px; height: 12px; font-size: 10px; top: 1px; right: 1px; }
            .info-btn { width: 15px; height: 15px; font-size: 0.5rem; bottom: 1px; right: 1px; }
            .day-dot { padding: 4px 10px; font-size: 0.65rem; }
            .day-journal-btn { padding: 4px 10px !important; font-size: 0.65rem !important; }
            .event-info { font-size: 0.62rem; gap: 8px; }
        }

        @media (min-width: 521px) and (max-width: 768px) {
            .cell .aha-text { font-size: clamp(0.55rem, 1.7vw, 0.8rem); }
        }

        /* ===== Print ===== */
        @media print {
            body { background: white; }
            .controls, .actions, .how-to-play, .track-filter, .day-indicator { display: none; }
            .bingo-card { box-shadow: none; border: 2px solid var(--navy); }
        }
    </style>
</head>
<body>
    <!-- Welcome / Login Overlay -->
    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-card">
            <div class="welcome-logo">
                <img src="https://www.volarisgroup.com/wp-content/uploads/2024/09/Logo-2.png" alt="Volaris Group" id="welcomeLogo">
            </div>
            <h1 class="welcome-title">&#x1F4A1; Aha Moment Bingo</h1>
            <p class="welcome-subtitle">CSI Revenue Signals Product Accelerator</p>
            <p class="welcome-desc">Track your breakthrough moments across the 4-day Denver program.</p>
            <form id="welcomeForm" onsubmit="submitWelcome(event)">
                <div class="welcome-field">
                    <label for="welcomeName">Your Name</label>
                    <input type="text" id="welcomeName" placeholder="e.g. James Whiting" required autocomplete="name">
                </div>
                <div class="welcome-field">
                    <label for="welcomeEmail">Email</label>
                    <input type="email" id="welcomeEmail" placeholder="e.g. james@company.com" required autocomplete="email">
                </div>
                <div class="welcome-field">
                    <label for="welcomeVbu">Business Unit</label>
                    <select id="welcomeVbu" required>
                        <option value="" disabled selected>Select your VBU...</option>
                        <option value="Grosvenor Systems">Grosvenor Systems</option>
                        <option value="Harris Computer">Harris Computer</option>
                        <option value="N. Harris Computer">N. Harris Computer</option>
                        <option value="Trapeze Group">Trapeze Group</option>
                        <option value="Cultura Technologies">Cultura Technologies</option>
                        <option value="Modaxo">Modaxo</option>
                        <option value="Lumine Group">Lumine Group</option>
                        <option value="Volaris HQ">Volaris HQ</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button type="submit" class="welcome-submit">Let's Go! &#x26A1;</button>
            </form>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header slide-down">
            <div class="logo-area">
                <img src="https://www.volarisgroup.com/wp-content/uploads/2024/09/Logo-2.png" alt="Volaris Group" id="logoImg">
                <div class="logo-subtitle">CSI Revenue Signals Program</div>
            </div>
            <!-- Denver mountain skyline -->
            <div class="mountain-header">
                <svg viewBox="0 0 600 80" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <!-- Far range -->
                    <path class="mtn-far" d="M0,80 L0,42 L40,48 L80,28 L110,38 L150,18 L180,32 L210,12 L250,30 L280,22 L310,35 L340,15 L380,28 L420,10 L460,25 L500,18 L540,32 L570,24 L600,30 L600,80Z" fill="var(--navy)" opacity="0.07"/>
                    <!-- Mid range -->
                    <path class="mtn-mid" d="M0,80 L0,52 L50,48 L100,36 L140,44 L190,28 L230,40 L270,24 L310,38 L360,30 L400,42 L440,28 L480,38 L530,32 L580,40 L600,36 L600,80Z" fill="var(--navy)" opacity="0.12"/>
                    <!-- Near foothills -->
                    <path class="mtn-near" d="M0,80 L0,60 L60,56 L120,62 L180,54 L240,58 L300,52 L360,58 L420,54 L480,60 L540,56 L600,58 L600,80Z" fill="var(--navy)" opacity="0.18"/>
                    <!-- Snow caps on tallest peaks -->
                    <path d="M205,14 L210,12 L216,17 L210,15Z" fill="white" opacity="0.6"/>
                    <path d="M207,16 L210,12 L220,20 L212,18Z" fill="white" opacity="0.25"/>
                    <path d="M415,12 L420,10 L426,16 L420,13Z" fill="white" opacity="0.6"/>
                    <path d="M417,14 L420,10 L428,18 L422,16Z" fill="white" opacity="0.25"/>
                    <path d="M145,20 L150,18 L156,24 L150,21Z" fill="white" opacity="0.55"/>
                    <path d="M147,22 L150,18 L158,26 L152,23Z" fill="white" opacity="0.2"/>
                    <path d="M335,17 L340,15 L346,21 L340,18Z" fill="white" opacity="0.55"/>
                    <path d="M337,19 L340,15 L348,23 L342,20Z" fill="white" opacity="0.2"/>
                    <path d="M75,30 L80,28 L86,34 L80,31Z" fill="white" opacity="0.5"/>
                    <path d="M77,32 L80,28 L88,36 L82,33Z" fill="white" opacity="0.18"/>
                    <path d="M495,20 L500,18 L506,24 L500,21Z" fill="white" opacity="0.5"/>
                    <path d="M497,22 L500,18 L508,26 L502,23Z" fill="white" opacity="0.18"/>
                    <!-- Additional snow highlights on ridgeline -->
                    <path d="M268,23 L272,21 L276,25Z" fill="white" opacity="0.35"/>
                    <path d="M108,39 L112,37 L116,41Z" fill="white" opacity="0.3"/>
                    <path d="M538,33 L542,31 L546,35Z" fill="white" opacity="0.3"/>
                </svg>
            </div>
            <h1 class="title" id="mainTitle"><span class="bulb">&#x1F4A1;</span> Aha Moment Bingo</h1>
            <p class="tagline" id="tagline">Spot the breakthrough. Mark the moment. Collect your tokens.</p>
            <div class="event-info">
                <span>&#x1F3D4;&#xFE0F; Denver, CO</span>
                <span>&#x1F4C5; 4-Day Accelerator</span>
                <span>&#x26A1; Progress Over Perfection</span>
            </div>
        </header>

        <!-- Day Tracker + Journal -->
        <div class="day-indicator fade-in">
            <div class="day-dot active" data-day="1" onclick="selectDay(1)">Day 1</div>
            <div class="day-dot" data-day="2" onclick="selectDay(2)">Day 2</div>
            <div class="day-dot" data-day="3" onclick="selectDay(3)">Day 3</div>
            <div class="day-dot" data-day="4" onclick="selectDay(4)">Day 4</div>
            <button class="btn btn-journal day-journal-btn" onclick="viewJournal()">&#x1F4D3; My Journal</button>
        </div>

        <!-- Track Filter -->
        <div class="track-filter fade-in">
            <button class="track-btn active" data-track="all" onclick="setTrackFilter('all')">All Tracks</button>
            <button class="track-btn" data-track="leadership" onclick="setTrackFilter('leadership')">Leadership</button>
            <button class="track-btn" data-track="product" onclick="setTrackFilter('product')">Product</button>
            <button class="track-btn" data-track="rnd" onclick="setTrackFilter('rnd')">R&D</button>
        </div>

        <!-- Controls -->
        <div class="controls fade-in">
            <div class="toggle-group">
                <span class="toggle-label">Light</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="themeToggle" aria-label="Toggle dark mode">
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label">Dark</span>
            </div>
            <button class="mute-btn" id="muteBtn" onclick="toggleMute()" aria-label="Toggle sound">
                <span class="mute-icon" id="muteIcon">&#x1F50A;</span>
                <span id="muteLabel">Sound</span>
            </button>
        </div>

        <!-- Card Info -->
        <div class="card-info fade-in">
            <span class="user-greeting" id="userGreeting"></span>
            <span class="card-id" id="cardId">Card #0000</span>
            <span class="token-counter">
                <span class="token-icon">&#x26A1;</span>
                <span class="token-count" id="scoreDisplay">0</span>
                <span style="font-weight:600; font-size:0.7rem; opacity:0.7">tokens</span>
            </span>
        </div>

        <!-- Bingo Card + Side Panel Layout -->
        <div class="card-layout" id="cardLayout">
            <div class="bingo-card fade-in" id="bingoCard">
                <div class="grid" id="bingoGrid" role="grid" aria-label="Aha moment bingo card"></div>
            </div>
            <div class="side-panel" id="sidePanel">
                <button class="side-panel-close" id="sidePanelClose" title="Close">&times;</button>
                <div class="insight-track-badge" id="sideBadge">LEADERSHIP</div>
                <div class="side-panel-aha" id="sideAha"></div>
                <div class="side-panel-insight" id="sideInsight"></div>
                <div class="side-panel-source" id="sideSource"></div>
                <div class="journal-bonus-hint" id="sideBonusHint">
                    &#x26A1; Write a reflection to earn bonus tokens &mdash; <span class="bonus-amount">the more you write, the bigger the bonus!</span>
                </div>
                <div class="side-panel-journal">
                    <div class="journal-label">&#x1F4D3; Capture your aha moment</div>
                    <textarea id="sideTextarea" placeholder="What shifted in your thinking? What will you do differently?"></textarea>
                    <div class="journal-char-count" id="sideCharCount">0 chars &mdash; 1x bonus multiplier (write 50+ for 2x!)</div>
                </div>
                <div class="side-panel-bottom">
                    <span class="side-panel-saved" id="sideSaved">&#x2713; Saved</span>
                    <button class="side-panel-share" id="sideShare" onclick="shareSidePanelAha()">&#x1F4E4; Share</button>
                    <button class="side-panel-gotit" id="sideGotit">&#x1F4A1; Got it!</button>
                </div>
            </div>
        </div>

        <!-- How to play -->
        <p class="how-to-play fade-in" id="howToPlay">
            <strong>Click</strong> a cell when you have that aha moment. Hit <strong>&#x24D8;</strong> for the deeper insight. Get <strong>5 in a row</strong> and you've had a breakthrough day!
        </p>

        <!-- Action Buttons -->
        <div class="actions fade-in">
            <button class="btn btn-primary" onclick="generateNewCard()">New Card</button>
            <button class="btn btn-secondary" onclick="resetMarks()">Reset</button>
            <button class="btn btn-accent" onclick="shareCard()">Share My Card</button>
        </div>

        <!-- Footer -->
        <footer class="footer fade-in">
            <p class="footer-primary">
                <strong>CSI Revenue Signals Program</strong> &mdash; Denver Accelerator by <strong>Volaris Business Transformation</strong>
            </p>
            <p class="footer-secondary">
                "Incremental change will NOT work for us this round. Run at this hard!" &mdash; Mark Miller
            </p>
        </footer>
    </div>

    <!-- Insight / Journal Expanded View -->
    <div class="insight-overlay" id="insightOverlay">
        <div class="insight-card">
            <div class="insight-track-badge" id="insightTrackBadge">LEADERSHIP</div>
            <div class="insight-aha" id="insightAha"></div>
            <div class="insight-text" id="insightText"></div>
            <div class="insight-source" id="insightSource"></div>
            <div class="journal-bonus-hint" id="journalBonusHint">
                &#x26A1; Write a reflection to earn <span class="bonus-amount">+1,000&ndash;3,000</span> bonus tokens
            </div>
            <div class="journal-section">
                <div class="journal-label">&#x1F4D3; Capture your aha moment</div>
                <textarea class="journal-textarea" id="journalTextarea" placeholder="What shifted in your thinking? What will you do differently?"></textarea>
                <div class="journal-saved" id="journalSaved">&#x2713; Saved &amp; bonus tokens earned!</div>
            </div>
            <button class="insight-close" onclick="closeInsight()">&#x1F4A1; Got it!</button>
        </div>
    </div>

    <!-- Journal View Overlay -->
    <div class="journal-overlay" id="journalOverlay">
        <div class="journal-view">
            <h2>&#x1F4D3; My Learning Journal</h2>
            <p class="journal-subtitle">Your aha moments from the Denver Accelerator</p>
            <div class="journal-stats" id="journalStats"></div>
            <div id="journalEntries"></div>
            <div class="journal-footer">
                <button class="journal-export" onclick="exportJournal()">&#x1F4CB; Export Journal</button>
                <button class="journal-close" onclick="closeJournal()">Close</button>
            </div>
        </div>
    </div>

    <!-- BINGO Celebration Overlay -->
    <div class="bingo-overlay" id="bingoOverlay">
        <div class="bingo-title" id="bingoTitle">&#x1F4A1; BINGO! &#x1F4A1;</div>
        <div class="bingo-subtitle" id="bingoSubtitle">5 aha moments in a row! Your mind is officially blown.</div>
        <button class="btn btn-accent" onclick="closeBingo()">Keep Collecting!</button>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confettiCanvas"></canvas>

    <!-- Toast -->
    <div class="toast" id="toast">Copied to clipboard!</div>

    <script>
    /* ===================================================================
       AHA MOMENT BINGO - CSI Revenue Signals Accelerator
       =================================================================== */

    // ===== Aha Moment Pool =====
    // Grounded in what people EXPERIENCE when they work AI-first for the first time
    const AHA_POOL = [
        // ===== PRODUCT TRACK =====
        // Grounded in what product people actually do during the accelerator:
        // market research with AI, building prototypes, client demos, data analysis
        {
            aha: "I described what I wanted in plain English and had a working prototype by lunch",
            insight: "No wireframes. No Jira tickets. No waiting for dev capacity. You typed what the product should do, iterated through three versions with an agent, and had something clickable to show your team. The distance between 'I have an idea' and 'try this' just shrank from weeks to hours.",
            insightSource: "Hands-on Prototype Build",
            track: "product"
        },
        {
            aha: "I built a customer-facing demo for a product that didn't exist on Monday",
            insight: "Four days ago this was a whiteboard sketch. Now there's a working application a client can click through. You didn't wait for a sprint, a designer, or a dev team. You built it. The concept of 'we'll get to it next quarter' sounds absurd when you can show it next Tuesday.",
            insightSource: "Rapid Prototyping",
            track: "product"
        },
        {
            aha: "AI found three competitor products I'd never heard of  and summarised their pricing",
            insight: "You pasted a problem statement into a conversation and got back a competitive landscape with pricing tiers, feature gaps, and market positioning. Research that would take your team a week of Googling happened in a single chat. The barrier to being well-informed just disappeared.",
            insightSource: "Market Research",
            track: "product"
        },
        {
            aha: "I asked it to poke holes in my business case and it found the fatal flaw",
            insight: "You thought your assumptions were solid. AI challenged your TAM calculation, questioned your pricing model, and pointed out a competitor you'd overlooked. It didn't agree with you to be polite. It stress-tested your thinking harder than most colleagues would.",
            insightSource: "Idea Validation",
            track: "product"
        },
        {
            aha: "I ran user interviews with a synthetic customer panel  at 10pm in my hotel room",
            insight: "You built personas from real customer data and had a conversation with them. They pushed back on your feature priorities, flagged usability concerns, and suggested a use case you hadn't considered. No recruitment. No scheduling. Just insight, whenever you need it.",
            insightSource: "Synthetic User Research",
            track: "product"
        },
        {
            aha: "My markdown spec turned into a running application  I didn't write a single line of code",
            insight: "You structured your thinking in a document. An agent read it and built the thing. Database, UI, logic  all from your spec. The translation layer between 'what I want' and 'what gets built' used to be the most expensive part. It's gone.",
            insightSource: "Spec to Software",
            track: "product"
        },
        {
            aha: "I iterated the UI three times before my coffee went cold",
            insight: "Change the layout. Swap the colour scheme. Add a filtering feature. Each iteration took minutes, not days. When the feedback loop is this fast, you stop guessing what users want and start showing them options. Product decisions get better when experimentation is cheap.",
            insightSource: "Rapid Iteration",
            track: "product"
        },
        {
            aha: "I'm a product manager and I just deployed something to a real URL",
            insight: "Not a mockup in Figma. A live application on the internet that people can use. You went from 'I need a developer to build this' to 'I just built this.' The line between product and engineering didn't blur  it moved. And you're now on the other side of it.",
            insightSource: "Builder Mindset",
            track: "product"
        },
        {
            aha: "AI analysed 200 support tickets and found the pattern our team had missed",
            insight: "You dumped raw customer data into a conversation and asked 'what are people actually complaining about?' It clustered the themes, ranked them by frequency, and surfaced a root cause buried across dozens of tickets. Data analysis isn't a specialist skill anymore  it's a conversation.",
            insightSource: "Data-Driven Discovery",
            track: "product"
        },
        {
            aha: "I fed it our product's help docs and it wrote better onboarding copy than we have",
            insight: "It read your existing documentation, understood the product, and generated user-facing content that's clearer than what your team spent weeks writing. Content creation just became a by-product of having a product, not a separate workstream.",
            insightSource: "Content Generation",
            track: "product"
        },
        {
            aha: "The pitch deck wrote itself from the prototype we built",
            insight: "Problem statement, solution demo, market size, competitive positioning  all generated from the product you actually built this week. The go-to-market pack isn't a phase after building. It's a side effect of building. You're already ready to sell.",
            insightSource: "Go-to-Market",
            track: "product"
        },
        {
            aha: "I understood a vertical I've never worked in  in a single afternoon",
            insight: "Different industry. Different data. Different jargon. You asked AI to explain the domain, identify pain points, and suggest revenue opportunities. The years of domain expertise that used to be a competitive moat? Now it's a conversation you can have in an hour.",
            insightSource: "Domain Ramp-up",
            track: "product"
        },
        {
            aha: "We went from 'what should we build?' to 'here's the client demo' in four days",
            insight: "Research, ideation, build, test, demo  the full product lifecycle happened this week. Not because you cut corners, but because agents removed the dead time between steps. The quarterly roadmap rhythm feels strange when you can cycle this fast.",
            insightSource: "Full Lifecycle",
            track: "product"
        },
        {
            aha: "I stopped writing requirements documents and started writing instructions agents can execute",
            insight: "Structure your thinking clearly and agents can build from it directly. The 30-page PRD that nobody reads is dead. A well-structured markdown file is both the plan and the build instruction. Your writing is now a programming language.",
            insightSource: "Intent as Instruction",
            track: "product"
        },
        {
            aha: "Waiting for dev capacity to test an idea feels absurd now",
            insight: "You used to put ideas on a backlog and wait. Now you can validate or kill a concept in an afternoon. The dependency on sprint capacity to test a hypothesis is gone. Product management just shifted from 'requesting builds' to 'doing builds.'",
            insightSource: "Self-Sufficient PM",
            track: "product"
        },

        // ===== R&D TRACK =====
        // Grounded in what developers actually experience: Git for the first time,
        // Git, infrastructure, SDLC, vibe coding, debugging, deployment
        {
            aha: "I made my first ever Git commit  and it felt less scary than I expected",
            insight: "git add, git commit, git push. Three commands that used to feel like developer magic. You just did them. The terminal isn't a scary place when an agent explains what each command does and catches your mistakes. Version control is a life skill, not a developer skill.",
            insightSource: "First Git Commit",
            track: "rnd"
        },
        {
            aha: "I described a bug in plain English and the agent fixed it across four files",
            insight: "You didn't trace the stack. You didn't set breakpoints. You said 'the save button doesn't work' and the agent found the disconnected event handler, the missing API call, and the error in the response parser. Debugging just became a conversation.",
            insightSource: "Agent-Assisted Debugging",
            track: "rnd"
        },
        {
            aha: "Someone who's never coded built a working app  and the code is actually clean",
            insight: "You reviewed their output expecting a mess. Instead: proper structure, error handling, consistent naming. The agent doesn't write sloppy code because it's Friday afternoon. Code quality is no longer correlated with developer experience. That changes everything about who can build.",
            insightSource: "Vibe Coding Quality",
            track: "rnd"
        },
        {
            aha: "We went from a static HTML page to a full database-backed application in one afternoon",
            insight: "API endpoints, a real database, authentication, deployment  the entire backend infrastructure that used to take a sprint to provision happened in a few hours. The gap between 'demo' and 'production' used to be months. Now it's an afternoon.",
            insightSource: "Infrastructure Sprint",
            track: "rnd"
        },
        {
            aha: "The entire CI/CD pipeline  build, test, deploy  was set up from a single conversation",
            insight: "You described what you needed: run tests on every push, deploy to staging, promote to production. The agent wrote the pipeline config, set up the environments, and had it running. Infrastructure-as-conversation is faster than infrastructure-as-code.",
            insightSource: "Pipeline in Minutes",
            track: "rnd"
        },
        {
            aha: "I pasted an error message I didn't understand and got a fix I could actually apply",
            insight: "Stack traces used to be hieroglyphics. You pasted it into a conversation and got back: here's what broke, here's why, here's the fix, here's how to prevent it. The years of experience needed to interpret error messages just got compressed into a prompt.",
            insightSource: "Error Translation",
            track: "rnd"
        },
        {
            aha: "I reviewed code an agent wrote  and learned a pattern I didn't know existed",
            insight: "The agent used a cleaner approach than you would have. You read it, understood it, and now it's in your toolkit. Agents aren't just productivity tools  they're teaching you while they work. Code review became a learning session.",
            insightSource: "Learning by Reviewing",
            track: "rnd"
        },
        {
            aha: "We had a working API, database, and frontend talking to each other  before lunch on Day 2",
            insight: "The full stack. Connected. Deployed. Serving real requests. Not scaffolded  actually working. Every estimate you've ever given for standing up a new service is based on assumptions that just shattered.",
            insightSource: "Full Stack in Hours",
            track: "rnd"
        },
        {
            aha: "The agent wrote tests I wouldn't have thought to write  and one of them caught a bug",
            insight: "You asked for tests. It generated edge cases you'd have skipped. One failed  revealing a logic error you didn't know was there. The agent didn't just test your code. It made your code correct. Testing and debugging merged into one step.",
            insightSource: "Agent-Written Tests",
            track: "rnd"
        },
        {
            aha: "I said 'deploy this to production' and it configured the hosting, DNS, and SSL",
            insight: "Cloud storage, CDN distributions, API gateways, serverless functions  all provisioned and configured from a conversation. The cloud infrastructure that used to require a dedicated DevOps engineer happened as a side effect of shipping the feature.",
            insightSource: "One-Command Deploy",
            track: "rnd"
        },
        {
            aha: "I shipped working software to a real URL  from a blank folder  in four days",
            insight: "Not a localhost demo. A deployed application on HTTPS that real users can access. You went from an empty directory to production in less than a week. Your entire mental model of how long software takes is built on assumptions that just broke.",
            insightSource: "Blank to Deployed",
            track: "rnd"
        },
        {
            aha: "I asked 'how does this codebase work?' and finally understood how all the pieces connect",
            insight: "Reading someone else's code used to mean hours of tracing function calls and guessing at intent. You asked 'how does this work?' and got a clear walkthrough of the architecture, data flow, and design decisions. Codebase onboarding just became a conversation.",
            insightSource: "Code Comprehension",
            track: "rnd"
        },
        {
            aha: "The SDLC that used to take us six weeks happened in a single sprint  with higher quality",
            insight: "Requirements, architecture, implementation, testing, documentation, deployment  the full software development lifecycle, compressed. Not by cutting corners, but by removing the dead time between steps. The process didn't get worse. The waiting got eliminated.",
            insightSource: "Compressed SDLC",
            track: "rnd"
        },
        {
            aha: "A non-developer's prototype connected to our production API  and it actually worked",
            insight: "Someone from the product team built something with an agent. You expected to rebuild it from scratch. Instead, you connected it to real endpoints and it held up. The code was structured, the error handling was there. 'Throwaway prototype' isn't a category anymore.",
            insightSource: "Vibe Code to Production",
            track: "rnd"
        },
        {
            aha: "The documentation wrote itself from the code  and it's more complete than what I'd have written",
            insight: "API docs, setup guides, architecture notes  generated by the agent, accurate and thorough. The 'we'll document it later' lie is finally dead. Documentation is a by-product of building, not a chore that gets skipped.",
            insightSource: "Auto-Documentation",
            track: "rnd"
        },

        // ===== LEADERSHIP TRACK =====
        // What leaders actually witness and feel during the accelerator:
        // seeing their teams build, rethinking budgets, watching non-devs ship
        {
            aha: "I watched a product manager build and deploy software  without asking a developer",
            insight: "They described what they wanted. An agent built it. They iterated. They shipped it. No sprint planning. No handoff. No waiting. The org chart you designed  with its handoffs and specialisations  is built around bottlenecks that just got removed.",
            insightSource: "Witnessing the Shift",
            track: "leadership"
        },
        {
            aha: "The team built a working client demo in four days  I'd have scoped that at three months",
            insight: "You watched it happen. Research, prototype, iteration, client-ready demo  in one week. Every estimate, timeline, and resource plan in your portfolio is built on assumptions that just broke. The question isn't whether to recalibrate  it's how fast.",
            insightSource: "Timeline Reset",
            track: "leadership"
        },
        {
            aha: "I fed my actual QSR into AI and got insights my finance team hadn't flagged",
            insight: "Your real quarterly data  variance analysis, trend identification, strategic recommendations. Not a generic demo. YOUR numbers, analysed in minutes. This isn't something you adopt for the team. It changes how you think and decide.",
            insightSource: "QSR Analysis",
            track: "leadership"
        },
        {
            aha: "I realised this isn't a dev tool  it changes how every function in my business operates",
            insight: "You came thinking this was about software development. Then you saw it applied to market research, customer analysis, content creation, financial modelling, and ops. Every department you lead has workflows that just got fundamentally cheaper and faster.",
            insightSource: "Enterprise Impact",
            track: "leadership"
        },
        {
            aha: "My team found a revenue opportunity we'd been sitting on  because they could finally analyse the data",
            insight: "The data was always there. The analysis was too expensive, too slow, or too dependent on a specialist who was busy. AI made it accessible. The bottleneck was never the data  it was the cost of looking at it.",
            insightSource: "Data Unlock",
            track: "leadership"
        },
        {
            aha: "Tuesday's 'that's impossible' became Thursday's 'obviously we should do that'",
            insight: "The technology didn't change between Tuesday and Thursday  your understanding of it did. Now multiply that gap across your org. Everyone who hasn't had this week still thinks Tuesday's reality is true. That's both your biggest risk and your biggest opportunity.",
            insightSource: "Mindset Shift",
            track: "leadership"
        },
        {
            aha: "The security and compliance concerns I had were already solved  months ago",
            insight: "Enterprise guardrails, data residency, audit trails, access controls  all production-ready. The concerns were valid two years ago. They're solved now. Every leader still citing security as a blocker is protecting comfort, not data.",
            insightSource: "Enterprise Readiness",
            track: "leadership"
        },
        {
            aha: "I saw three people with agents match the output of an eight-person team",
            insight: "Same scope. Same quality. Fraction of the people. This isn't about replacing headcount  it's about what your existing people can now accomplish. The hiring model built on 'we need more people' is competing with 'we need better tools.'",
            insightSource: "Team Economics",
            track: "leadership"
        },
        {
            aha: "Every budget I've approved this year is based on the wrong maths",
            insight: "The cost and time assumptions in every plan are based on human-only work. You just saw what agent-assisted teams deliver. The maths isn't slightly different  it's fundamentally different. Margin assumptions, ROI models, hiring plans  all need rethinking.",
            insightSource: "Economic Reset",
            track: "leadership"
        },
        {
            aha: "The spec-to-code handover  our most expensive friction point  just disappeared",
            insight: "Product wrote a spec. An agent had working code the same day. The sprints of misinterpretation, back-and-forth, and re-scoping collapsed to nothing. The most expensive part of your delivery model just ceased to exist.",
            insightSource: "Handover Elimination",
            track: "leadership"
        },
        {
            aha: "I showed my actual work being transformed by an agent  live, in front of peers",
            insight: "Real emails, real data, real workflows  processed and improved by agents on screen. Not a vendor demo. YOUR work. When leaders see each other working this way, permission to change spreads faster than any top-down mandate.",
            insightSource: "Leader Show and Tell",
            track: "leadership"
        },
        {
            aha: "My instinct shifted from 'how do I solve this' to 'what do I ask the agent'",
            insight: "It happened mid-week and you barely noticed. Your default problem-solving loop changed. That's not delegation  it's a fundamentally different way of operating. You upgraded how you think, not just how you work.",
            insightSource: "Operating System Upgrade",
            track: "leadership"
        },

        // ===== GENERAL / CROSS-CUTTING =====
        // The shared realisations that hit everyone regardless of role
        {
            aha: "I haven't Googled anything in three days  and I've been more productive than ever",
            insight: "Your reflex for finding answers shifted from searching to conversing. That's not a tool preference  it's a fundamentally different relationship with information. You stopped context-switching between browser tabs and started getting answers inside the work.",
            insightSource: "New Information Reflex",
            track: "general"
        },
        {
            aha: "I was afraid of the terminal on Monday  now I'm running Git commands from it",
            insight: "The command line felt like developer territory. By Wednesday you were navigating folders, running scripts, and committing code. The technical barrier wasn't skill  it was confidence. An agent that explains each step removed the fear, not just the difficulty.",
            insightSource: "Terminal Confidence",
            track: "general"
        },
        {
            aha: "I built something real  not a slide deck about building something",
            insight: "No more 'here's what we would build if we had resources.' You built the thing. It works. People can use it. The gap between strategy and execution collapsed. This week, thinking and doing were the same activity.",
            insightSource: "From Talking to Doing",
            track: "general"
        },
        {
            aha: "My Day 1 fear is embarrassing by Day 4",
            insight: "'It'll take my job.' 'I'm too old for this.' 'This is just hype.' Every fear from Monday was either disproven by what you built or has a clear answer now. The gap between fear and reality is where growth happens  and you just closed it in four days.",
            insightSource: "Fear to Confidence",
            track: "general"
        },
        {
            aha: "The person next to me  who has a completely different role  used the same tool to solve a completely different problem",
            insight: "A product manager used it for market research. A developer used it for debugging. A leader used it for financial analysis. Same tool, different problems, same result: faster, better, cheaper. This isn't a specialist tool. It's a thinking amplifier.",
            insightSource: "Universal Applicability",
            track: "general"
        },
        {
            aha: "I learned more about my own product by asking AI about it than from our internal docs",
            insight: "You fed it your product data and asked questions you'd been meaning to investigate for months. It connected dots across support tickets, feature requests, and usage patterns. The insight was always in your data  you just couldn't access it fast enough.",
            insightSource: "Self-Discovery",
            track: "general"
        },
        {
            aha: "Progress over perfection isn't a slogan  it's literally how we built this week",
            insight: "Ship rough, get feedback, iterate, improve. Every day the prototype got better because you showed it to someone and learned what to change. Perfection would have meant nothing got built. The messy version that exists beats the perfect version that doesn't.",
            insightSource: "Iteration Mindset",
            track: "general"
        },
        {
            aha: "I went from 'I don't know where to start' to 'I know exactly what to build next'",
            insight: "The paralysis of a blank page disappeared when you could have a conversation about it. Brainstorm, narrow down, validate, build  AI didn't just help you execute. It helped you think. The hardest part of any project is starting. That just got radically easier.",
            insightSource: "Unblocked Thinking",
            track: "general"
        },
        {
            aha: "I explained what I needed to an agent better than I've ever explained it to a colleague",
            insight: "Because the agent asked clarifying questions without ego. Because it didn't assume it knew what you meant. Because the feedback loop was instant. You got better at articulating your intent  and that skill transfers to every human conversation too.",
            insightSource: "Clarity of Intent",
            track: "general"
        },
        {
            aha: "This isn't a preview of 2030  we did this with tools available right now",
            insight: "No beta access. No special hardware. No 'coming soon.' Everything you built this week used production tools anyone can access today. The gap isn't technology  it's adoption. And you just closed it.",
            insightSource: "Available Now",
            track: "general"
        }
    ];

    const TRACK_COLORS = {
        leadership: '#F59E0B',
        product: '#008AB0',
        rnd: '#BFD731',
        general: '#9CA3AF'
    };

    const TRACK_LABELS = {
        leadership: 'Leadership',
        product: 'Product',
        rnd: 'R&D',
        general: 'General'
    };

    // ===== State =====
    let currentCard = [];
    let markedCells = new Set();
    let cardSeed = 0;
    let bingoDetected = false;
    let celebratedLines = new Set(); // track which bingo lines already celebrated
    let isDarkMode = false;
    let isMuted = false;
    let activeTrack = 'all';
    let activeDay = 1;
    let journalNotes = {}; // { "aha text": { note, track, timestamp, day } }
    let currentInsightIndex = -1;

    // Per-day marked cells: { 1: Set, 2: Set, 3: Set, 4: Set }
    let markedByDay = {
        1: new Set([12]),
        2: new Set([12]),
        3: new Set([12]),
        4: new Set([12])
    };

    function saveMarkedByDay() {
        const serialized = {};
        for (const d of [1,2,3,4]) {
            serialized[d] = [...markedByDay[d]];
        }
        localStorage.setItem('aha-bingo-markedByDay', JSON.stringify(serialized));
    }

    function loadMarkedByDay() {
        try {
            const saved = localStorage.getItem('aha-bingo-markedByDay');
            if (saved) {
                const parsed = JSON.parse(saved);
                for (const d of [1,2,3,4]) {
                    markedByDay[d] = new Set(parsed[d] || [12]);
                }
            }
        } catch(e) {}
    }

    function inferDayFromTimestamp(ts) {
        if (!ts) return 1;
        // Accelerator days: infer from date
        // Fallback: just return 1
        try {
            const d = new Date(ts);
            const dayOfWeek = d.getDay(); // 0=Sun
            // Mon=1, Tue=2, Wed=3, Thu=4 maps to Day 1-4
            if (dayOfWeek >= 1 && dayOfWeek <= 4) return dayOfWeek;
            return 1;
        } catch(e) { return 1; }
    }

    // ===== Web Audio Sound System =====
    let audioCtx = null;

    function getAudioCtx() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        return audioCtx;
    }

    function playStampSound() {
        if (isMuted) return;
        try {
            const ctx = getAudioCtx();
            // Bright "ding" for aha moment
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.05);
            osc.frequency.exponentialRampToValueAtTime(900, ctx.currentTime + 0.15);
            gain.gain.setValueAtTime(0.12, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.2);
        } catch(e) {}
    }

    function playUnmarkSound() {
        if (isMuted) return;
        try {
            const ctx = getAudioCtx();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(150, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.08, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.1);
        } catch(e) {}
    }

    function playBingoSound() {
        if (isMuted) return;
        try {
            const ctx = getAudioCtx();
            // Ascending triumphant arpeggio
            const notes = [523, 659, 784, 1047, 1319]; // C5, E5, G5, C6, E6
            notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'triangle';
                const t = ctx.currentTime + i * 0.1;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.15, t + 0.03);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
                osc.start(t);
                osc.stop(t + 0.4);
            });
        } catch(e) {}
    }

    function toggleMute() {
        isMuted = !isMuted;
        localStorage.setItem('aha-bingo-muted', isMuted ? 'true' : 'false');
        updateMuteUI();
    }

    function updateMuteUI() {
        document.getElementById('muteIcon').innerHTML = isMuted ? '&#x1F507;' : '&#x1F50A;';
        document.getElementById('muteLabel').textContent = isMuted ? 'Muted' : 'Sound';
    }

    // ===== Welcome / Profile =====
    function showWelcome() {
        document.getElementById('welcomeOverlay').classList.add('show');
    }

    function submitWelcome(e) {
        e.preventDefault();
        const name = document.getElementById('welcomeName').value.trim();
        const email = document.getElementById('welcomeEmail').value.trim();
        const vbu = document.getElementById('welcomeVbu').value;
        if (!name || !email || !vbu) return;

        const profile = { name, email, vbu };
        localStorage.setItem('aha-bingo-profile', JSON.stringify(profile));
        currentUserId = email;
        document.getElementById('welcomeOverlay').classList.remove('show');
        updateUserGreeting(profile);
        // Continue init
        loadPreferences();
        loadMarkedByDay();
        loadJournal();
        applyTheme();
        updateMuteUI();
        generateNewCard();
        selectDay(activeDay);
    }

    function updateUserGreeting(profile) {
        const el = document.getElementById('userGreeting');
        if (el && profile) {
            el.innerHTML = `Hi, ${profile.name} <a onclick="changeProfile()">(change)</a>`;
        }
    }

    function changeProfile() {
        localStorage.removeItem('aha-bingo-profile');
        showWelcome();
    }

    // ===== Journal API =====
    const JOURNAL_API = 'https://qqkykyeiol.execute-api.us-east-1.amazonaws.com/journal';
    let currentUserId = null;

    function getUserId() {
        if (currentUserId) return currentUserId;
        const profile = JSON.parse(localStorage.getItem('aha-bingo-profile') || 'null');
        if (profile) {
            currentUserId = profile.email;
            return currentUserId;
        }
        currentUserId = 'anonymous-' + Math.random().toString(36).slice(2, 8);
        return currentUserId;
    }

    function loadJournal() {
        // Load from localStorage first (fast)
        try {
            const saved = localStorage.getItem('aha-bingo-journal');
            if (saved) journalNotes = JSON.parse(saved);
        } catch(e) {}
        // Then sync from API (background)
        syncFromApi();
    }

    async function syncFromApi() {
        try {
            const uid = getUserId();
            const res = await fetch(`${JOURNAL_API}?userId=${encodeURIComponent(uid)}`);
            if (res.ok) {
                const data = await res.json();
                if (data.entries && data.entries.length > 0) {
                    data.entries.forEach(e => {
                        journalNotes[e.ahaText] = { note: e.note, track: e.track, timestamp: e.timestamp, day: e.day || inferDayFromTimestamp(e.timestamp) };
                    });
                    saveJournalLocal();
                }
            }
        } catch(e) { console.log('API sync failed, using localStorage', e); }
    }

    function saveJournalLocal() {
        localStorage.setItem('aha-bingo-journal', JSON.stringify(journalNotes));
    }

    async function saveJournalToApi(ahaText, note, track, day) {
        try {
            const uid = getUserId();
            await fetch(JOURNAL_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: uid, ahaText, note, track, day: day || activeDay, timestamp: new Date().toISOString() })
            });
        } catch(e) { console.log('API save failed, saved locally', e); }
    }

    async function deleteFromApi(ahaText) {
        try {
            const uid = getUserId();
            await fetch(`${JOURNAL_API}?userId=${encodeURIComponent(uid)}&ahaText=${encodeURIComponent(ahaText)}`, { method: 'DELETE' });
        } catch(e) { console.log('API delete failed', e); }
    }

    function getJournalMultiplier(charCount) {
        if (charCount >= 200) return 5;
        if (charCount >= 100) return 3;
        if (charCount >= 50) return 2;
        return 1;
    }

    function saveCurrentNote() {
        if (currentInsightIndex < 0) return;
        const item = currentCard[currentInsightIndex];
        if (!item || item.isFree) return;

        // Try side panel textarea first, fall back to overlay textarea
        const sideTA = document.getElementById('sideTextarea');
        const overlayTA = document.getElementById('journalTextarea');
        const sideOpen = document.getElementById('sidePanel').classList.contains('show');
        const textarea = sideOpen ? sideTA : overlayTA;
        if (!textarea) return;
        const note = textarea.value.trim();

        // Determine which saved element to use
        const savedEl = sideOpen ? document.getElementById('sideSaved') : document.getElementById('journalSaved');
        const hintEl = sideOpen ? document.getElementById('sideBonusHint') : document.getElementById('journalBonusHint');

        if (note) {
            const isNew = !journalNotes[item.aha]?.note;
            journalNotes[item.aha] = { note, track: item.track, timestamp: new Date().toISOString(), day: activeDay };
            if (savedEl) {
                savedEl.classList.add('show');
                setTimeout(() => savedEl.classList.remove('show'), 3000);
            }
            // Award bonus tokens for new journal entry with multiplier
            if (isNew) {
                const multiplier = getJournalMultiplier(note.length);
                const baseBonus = TOKEN_VALUES.journal();
                const bonus = baseBonus * multiplier;
                addTokens(bonus);
                if (savedEl) savedEl.textContent = `\u2713 Saved! +${bonus.toLocaleString()} tokens (${multiplier}x multiplier!)`;
                if (hintEl) hintEl.style.display = 'none';
            }
            saveJournalToApi(item.aha, note, item.track, activeDay);
        } else {
            delete journalNotes[item.aha];
            deleteFromApi(item.aha);
        }
        saveJournalLocal();
    }

    function formatTime(ts) {
        if (!ts) return '';
        try {
            const d = new Date(ts);
            return d.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
        } catch(e) { return ''; }
    }

    function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

    function viewJournal() {
        const container = document.getElementById('journalEntries');
        const statsEl = document.getElementById('journalStats');
        const entries = Object.entries(journalNotes);

        // Stats
        const ahaCount = entries.length;
        const reflections = entries.filter(([, d]) => d.note && d.note.length > 0).length;
        const bingoCount = celebratedLines.size;
        statsEl.innerHTML = `
            <div class="journal-stat"><div class="journal-stat-value">${ahaCount}</div><div class="journal-stat-label">Aha Moments</div></div>
            <div class="journal-stat"><div class="journal-stat-value">${reflections}</div><div class="journal-stat-label">Reflections</div></div>
            <div class="journal-stat"><div class="journal-stat-value">${totalTokens.toLocaleString()}</div><div class="journal-stat-label">Tokens</div></div>
            <div class="journal-stat"><div class="journal-stat-value">${bingoCount}</div><div class="journal-stat-label">Bingos</div></div>
        `;

        if (entries.length === 0) {
            container.innerHTML = '<div class="journal-empty">No notes yet. Click the \u24D8 on any cell and write your thoughts!</div>';
        } else {
            // Group by day
            const byDay = { 1: [], 2: [], 3: [], 4: [] };
            entries.forEach(([aha, data]) => {
                const day = data.day || inferDayFromTimestamp(data.timestamp);
                if (!byDay[day]) byDay[day] = [];
                byDay[day].push([aha, data]);
            });

            // Sort each day by timestamp
            for (const d of [1,2,3,4]) {
                byDay[d].sort((a, b) => (a[1].timestamp || '').localeCompare(b[1].timestamp || ''));
            }

            let html = '';
            for (const d of [1,2,3,4]) {
                if (byDay[d].length === 0) continue;
                html += `<div class="journal-day-section">
                    <div class="journal-day-header">Day ${d}</div>`;
                html += byDay[d].map(([aha, data]) => {
                    const color = TRACK_COLORS[data.track] || TRACK_COLORS.general;
                    const label = TRACK_LABELS[data.track] || 'General';
                    const textColor = data.track === 'product' ? '#fff' : '#0B2340';
                    const time = formatTime(data.timestamp);
                    const safeAha = escapeHtml(aha);
                    const safeNote = escapeHtml(data.note);
                    return `<div class="journal-entry" data-aha="${safeAha}">
                        <div class="journal-entry-header">
                            <span class="journal-entry-track" style="background:${color};color:${textColor}">${label}</span>
                            <div class="journal-entry-aha">\u{1F4A1} ${safeAha}</div>
                            <span class="journal-entry-time">${time}</span>
                        </div>
                        <div class="journal-entry-note" id="je-note-${safeAha.replace(/[^a-zA-Z0-9]/g,'_')}">${safeNote}</div>
                        <div class="journal-entry-actions">
                            <button class="je-edit" onclick="editJournalEntry(this)" title="Edit">&#x270F;&#xFE0F; Edit</button>
                            <button class="je-share" onclick="shareJournalEntry('${safeAha.replace(/'/g,"\\'")}')" title="Share">&#x1F4E4; Share</button>
                            <button class="je-delete" onclick="deleteJournalEntry('${safeAha.replace(/'/g,"\\'")}')" title="Delete">&#x1F5D1; Delete</button>
                        </div>
                    </div>`;
                }).join('');
                html += '</div>';
            }
            container.innerHTML = html;
        }

        document.getElementById('journalOverlay').classList.add('show');
    }

    function editJournalEntry(btn) {
        const entry = btn.closest('.journal-entry');
        const aha = entry.dataset.aha;
        const noteEl = entry.querySelector('.journal-entry-note');
        const currentNote = journalNotes[aha]?.note || '';

        // Replace note with textarea
        const ta = document.createElement('textarea');
        ta.className = 'journal-entry-edit';
        ta.value = currentNote;
        noteEl.replaceWith(ta);
        ta.focus();

        // Save on blur
        ta.addEventListener('blur', () => {
            const newNote = ta.value.trim();
            if (newNote && journalNotes[aha]) {
                journalNotes[aha].note = newNote;
                saveJournalLocal();
                saveJournalToApi(aha, newNote, journalNotes[aha].track, journalNotes[aha].day);
            }
            // Replace textarea with note div
            const div = document.createElement('div');
            div.className = 'journal-entry-note';
            div.textContent = newNote || currentNote;
            ta.replaceWith(div);
        });
    }

    function deleteJournalEntry(aha) {
        if (!confirm('Delete this aha moment from your journal?')) return;
        delete journalNotes[aha];
        saveJournalLocal();
        deleteFromApi(aha);
        viewJournal(); // Re-render
    }

    function shareJournalEntry(aha) {
        const data = journalNotes[aha];
        if (!data) return;
        const text = `\u{1F4A1} Aha Moment: ${aha}\n\n${data.note}\n\n#AhaMomentBingo #DenverAccelerator`;

        if (navigator.share) {
            navigator.share({ title: 'Aha Moment', text }).catch(() => {});
        } else {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            });
        }
    }

    function exportJournal() {
        const entries = Object.entries(journalNotes);
        if (entries.length === 0) { showToast('No entries to export'); return; }

        const profile = JSON.parse(localStorage.getItem('aha-bingo-profile') || '{}');
        let md = `# \u{1F4A1} My Aha Moment Journal\n`;
        md += `**${profile.name || 'Participant'}** | ${profile.vbu || ''}\n`;
        md += `CSI Revenue Signals Accelerator \u2014 Denver, CO\n\n`;

        const byDay = { 1: [], 2: [], 3: [], 4: [] };
        entries.forEach(([aha, data]) => {
            const day = data.day || inferDayFromTimestamp(data.timestamp);
            if (!byDay[day]) byDay[day] = [];
            byDay[day].push([aha, data]);
        });

        for (const d of [1,2,3,4]) {
            if (byDay[d].length === 0) continue;
            byDay[d].sort((a, b) => (a[1].timestamp || '').localeCompare(b[1].timestamp || ''));
            md += `## Day ${d}\n\n`;
            byDay[d].forEach(([aha, data]) => {
                const time = formatTime(data.timestamp);
                md += `### \u{1F4A1} ${aha}\n`;
                if (time) md += `*${time}* | ${TRACK_LABELS[data.track] || 'General'}\n\n`;
                md += `${data.note}\n\n`;
            });
        }

        md += `---\n*Exported from Aha Moment Bingo | ${new Date().toLocaleDateString()}*\n`;

        navigator.clipboard.writeText(md).then(() => {
            showToast('Journal copied to clipboard as Markdown!');
        }).catch(() => {
            showToast('Export failed');
        });
    }

    function closeJournal() {
        document.getElementById('journalOverlay').classList.remove('show');
    }

    document.getElementById('journalOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeJournal();
    });

    // Auto-save journal on textarea input
    document.getElementById('journalTextarea').addEventListener('input', debounce(saveCurrentNote, 500));

    function debounce(fn, ms) {
        let timer;
        return function(...args) {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), ms);
        };
    }

    // ===== Initialize =====
    function init() {
        // Check for welcome/login
        const profile = JSON.parse(localStorage.getItem('aha-bingo-profile') || 'null');
        if (!profile) {
            showWelcome();
            return;
        }
        currentUserId = profile.email;
        updateUserGreeting(profile);

        loadPreferences();
        loadMarkedByDay();
        // Restore active day
        const savedDay = parseInt(localStorage.getItem('aha-bingo-activeDay'));
        if (savedDay >= 1 && savedDay <= 4) {
            activeDay = savedDay;
            markedCells = new Set(markedByDay[activeDay]);
        }
        loadJournal();
        applyTheme();
        updateMuteUI();
        generateNewCard();
        selectDay(activeDay);
    }

    // ===== Preferences =====
    function loadPreferences() {
        const savedTheme = localStorage.getItem('aha-bingo-theme');
        if (savedTheme === 'dark') {
            isDarkMode = true;
            document.getElementById('themeToggle').checked = true;
        } else if (savedTheme === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                isDarkMode = true;
                document.getElementById('themeToggle').checked = true;
            }
        }

        const savedMute = localStorage.getItem('aha-bingo-muted');
        if (savedMute === 'true') isMuted = true;
    }

    function saveTheme() {
        localStorage.setItem('aha-bingo-theme', isDarkMode ? 'dark' : 'light');
    }

    // ===== Theme Toggle =====
    document.getElementById('themeToggle').addEventListener('change', function() {
        isDarkMode = this.checked;
        saveTheme();
        applyTheme();
    });

    function applyTheme() {
        document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : '');
    }

    // ===== Day Selection =====
    function selectDay(day) {
        // Save current day's marked cells
        markedByDay[activeDay] = new Set(markedCells);
        saveMarkedByDay();

        activeDay = day;
        localStorage.setItem('aha-bingo-activeDay', day);

        // Load new day's marked cells
        markedCells = new Set(markedByDay[day]);

        document.querySelectorAll('.day-dot').forEach(d => {
            const dayNum = parseInt(d.dataset.day);
            d.classList.toggle('active', dayNum === day);
        });

        // Re-render grid with new day's state
        bingoDetected = false;
        celebratedLines = new Set();
        renderGrid();
        updateScore();
        checkBingo();
        updateAllDayProgress();
    }

    // ===== Day Progress Bars =====
    function updateAllDayProgress() {
        document.querySelectorAll('.day-dot').forEach(dot => {
            const d = parseInt(dot.dataset.day);
            const marked = markedByDay[d] ? markedByDay[d].size : 1;
            // 25 cells total, free space always marked
            const pct = Math.round((marked / 25) * 100);
            dot.style.setProperty('--day-progress', pct);
        });
    }

    // ===== Track Filter =====
    function setTrackFilter(track) {
        activeTrack = track;
        document.querySelectorAll('.track-btn').forEach(b => {
            b.classList.toggle('active', b.dataset.track === track);
        });
        generateNewCard();
    }

    // ===== Card Generation =====
    function generateNewCard() {
        let pool = [...AHA_POOL];

        // Filter by track if not "all"
        if (activeTrack !== 'all') {
            const trackItems = pool.filter(i => i.track === activeTrack);
            const generalItems = pool.filter(i => i.track === 'general');
            // Mix: mostly track-specific, fill with general
            pool = [...trackItems, ...generalItems];
        }

        // Shuffle and pick 24
        const shuffled = pool.sort(() => Math.random() - 0.5);
        const selected = shuffled.slice(0, 24);

        // Insert free space at index 12
        selected.splice(12, 0, {
            aha: "FREE\nAHA\nMOMENT!",
            insight: "This one's free\u2014because showing up to the accelerator is already an aha moment. Now go collect the rest!",
            insightSource: "Denver Accelerator \u2014 You're here!",
            track: "free",
            isFree: true
        });

        currentCard = selected;
        // Use per-day marked cells (don't reset if already loaded)
        if (markedByDay[activeDay].size === 0) {
            markedByDay[activeDay] = new Set([12]);
        }
        markedCells = new Set(markedByDay[activeDay]);
        bingoDetected = false;

        // Generate card seed
        cardSeed = Math.floor(Math.random() * 9000) + 1000;
        document.getElementById('cardId').textContent = `Card #${cardSeed}`;

        renderGrid();
        updateScore();
    }

    function renderGrid() {
        const grid = document.getElementById('bingoGrid');
        grid.innerHTML = '';

        currentCard.forEach((item, index) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.setAttribute('role', 'gridcell');
            cell.setAttribute('tabindex', '0');
            cell.setAttribute('aria-label', item.isFree ? 'Free space, auto-marked' : item.aha);
            cell.setAttribute('aria-pressed', markedCells.has(index) ? 'true' : 'false');
            if (item.isFree) cell.classList.add('free-space');
            if (markedCells.has(index)) cell.classList.add('marked');

            // Track color dot
            if (!item.isFree) {
                const trackDot = document.createElement('span');
                trackDot.className = 'track-dot';
                trackDot.style.background = TRACK_COLORS[item.track] || TRACK_COLORS.general;
                trackDot.title = TRACK_LABELS[item.track] || 'General';
                cell.appendChild(trackDot);
            }

            const ahaSpan = document.createElement('span');
            ahaSpan.className = 'aha-text';
            ahaSpan.textContent = item.aha;

            const bulbSpan = document.createElement('span');
            bulbSpan.className = 'bulb-icon';
            bulbSpan.textContent = '\u{1F4A1}';

            cell.appendChild(ahaSpan);
            cell.appendChild(bulbSpan);

            // Info button (not on free space)
            if (!item.isFree) {
                const infoBtn = document.createElement('button');
                infoBtn.className = 'info-btn';
                infoBtn.setAttribute('aria-label', 'Show insight for: ' + item.aha);
                infoBtn.setAttribute('tabindex', '0');
                infoBtn.textContent = 'i';
                infoBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showInsight(index);
                });
                cell.appendChild(infoBtn);
            }

            cell.dataset.index = index;

            // Click = mark/unmark
            cell.addEventListener('click', () => handleCellClick(index));

            // Keyboard: Enter/Space to mark, i to show info
            cell.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleCellClick(index);
                } else if (e.key === 'i' || e.key === 'I') {
                    e.preventDefault();
                    showInsight(index);
                }
            });

            grid.appendChild(cell);
        });
    }

    // ===== Cell Interaction =====
    function handleCellClick(index) {

        const item = currentCard[index];
        if (item.isFree) return;

        const cell = document.querySelector(`.cell[data-index="${index}"]`);

        if (markedCells.has(index)) {
            // Already marked - unmark it
            markedCells.delete(index);
            markedByDay[activeDay] = new Set(markedCells);
            saveMarkedByDay();
            cell.classList.remove('marked');
            cell.setAttribute('aria-pressed', 'false');
            // Remove tokens
            if (cellTokens[index]) {
                totalTokens -= cellTokens[index];
                delete cellTokens[index];
            }
            playUnmarkSound();
            updateScore();
            checkBingo();
            updateAllDayProgress();
        } else {
            // Mark the cell
            markedCells.add(index);
            markedByDay[activeDay] = new Set(markedCells);
            saveMarkedByDay();
            cell.classList.add('marked');
            cell.setAttribute('aria-pressed', 'true');
            cell.classList.remove('stamp-animate');
            void cell.offsetWidth;
            cell.classList.add('stamp-animate');
            playStampSound();

            // Award tokens for marking
            const markTokens = TOKEN_VALUES.mark();
            cellTokens[index] = markTokens;
            addTokens(markTokens);

            // Expand into journal/insight view after a brief delay
            setTimeout(() => expandCell(index), 400);

            checkBingo();
            updateAllDayProgress();
        }
    }

    // ===== Side Panel Expansion =====
    let activeCellIndex = -1;

    function expandCell(index) {
        currentInsightIndex = index;
        const item = currentCard[index];
        const panel = document.getElementById('sidePanel');

        // Highlight the clicked cell, unhighlight previous
        if (activeCellIndex >= 0) {
            const prevCell = document.querySelector(`.cell[data-index="${activeCellIndex}"]`);
            if (prevCell) prevCell.style.boxShadow = '';
        }
        activeCellIndex = index;
        const cell = document.querySelector(`.cell[data-index="${index}"]`);
        const trackColor = TRACK_COLORS[item.track] || TRACK_COLORS.general;
        cell.style.boxShadow = `0 0 0 3px ${trackColor}, 0 0 16px ${trackColor}40`;

        // Populate the side panel
        const badge = document.getElementById('sideBadge');
        const trackLabel = TRACK_LABELS[item.track] || 'General';
        badge.textContent = trackLabel;
        badge.style.background = trackColor;
        badge.style.color = item.track === 'product' ? '#fff' : '#0B2340';

        document.getElementById('sideAha').textContent = '\u{1F4A1} ' + item.aha;
        document.getElementById('sideInsight').textContent = item.insight;
        document.getElementById('sideSource').textContent = item.insightSource || '';

        const hasPriorNote = !!journalNotes[item.aha]?.note;
        const bonusHint = document.getElementById('sideBonusHint');
        bonusHint.style.display = hasPriorNote ? 'none' : 'block';

        const textarea = document.getElementById('sideTextarea');
        textarea.value = journalNotes[item.aha]?.note || '';
        updateCharCount(textarea.value.length);

        const savedEl = document.getElementById('sideSaved');
        savedEl.classList.remove('show');

        // Show side panel and widen container
        if (!panel.classList.contains('show')) {
            panel.classList.add('show');
            document.querySelector('.container').classList.add('panel-open');
        }

        setTimeout(() => textarea.focus(), 300);
    }

    function closeSidePanel(save) {
        if (save) saveCurrentNote();
        const panel = document.getElementById('sidePanel');
        panel.classList.remove('show');
        document.querySelector('.container').classList.remove('panel-open');

        // Remove cell highlight
        if (activeCellIndex >= 0) {
            const cell = document.querySelector(`.cell[data-index="${activeCellIndex}"]`);
            if (cell) cell.style.boxShadow = '';
            activeCellIndex = -1;
        }
        if (save) currentInsightIndex = -1;
    }

    // Alias for backward compat
    function closeGridExpansion(save) { closeSidePanel(save); }

    // Wire up side panel buttons
    document.getElementById('sidePanelClose').addEventListener('click', () => closeSidePanel(true));
    document.getElementById('sideGotit').addEventListener('click', () => closeSidePanel(true));

    function shareSidePanelAha() {
        if (currentInsightIndex < 0) return;
        const item = currentCard[currentInsightIndex];
        if (!item) return;
        const note = journalNotes[item.aha]?.note || '';
        let text = `\u{1F4A1} Aha Moment: ${item.aha}`;
        if (note) text += `\n\n${note}`;
        text += `\n\n#AhaMomentBingo #DenverAccelerator`;

        if (navigator.share) {
            navigator.share({ title: 'Aha Moment', text }).catch(() => {});
        } else {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            });
        }
    }

    const debouncedSideSave = debounce(saveCurrentNote, 500);

    document.getElementById('sideTextarea').addEventListener('input', function() {
        updateCharCount(this.value.length);
        debouncedSideSave();
    });

    // Character count and multiplier display
    function updateCharCount(len) {
        const el = document.getElementById('sideCharCount');
        if (!el) return;
        let multiplierLabel = '1x';
        let cls = '';
        if (len >= 200) { multiplierLabel = '5x'; cls = 'multiplier-5x'; }
        else if (len >= 100) { multiplierLabel = '3x'; cls = 'multiplier-3x'; }
        else if (len >= 50) { multiplierLabel = '2x'; cls = 'multiplier-2x'; }
        el.textContent = `${len} chars \u2014 ${multiplierLabel} bonus multiplier${len < 50 ? ' (write 50+ for 2x!)' : len < 100 ? ' (write 100+ for 3x!)' : len < 200 ? ' (write 200+ for 5x!)' : ' \u2014 maximum multiplier!'}`;
        el.className = 'journal-char-count ' + cls;
    }

    // ===== Token Score =====
    // Each marked cell = random token cost (like real AI agent work)
    // Journal entries = bonus tokens (reflection multiplier)
    const TOKEN_VALUES = {
        mark: () => Math.floor(Math.random() * 800) + 200,     // 200-1000 tokens per aha
        journal: () => Math.floor(Math.random() * 2000) + 1000, // 1000-3000 bonus for journaling
        bingo: 10000,                                            // 10k bonus for a bingo line
        free: 500                                                // free space
    };
    let totalTokens = parseInt(localStorage.getItem('aha-bingo-totalTokens')) || 500;
    let cellTokens = {}; // track tokens per cell index

    function updateScore() {
        document.getElementById('scoreDisplay').textContent = totalTokens.toLocaleString();
        localStorage.setItem('aha-bingo-totalTokens', totalTokens);
    }

    function addTokens(amount) {
        totalTokens += amount;
        updateScore();
        // Animate the counter
        const el = document.getElementById('scoreDisplay');
        el.style.transform = 'scale(1.3)';
        el.style.color = '#BFD731';
        setTimeout(() => { el.style.transform = 'scale(1)'; el.style.color = ''; }, 300);
    }

    // ===== Insight Modal (via info button) =====
    function showInsight(index) {
        currentInsightIndex = index;
        const item = currentCard[index];

        // Set track badge
        const badge = document.getElementById('insightTrackBadge');
        badge.textContent = TRACK_LABELS[item.track] || 'General';
        badge.style.background = TRACK_COLORS[item.track] || TRACK_COLORS.general;
        badge.style.color = item.track === 'product' ? '#ffffff' : '#0B2340';

        document.getElementById('insightAha').textContent = '\u{1F4A1} ' + item.aha;
        document.getElementById('insightText').textContent = item.insight;
        document.getElementById('insightSource').textContent = item.insightSource || '';

        // Show/hide bonus hint
        const bonusEl = document.getElementById('journalBonusHint');
        if (bonusEl) bonusEl.style.display = journalNotes[item.aha]?.note ? 'none' : 'block';

        // Load existing journal note
        const textarea = document.getElementById('journalTextarea');
        const existing = journalNotes[item.aha];
        textarea.value = existing ? existing.note : '';
        document.getElementById('journalSaved').classList.remove('show');
        document.getElementById('journalSaved').textContent = '\u2713 Saved & bonus tokens earned!';

        document.getElementById('insightOverlay').classList.add('show');
        setTimeout(() => textarea.focus(), 300);
    }

    function closeInsight() {
        saveCurrentNote();
        currentInsightIndex = -1;
        document.getElementById('insightOverlay').classList.remove('show');
    }

    // Close on overlay click
    document.getElementById('insightOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeInsight();
    });

    // Close on Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeInsight();
            closeGridExpansion(true);
            closeBingo();
            closeJournal();
        }
    });

    // ===== Reset =====
    function resetMarks() {
        markedCells = new Set([12]);
        markedByDay[activeDay] = new Set([12]);
        saveMarkedByDay();
        bingoDetected = false;
        celebratedLines = new Set();
        currentInsightIndex = -1;
        closeGridExpansion(false);
        document.querySelectorAll('.cell').forEach(cell => {
            const idx = parseInt(cell.dataset.index);
            cell.classList.toggle('marked', idx === 12);
            cell.classList.remove('bingo-cell');
        });
        updateScore();
        updateAllDayProgress();
    }

    // ===== Win Detection =====
    function checkBingo() {
        const lines = [
            [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
            [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
            [0,6,12,18,24], [4,8,12,16,20]
        ];

        for (let li = 0; li < lines.length; li++) {
            const line = lines[li];
            if (celebratedLines.has(li)) continue; // already celebrated this line
            if (line.every(i => markedCells.has(i))) {
                celebratedLines.add(li);
                bingoDetected = true; // at least one bingo found
                line.forEach(i => {
                    const cell = document.querySelector(`.cell[data-index="${i}"]`);
                    if (cell) cell.classList.add('bingo-cell');
                });
                const bingoCount = celebratedLines.size;
                showBingoCelebration(bingoCount);
                return; // celebrate one at a time
            }
        }
    }

    // ===== BINGO Celebration =====
    function showBingoCelebration(bingoCount) {
        addTokens(TOKEN_VALUES.bingo);
        if (bingoCount === 1) {
            document.getElementById('bingoTitle').innerHTML = '\u{1F4A1} BREAKTHROUGH! \u{1F4A1}';
            document.getElementById('bingoSubtitle').textContent = "5 aha moments in a row! +10,000 bonus tokens. Keep going \u2014 collect them all!";
        } else {
            document.getElementById('bingoTitle').innerHTML = '\u{1F4A1} BINGO x' + bingoCount + '! \u{1F4A1}';
            document.getElementById('bingoSubtitle').textContent = `Another 5 in a row! +10,000 bonus tokens. That's ${bingoCount} breakthroughs and counting!`;
        }
        document.getElementById('bingoOverlay').classList.add('show');
        playBingoSound();
        launchConfetti();
    }

    function closeBingo() {
        document.getElementById('bingoOverlay').classList.remove('show');
    }

    // ===== Confetti =====
    function launchConfetti() {
        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Lightbulb-themed colors
        const colors = ['#BFD731', '#F59E0B', '#008AB0', '#FFD700', '#ffffff', '#FCD34D'];
        const particles = [];

        for (let i = 0; i < 150; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                w: Math.random() * 8 + 4,
                h: Math.random() * 4 + 2,
                color: colors[Math.floor(Math.random() * colors.length)],
                vx: (Math.random() - 0.5) * 4,
                vy: Math.random() * 3 + 2,
                rotation: Math.random() * 360,
                rotSpeed: (Math.random() - 0.5) * 10
            });
        }

        let frame = 0;
        const maxFrames = 180;

        function animate() {
            if (frame > maxFrames) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate((p.rotation * Math.PI) / 180);
                ctx.fillStyle = p.color;
                ctx.globalAlpha = Math.max(0, 1 - frame / maxFrames);
                ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                ctx.restore();
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.05;
                p.rotation += p.rotSpeed;
            });
            frame++;
            requestAnimationFrame(animate);
        }

        animate();
    }

    // ===== Share Card =====
    async function shareCard() {
        try {
            const canvas = document.createElement('canvas');
            const scale = 2;
            const cellSize = 100;
            const gap = 6;
            const padding = 24;
            const headerHeight = 70;
            const gridSize = cellSize * 5 + gap * 4;
            const totalW = gridSize + padding * 2;
            const totalH = gridSize + padding * 2 + headerHeight;

            canvas.width = totalW * scale;
            canvas.height = totalH * scale;
            const ctx = canvas.getContext('2d');
            ctx.scale(scale, scale);

            // Background
            ctx.fillStyle = isDarkMode ? '#1a2744' : '#ffffff';
            ctx.beginPath();
            ctx.roundRect(0, 0, totalW, totalH, 16);
            ctx.fill();

            // Header
            ctx.fillStyle = isDarkMode ? '#FAF9F6' : '#0B2340';
            ctx.font = 'bold 16px Barlow, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('\u{1F4A1} Aha Moment Bingo', totalW / 2, 26);
            ctx.fillStyle = '#008AB0';
            ctx.font = '10px Barlow, sans-serif';
            ctx.fillText('CSI Revenue Signals \u2022 Denver Accelerator', totalW / 2, 42);
            ctx.font = '11px Barlow, sans-serif';
            ctx.fillText(`Card #${cardSeed}  \u2022  ${markedCells.size}/25 lightbulbs`, totalW / 2, 58);

            // Draw cells
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const idx = row * 5 + col;
                    const item = currentCard[idx];
                    const x = padding + col * (cellSize + gap);
                    const y = headerHeight + padding + row * (cellSize + gap);
                    const isMarked = markedCells.has(idx);

                    // Cell background
                    if (item.isFree || isMarked) {
                        ctx.fillStyle = isDarkMode ? '#4a6b0a' : '#BFD731';
                    } else {
                        ctx.fillStyle = isDarkMode ? '#1e2d4a' : '#ffffff';
                    }
                    ctx.beginPath();
                    ctx.roundRect(x, y, cellSize, cellSize, 6);
                    ctx.fill();

                    // Cell border
                    ctx.strokeStyle = isMarked || item.isFree
                        ? (isDarkMode ? '#4a6b0a' : '#BFD731')
                        : (isDarkMode ? '#2a3f66' : '#0B2340');
                    ctx.lineWidth = 1.5;
                    ctx.stroke();

                    // Track dot
                    if (!item.isFree) {
                        ctx.fillStyle = TRACK_COLORS[item.track] || TRACK_COLORS.general;
                        ctx.beginPath();
                        ctx.arc(x + 7, y + 7, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // Lightbulb for marked cells
                    if (isMarked && !item.isFree) {
                        ctx.font = '20px sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('\u{1F4A1}', x + cellSize - 12, y + 16);
                    }

                    // Text
                    ctx.fillStyle = isMarked || item.isFree
                        ? (isDarkMode ? '#FAF9F6' : '#0B2340')
                        : (isDarkMode ? '#FAF9F6' : '#0B2340');
                    ctx.font = item.isFree ? 'bold 11px Barlow, sans-serif' : '9px Barlow, sans-serif';
                    ctx.textAlign = 'center';
                    wrapText(ctx, item.aha, x + cellSize / 2, y + (item.isFree ? 46 : 38), cellSize - 14, 11);
                }
            }

            // Footer
            ctx.fillStyle = isDarkMode ? '#6b7280' : '#9ca3af';
            ctx.font = '9px Barlow, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Volaris Business Transformation \u2022 Progress Over Perfection', totalW / 2, totalH - 6);

            // Copy to clipboard
            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
            if (navigator.clipboard && window.ClipboardItem) {
                await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                showToast('Copied to clipboard!');
            } else {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `aha-bingo-${cardSeed}.png`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('Image downloaded!');
            }
        } catch (err) {
            console.error('Share failed:', err);
            showToast('Could not share card');
        }
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let lines = [];

        for (const word of words) {
            const test = line + (line ? ' ' : '') + word;
            if (ctx.measureText(test).width > maxWidth && line) {
                lines.push(line);
                line = word;
            } else {
                line = test;
            }
        }
        lines.push(line);

        const startY = y - ((lines.length - 1) * lineHeight) / 2;
        lines.forEach((l, i) => {
            ctx.fillText(l, x, startY + i * lineHeight);
        });
    }

    // ===== Toast =====
    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // ===== Start =====
    init();
    </script>
</body>
</html>
