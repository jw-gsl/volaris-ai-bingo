<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSI Accelerator â€” Denver 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ===== CSS Custom Properties ===== */
        :root {
            --navy: #0B2340;
            --lime: #BFD731;
            --teal: #008AB0;
            --dark-gray: #464646;
            --off-white: #FAF9F6;
            --white: #ffffff;
            --amber: #F59E0B;
            --bg: var(--off-white);
            --card-bg: var(--white);
            --text: var(--dark-gray);
            --heading: var(--navy);
            --cell-bg: var(--white);
            --cell-border: var(--navy);
            --cell-text: var(--navy);
            --marked-bg: var(--lime);
            --marked-text: var(--navy);
            --free-bg: var(--lime);
            --overlay-bg: rgba(11, 35, 64, 0.92);
            --shadow: rgba(11, 35, 64, 0.12);
            --shadow-strong: rgba(11, 35, 64, 0.25);
            --toast-bg: var(--navy);
            --toast-text: var(--white);
            --toggle-bg: #d1d5db;
            --toggle-active: var(--teal);
            --footer-bg: rgba(11, 35, 64, 0.06);
            --footer-text: var(--dark-gray);
            --insight-bg: var(--navy);
            --insight-text: var(--white);
            --bingo-row-glow: rgba(191, 215, 49, 0.5);
            --track-leadership: #F59E0B;
            --track-product: #008AB0;
            --track-rnd: #BFD731;
            --track-general: #9CA3AF;
        }

        [data-theme="dark"] {
            --bg: #0f1729;
            --card-bg: #1a2744;
            --text: #d1d5db;
            --heading: var(--off-white);
            --cell-bg: #1e2d4a;
            --cell-border: #2a3f66;
            --cell-text: var(--off-white);
            --marked-bg: #4a6b0a;
            --marked-text: var(--off-white);
            --free-bg: #4a6b0a;
            --overlay-bg: rgba(15, 23, 41, 0.95);
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-strong: rgba(0, 0, 0, 0.5);
            --toast-bg: var(--lime);
            --toast-text: var(--navy);
            --toggle-bg: #374151;
            --footer-bg: rgba(255, 255, 255, 0.05);
            --footer-text: #9ca3af;
            --insight-bg: #0d1b30;
            --insight-text: var(--off-white);
            --bingo-row-glow: rgba(191, 215, 49, 0.3);
        }

        /* ===== Reset & Base ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Barlow', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }

        /* Denver mountain range - dramatic layered background */
        body::before {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100vh;
            background:
                /* Stars in sky (dark mode enhanced) */
                radial-gradient(1px 1px at 10% 15%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 25% 8%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1.5px 1.5px at 40% 20%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 55% 12%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 70% 5%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1.5px 1.5px at 85% 18%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 15% 25%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 62% 22%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1px 1px at 92% 10%, var(--star-color) 50%, transparent 100%),
                radial-gradient(1.5px 1.5px at 48% 3%, var(--star-color) 50%, transparent 100%),
                /* Sky gradient */
                var(--sky-gradient);
            pointer-events: none;
            z-index: 0;
        }

        /* Mountain SVG layer - sits on top of sky */
        body::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 45vh;
            background: var(--mountain-scene);
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: bottom center;
            pointer-events: none;
            z-index: 0;
        }

        :root {
            --star-color: transparent;
            --sky-gradient: linear-gradient(180deg, transparent 0%, rgba(11, 35, 64, 0.02) 60%, rgba(11, 35, 64, 0.06) 100%);
            --mountain-scene: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 400' preserveAspectRatio='none'%3E%3Cdefs%3E%3ClinearGradient id='mfar' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%230B2340' stop-opacity='0.08'/%3E%3Cstop offset='100%25' stop-color='%230B2340' stop-opacity='0.12'/%3E%3C/linearGradient%3E%3ClinearGradient id='mmid' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%230B2340' stop-opacity='0.12'/%3E%3Cstop offset='100%25' stop-color='%230B2340' stop-opacity='0.18'/%3E%3C/linearGradient%3E%3ClinearGradient id='mnear' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%230B2340' stop-opacity='0.18'/%3E%3Cstop offset='100%25' stop-color='%230B2340' stop-opacity='0.25'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M0,400 L0,180 L80,200 L160,120 L240,170 L320,80 L400,150 L480,60 L560,140 L640,90 L720,160 L800,50 L880,130 L960,70 L1040,140 L1120,100 L1200,160 L1280,110 L1360,150 L1440,120 L1440,400Z' fill='url(%23mfar)'/%3E%3Cpath d='M0,400 L0,240 L100,220 L200,180 L280,230 L380,160 L460,210 L540,150 L640,200 L720,170 L820,220 L920,160 L1000,200 L1100,180 L1200,220 L1300,190 L1440,210 L1440,400Z' fill='url(%23mmid)'/%3E%3Cpath d='M0,400 L0,300 L120,280 L240,300 L360,270 L480,290 L600,260 L720,285 L840,265 L960,290 L1080,275 L1200,295 L1320,280 L1440,290 L1440,400Z' fill='url(%23mnear)'/%3E%3Cpath d='M475,58 L480,60 L485,64' fill='none' stroke='white' stroke-width='2' opacity='0.25'/%3E%3Cpath d='M795,48 L800,50 L805,55' fill='none' stroke='white' stroke-width='2' opacity='0.25'/%3E%3Cpath d='M315,78 L320,80 L325,85' fill='none' stroke='white' stroke-width='2' opacity='0.25'/%3E%3Cpath d='M955,68 L960,70 L965,75' fill='none' stroke='white' stroke-width='2' opacity='0.25'/%3E%3Cpath d='M635,88 L640,90 L645,95' fill='none' stroke='white' stroke-width='2.5' opacity='0.2'/%3E%3Cpath d='M1115,98 L1120,100 L1125,105' fill='none' stroke='white' stroke-width='2' opacity='0.2'/%3E%3C/svg%3E");
        }

        [data-theme="dark"] {
            --star-color: rgba(255, 255, 255, 0.5);
            --sky-gradient: linear-gradient(180deg, transparent 0%, transparent 40%, rgba(15, 25, 50, 0.2) 65%, rgba(20, 35, 65, 0.4) 85%, rgba(15, 23, 41, 0.6) 100%);
            --mountain-scene: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 400' preserveAspectRatio='none'%3E%3Cdefs%3E%3ClinearGradient id='mfar' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%231a3050' stop-opacity='0.5'/%3E%3Cstop offset='100%25' stop-color='%23122040' stop-opacity='0.7'/%3E%3C/linearGradient%3E%3ClinearGradient id='mmid' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%23142838' stop-opacity='0.7'/%3E%3Cstop offset='100%25' stop-color='%230e1c2e' stop-opacity='0.85'/%3E%3C/linearGradient%3E%3ClinearGradient id='mnear' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%230f1e30' stop-opacity='0.85'/%3E%3Cstop offset='100%25' stop-color='%230a1420' stop-opacity='0.95'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M0,400 L0,180 L80,200 L160,120 L240,170 L320,80 L400,150 L480,60 L560,140 L640,90 L720,160 L800,50 L880,130 L960,70 L1040,140 L1120,100 L1200,160 L1280,110 L1360,150 L1440,120 L1440,400Z' fill='url(%23mfar)'/%3E%3Cpath d='M0,400 L0,240 L100,220 L200,180 L280,230 L380,160 L460,210 L540,150 L640,200 L720,170 L820,220 L920,160 L1000,200 L1100,180 L1200,220 L1300,190 L1440,210 L1440,400Z' fill='url(%23mmid)'/%3E%3Cpath d='M0,400 L0,300 L120,280 L240,300 L360,270 L480,290 L600,260 L720,285 L840,265 L960,290 L1080,275 L1200,295 L1320,280 L1440,290 L1440,400Z' fill='url(%23mnear)'/%3E%3Cpath d='M475,58 L480,60 L485,64' fill='none' stroke='%23E8F0FF' stroke-width='2' opacity='0.35'/%3E%3Cpath d='M795,48 L800,50 L805,55' fill='none' stroke='%23E8F0FF' stroke-width='2' opacity='0.35'/%3E%3Cpath d='M315,78 L320,80 L325,85' fill='none' stroke='%23E8F0FF' stroke-width='1.5' opacity='0.3'/%3E%3Cpath d='M955,68 L960,70 L965,75' fill='none' stroke='%23E8F0FF' stroke-width='2' opacity='0.35'/%3E%3Cpath d='M635,88 L640,90 L645,95' fill='none' stroke='%23E8F0FF' stroke-width='2.5' opacity='0.3'/%3E%3Cpath d='M1115,98 L1120,100 L1125,105' fill='none' stroke='%23E8F0FF' stroke-width='1.5' opacity='0.25'/%3E%3C/svg%3E");
        }

        /* ===== Layout ===== */
        .container {
            max-width: 820px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ===== Header ===== */
        .header {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-bottom: 0;
            padding: 12px 0 0;
        }

        .logo-area {
            margin-bottom: 0;
            text-align: left;
        }

        .logo-area img {
            height: 32px;
            width: auto;
            transition: filter 0.3s;
        }

        [data-theme="dark"] .logo-area img {
            filter: brightness(0) invert(1);
        }

        .logo-subtitle {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 4px;
        }

        .title {
            font-weight: 700;
            font-size: clamp(0.85rem, 2.5vw, 1.1rem);
            color: var(--teal);
            line-height: 1.2;
            margin-bottom: 12px;
            letter-spacing: 0;
            text-align: center;
        }

        .title .bulb {
            display: inline-block;
            animation: bulbPulse 2s ease-in-out infinite;
        }

        @keyframes bulbPulse {
            0%, 100% { filter: drop-shadow(0 0 4px rgba(245,158,11,0.4)); }
            50% { filter: drop-shadow(0 0 12px rgba(245,158,11,0.8)); transform: scale(1.1); }
        }

        /* Denver mountain header decoration */
        .mountain-header {
            width: 100vw;
            margin-left: calc(-50vw + 50%);
            max-height: 40px;
            overflow: hidden;
            margin-bottom: 12px;
            display: block;
            line-height: 0;
        }

        .mountain-header svg {
            width: 100%;
            height: auto;
            display: block;
        }

        [data-theme="dark"] .mountain-header .mtn-far {
            fill: #8ba4c4;
            opacity: 0.2;
        }

        [data-theme="dark"] .mountain-header .mtn-mid {
            fill: #6b8ab0;
            opacity: 0.3;
        }

        [data-theme="dark"] .mountain-header .mtn-near {
            fill: #4a6e96;
            opacity: 0.35;
        }

        [data-theme="dark"] .mountain-header svg path[fill="white"] {
            opacity: 0.85;
        }

        /* ===== Footer Settings ===== */
        .footer-settings {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 12px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .footer-settings:hover { opacity: 1; }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toggle-label {
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--text);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
        }

        .toggle-label.active {
            opacity: 1;
            color: var(--teal);
        }

        .toggle-switch {
            position: relative;
            width: 36px;
            height: 20px;
            cursor: pointer;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--toggle-bg);
            border-radius: 20px;
            transition: background 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            left: 2px;
            bottom: 2px;
            background: var(--white);
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--toggle-active);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(16px);
        }

        /* ===== Card Info Bar ===== */
        .card-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 0 2px;
        }

        .card-id {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text);
            opacity: 0.5;
            font-family: monospace;
        }

        .score {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--teal);
        }

        /* ===== Day indicator ===== */
        .day-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 14px;
        }

        .day-dot {
            padding: 6px 14px;
            border-radius: 20px;
            border: 2px solid var(--cell-border);
            background: var(--cell-bg);
            font-family: 'Barlow', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--cell-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.5;
            position: relative;
            overflow: hidden;
        }

        .day-dot:hover { transform: scale(1.05); opacity: 0.8; }
        .day-dot.active {
            background: var(--teal);
            border-color: var(--teal);
            color: var(--white);
            opacity: 1;
        }

        .day-dot.completed {
            background: var(--lime);
            border-color: var(--lime);
            color: var(--navy);
            opacity: 1;
        }

        .day-dot.locked {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Progress bar on day pills */
        .day-dot::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: calc(var(--day-progress, 0) * 1%);
            background: var(--lime);
            transition: width 0.3s ease;
            border-radius: 0 0 20px 20px;
        }
        .day-dot.active::after {
            background: rgba(255,255,255,0.6);
        }

        .day-journal-btn {
            margin-left: 8px;
            padding: 6px 14px !important;
            font-size: 0.75rem !important;
            border-radius: 20px !important;
        }

        /* ===== Welcome Overlay ===== */
        .welcome-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: var(--bg);
            align-items: center;
            justify-content: center;
            padding: 16px;
            overflow-y: auto;
        }
        .welcome-overlay.show { display: flex; }
        .welcome-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 40px 36px 36px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 12px 60px var(--shadow-strong);
            text-align: center;
            margin: auto;
        }
        .welcome-logo { margin-bottom: 20px; }
        .welcome-logo img { height: 32px; width: auto; opacity: 0.85; }
        [data-theme="dark"] .welcome-logo img { filter: brightness(0) invert(1); }
        .welcome-title {
            font-weight: 900;
            font-size: 1.65rem;
            color: var(--heading);
            margin-bottom: 6px;
            line-height: 1.15;
        }
        .welcome-subtitle {
            font-size: 0.78rem;
            color: var(--teal);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0;
        }
        .welcome-divider {
            width: 40px;
            height: 3px;
            background: var(--lime);
            border-radius: 2px;
            margin: 16px auto 20px;
        }
        .welcome-desc {
            font-size: 0.92rem;
            color: var(--text);
            line-height: 1.65;
            margin-bottom: 28px;
            opacity: 0.8;
        }
        .welcome-field {
            text-align: left;
            margin-bottom: 16px;
        }
        .welcome-field label {
            display: block;
            font-size: 0.72rem;
            font-weight: 700;
            color: var(--heading);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            opacity: 0.7;
        }
        .welcome-field input,
        .welcome-field select {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid rgba(11,35,64,0.15);
            border-radius: 12px;
            background: var(--cell-bg);
            color: var(--cell-text);
            font-family: 'Barlow', sans-serif;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .welcome-field input:focus,
        .welcome-field select:focus {
            outline: none;
            border-color: var(--teal);
            box-shadow: 0 0 0 3px rgba(0,138,176,0.12);
        }
        .welcome-submit {
            width: 100%;
            padding: 15px;
            margin-top: 8px;
            border: none;
            border-radius: 14px;
            background: var(--navy);
            color: var(--white);
            font-family: 'Barlow', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 0.3px;
            transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
        }
        .welcome-submit:hover {
            background: var(--teal);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,138,176,0.35);
        }

        /* User greeting near card info */
        .user-greeting {
            font-size: 0.78rem;
            color: var(--text);
            opacity: 0.7;
        }
        .user-greeting a {
            color: var(--teal);
            text-decoration: none;
            cursor: pointer;
            font-weight: 600;
        }
        .user-greeting a:hover { text-decoration: underline; }

        /* ===== Landing Overlay ===== */
        .landing-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: var(--bg);
            align-items: flex-start;
            justify-content: center;
            padding: 16px;
            overflow-y: auto;
        }
        .landing-overlay.show { display: flex; }
        .landing-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 40px 36px 32px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 12px 60px var(--shadow-strong);
            text-align: center;
            margin: auto;
        }
        .landing-greeting {
            font-weight: 900;
            font-size: 1.75rem;
            color: var(--heading);
            margin-bottom: 6px;
        }
        .landing-event-name {
            font-size: 0.72rem;
            font-weight: 700;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 2.5px;
            margin-bottom: 0;
        }
        .landing-divider {
            width: 40px;
            height: 3px;
            background: var(--lime);
            border-radius: 2px;
            margin: 16px auto 18px;
        }
        .landing-desc {
            font-size: 0.92rem;
            color: var(--text);
            opacity: 0.82;
            line-height: 1.7;
            margin-bottom: 20px;
        }
        .landing-status {
            background: var(--navy);
            color: var(--white);
            border-radius: 14px;
            padding: 14px 20px;
            font-size: 0.88rem;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: 0.2px;
        }
        [data-theme="dark"] .landing-status {
            background: rgba(191, 215, 49, 0.12);
            border: 1px solid rgba(191, 215, 49, 0.3);
        }
        .landing-date-highlight {
            color: var(--lime);
            font-weight: 800;
        }
        .landing-agenda {
            text-align: left;
            background: var(--bg);
            border: 1px solid rgba(11,35,64,0.08);
            border-radius: 14px;
            padding: 18px 20px;
            margin-bottom: 12px;
            font-size: 0.85rem;
            color: var(--text);
        }
        .landing-agenda-title {
            font-size: 0.68rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--heading);
            opacity: 0.45;
            margin-bottom: 14px;
        }
        .landing-day-row {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(11,35,64,0.07);
        }
        .landing-day-row:last-child { border-bottom: none; padding-bottom: 0; }
        .landing-day-number {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--navy);
            color: var(--lime);
            font-size: 0.7rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1px;
            letter-spacing: 0;
        }
        .landing-day-content { flex: 1; min-width: 0; }
        .landing-day-label { font-size: 0.72rem; font-weight: 700; color: var(--teal); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
        .landing-day-theme { font-size: 0.95rem; font-weight: 800; color: var(--heading); margin-bottom: 2px; }
        .landing-day-desc { font-size: 0.8rem; color: var(--text); opacity: 0.65; line-height: 1.4; }
        .landing-logistics-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.86rem;
            border-bottom: 1px solid rgba(11,35,64,0.07);
            line-height: 1.4;
        }
        .landing-logistics-row:last-child { border-bottom: none; padding-bottom: 0; }
        .landing-logistics-icon { flex-shrink: 0; width: 20px; text-align: center; margin-top: 1px; }
        .landing-change-link {
            display: inline-block;
            font-size: 0.78rem;
            color: var(--teal);
            text-decoration: none;
            cursor: pointer;
            font-weight: 600;
            margin-top: 4px;
        }
        .landing-change-link:hover { text-decoration: underline; }

        /* ===== Wizard Steps ===== */
        .wizard-progress { margin-bottom: 28px; }
        .step-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 8px;
        }
        .step-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--cell-border);
            opacity: 0.2;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .step-dot.active {
            background: var(--teal);
            opacity: 1;
            width: 22px;
            border-radius: 4px;
        }
        .step-dot.done {
            background: var(--lime);
            opacity: 1;
            width: 7px;
            border-radius: 50%;
        }
        .wizard-step-label {
            font-size: 0.68rem;
            font-weight: 700;
            color: var(--text);
            opacity: 0.4;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }
        .wizard-step { display: none; }
        .wizard-step.active {
            display: block;
            animation: wsFadeIn 0.28s ease;
        }
        @keyframes wsFadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .wizard-step-heading {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--heading);
            text-align: left;
            margin-bottom: 4px;
            line-height: 1.25;
        }
        .wizard-nav {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        .wizard-back {
            flex: 0 0 auto;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(11,35,64,0.15);
            border-radius: 50%;
            background: transparent;
            color: var(--text);
            font-family: 'Barlow', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.2s, color 0.2s;
        }
        .wizard-back:hover { border-color: var(--teal); color: var(--teal); }
        .wizard-next {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 14px;
            background: var(--navy);
            color: var(--white);
            font-family: 'Barlow', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 0.3px;
            transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
        }
        .wizard-next:hover { background: var(--teal); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,138,176,0.35); }
        .wizard-next:disabled { opacity: 0.45; cursor: not-allowed; transform: none; box-shadow: none; }

        /* ===== Radio Cards ===== */
        .radio-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 12px 0;
            text-align: left;
        }
        .radio-cards-single {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 12px 0;
        }
        .radio-card { position: relative; cursor: pointer; }
        .radio-card input { position: absolute; opacity: 0; width: 0; height: 0; }
        .radio-card-body {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 13px 15px;
            border: 2px solid rgba(11,35,64,0.12);
            border-radius: 12px;
            background: var(--cell-bg);
            color: var(--cell-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.88rem;
            font-weight: 600;
            line-height: 1.3;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
            user-select: none;
        }
        .radio-card input:checked + .radio-card-body {
            border-color: var(--teal);
            background: rgba(0,138,176,0.08);
            color: var(--teal);
            box-shadow: 0 0 0 3px rgba(0,138,176,0.1);
        }
        .radio-card-body:hover { border-color: var(--teal); }
        .radio-card-icon {
            font-size: 1.4rem;
            flex-shrink: 0;
            line-height: 1;
        }
        /* Level cards stay centered */
        .radio-cards-level .radio-card-body {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 8px;
            text-align: center;
        }
        .level-dot {
            display: block;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .level-dot-0 { background: #7A7E8A; }
        .level-dot-1 { background: #4A7FA8; }
        .level-dot-2 { background: #2B5F96; }
        .level-dot-3 { background: #2D6B1A; }
        .diag-question {
            font-size: 1rem;
            font-weight: 800;
            color: var(--heading);
            margin-bottom: 3px;
            text-align: left;
            line-height: 1.3;
        }
        .diag-hint {
            font-size: 0.78rem;
            color: var(--text);
            opacity: 0.55;
            text-align: left;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        .diag-textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid rgba(11,35,64,0.12);
            border-radius: 14px;
            background: var(--cell-bg);
            color: var(--cell-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
            min-height: 160px;
            margin-bottom: 0;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .diag-textarea:focus {
            outline: none;
            border-color: var(--teal);
            box-shadow: 0 0 0 3px rgba(0,138,176,0.12);
        }
        .wizard-lookup-status {
            font-size: 0.8rem;
            color: var(--teal);
            min-height: 18px;
            font-weight: 600;
            margin-top: 8px;
        }

        /* ===== Bingo Card ===== */
        .bingo-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 24px var(--shadow), 0 1px 4px var(--shadow);
            transition: background 0.3s ease;
        }

        /* Card + Side Panel layout */
        .card-layout {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            transition: max-width 0.4s ease;
        }

        .card-layout .bingo-card {
            flex: 1 1 auto;
            min-width: 0;
            transition: flex 0.4s ease;
        }

        .side-panel {
            display: none;
            flex: 0 0 340px;
            background: var(--insight-bg);
            border-radius: 16px;
            padding: 24px 20px;
            border: 1px solid rgba(191, 215, 49, 0.2);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: slideInRight 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            max-height: 80vh;
            overflow-y: auto;
        }

        .side-panel.show {
            display: block;
        }

        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(40px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .side-panel-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: var(--insight-text);
            font-size: 1.4rem;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
            line-height: 1;
        }

        .side-panel-close:hover { opacity: 1; }

        .side-panel .insight-track-badge {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 3px 12px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .side-panel-aha {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            opacity: 0.8;
            line-height: 1.3;
        }

        .side-panel-insight {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--insight-text);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .side-panel-source {
            font-size: 0.7rem;
            color: var(--teal);
            font-style: italic;
            margin-bottom: 14px;
        }

        .side-panel-journal {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .side-panel-journal textarea {
            width: 100%;
            min-height: 100px;
            border-radius: 8px;
            border: 1px solid rgba(191, 215, 49, 0.3);
            background: rgba(255, 255, 255, 0.06);
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            padding: 10px;
            resize: vertical;
        }

        .side-panel-journal textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .side-panel-journal textarea:focus {
            outline: 2px solid var(--lime);
            outline-offset: 1px;
        }

        .side-panel-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 12px;
        }

        .side-panel-saved {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--lime);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .side-panel-saved.show { opacity: 1; }

        .side-panel-gotit {
            background: var(--lime);
            color: var(--navy);
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-family: 'Barlow', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.15s;
        }

        .side-panel-gotit:hover { transform: scale(1.05); }

        .side-panel-share {
            background: rgba(255,255,255,0.1);
            color: var(--insight-text);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .side-panel-share:hover { opacity: 0.8; }

        /* When side panel is open, widen the container */
        .container.panel-open {
            max-width: 1200px;
        }

        /* On small screens, stack vertically */
        @media (max-width: 900px) {
            .card-layout {
                flex-direction: column;
            }
            .side-panel {
                flex: none;
                width: 100%;
                max-height: none;
            }
            .container.panel-open {
                max-width: 820px;
            }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        /* ===== Bingo Cell ===== */
        .cell {
            aspect-ratio: 1 / 1.15;
            border: 2px solid var(--cell-border);
            border-radius: 8px;
            background: var(--cell-bg);
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 6px;
            text-align: center;
            transition: transform 0.15s ease, background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            user-select: none;
            outline: none;
        }

        .cell:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .cell:active {
            transform: scale(0.97);
        }

        .cell:focus-visible {
            outline: 3px solid var(--teal);
            outline-offset: 2px;
        }

        .cell .aha-text {
            font-size: clamp(0.58rem, 1.7vw, 0.88rem);
            font-weight: 600;
            color: var(--cell-text);
            line-height: 1.25;
            z-index: 2;
            transition: opacity 0.3s ease;
            word-break: break-word;
            hyphens: auto;
        }

        /* Track indicator dot */
        .cell .track-dot {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 3;
            opacity: 0.7;
        }

        .cell.marked .track-dot { opacity: 0.5; }

        /* Marked state */
        .cell.marked {
            background: var(--marked-bg);
            border-color: var(--marked-bg);
        }

        .cell.marked .aha-text {
            color: var(--marked-text);
        }

        .cell.marked .bulb-icon {
            opacity: 1;
        }

        /* Bulb stamp animation */
        .cell.stamp-animate {
            animation: stampPop 0.35s ease;
        }

        @keyframes stampPop {
            0% { transform: scale(1); }
            30% { transform: scale(0.88); }
            60% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .bulb-icon {
            position: absolute;
            top: 2px;
            right: 3px;
            width: 16px;
            height: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 3;
            font-size: 12px;
            line-height: 1;
        }

        /* Info button */
        .info-btn {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: none;
            background: var(--teal);
            color: var(--white);
            font-family: 'Barlow', sans-serif;
            font-size: 0.6rem;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.5;
            transition: opacity 0.2s, transform 0.15s;
            z-index: 5;
            padding: 0;
            line-height: 1;
        }

        .info-btn:hover, .info-btn:focus-visible {
            opacity: 1;
            transform: scale(1.15);
        }

        .cell.marked .info-btn {
            background: var(--navy);
            color: var(--white);
            opacity: 0.6;
        }

        .cell.marked .info-btn:hover {
            opacity: 1;
        }

        /* Free space */
        .cell.free-space {
            background: var(--free-bg);
            border-color: var(--free-bg);
        }

        .cell.free-space .aha-text {
            font-weight: 800;
            color: var(--navy);
        }

        [data-theme="dark"] .cell.free-space .aha-text {
            color: var(--off-white);
        }

        .cell.free-space .info-btn {
            display: none;
        }

        .cell.free-space .track-dot {
            display: none;
        }

        /* Bingo row highlight */
        .cell.bingo-cell {
            box-shadow: 0 0 12px var(--bingo-row-glow), 0 0 24px var(--bingo-row-glow);
            animation: bingoGlow 1.5s ease-in-out infinite alternate;
        }

        @keyframes bingoGlow {
            from { box-shadow: 0 0 8px var(--bingo-row-glow); }
            to { box-shadow: 0 0 20px var(--bingo-row-glow), 0 0 40px var(--bingo-row-glow); }
        }

        /* ===== In-Grid Expanded Cell ===== */
        .cell-expanded {
            grid-column: 1 / -1;
            background: var(--insight-bg);
            border-radius: 12px;
            padding: 24px 20px;
            text-align: center;
            border: 2px solid rgba(191, 215, 49, 0.25);
            animation: gridExpand 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        @keyframes gridExpand {
            0% { opacity: 0; transform: scaleY(0.3); max-height: 0; }
            60% { opacity: 1; }
            100% { transform: scaleY(1); max-height: 600px; }
        }

        .cell-expanded .expanded-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: var(--insight-text);
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .cell-expanded .expanded-close:hover { opacity: 1; }

        .cell-expanded .insight-track-badge {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 3px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .cell-expanded .expanded-aha {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .cell-expanded .expanded-insight {
            font-size: 1rem;
            font-weight: 500;
            color: var(--insight-text);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .cell-expanded .expanded-source {
            font-size: 0.7rem;
            color: var(--teal);
            font-style: italic;
            margin-bottom: 12px;
        }

        .cell-expanded .expanded-journal {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .cell-expanded .expanded-journal textarea {
            width: 100%;
            min-height: 70px;
            border-radius: 8px;
            border: 1px solid rgba(191, 215, 49, 0.3);
            background: rgba(255, 255, 255, 0.06);
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            padding: 10px;
            resize: vertical;
        }

        .cell-expanded .expanded-journal textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .cell-expanded .expanded-journal textarea:focus {
            outline: 2px solid var(--lime);
            outline-offset: 1px;
        }

        .cell-expanded .expanded-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .cell-expanded .expanded-gotit {
            background: var(--lime);
            color: var(--navy);
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-family: 'Barlow', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.15s, background 0.2s;
        }

        .cell-expanded .expanded-gotit:hover { transform: scale(1.05); }

        .cell-expanded .expanded-saved {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--lime);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .cell-expanded .expanded-saved.show { opacity: 1; }

        /* Legacy overlay - keep for info button click */
        .insight-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .insight-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .insight-card {
            background: var(--insight-bg);
            border-radius: 16px;
            padding: 28px 24px;
            max-width: 480px;
            width: 100%;
            text-align: center;
            position: relative;
            border: 1px solid rgba(191, 215, 49, 0.15);
        }

        .journal-bonus-hint {
            background: rgba(191, 215, 49, 0.12);
            border: 1px dashed rgba(191, 215, 49, 0.4);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--lime);
            text-align: center;
        }

        .journal-bonus-hint .bonus-amount {
            font-family: monospace;
            font-size: 0.85rem;
            font-weight: 800;
        }

        .journal-char-count {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--teal);
            text-align: right;
            margin-top: 4px;
            opacity: 0.8;
            transition: color 0.3s;
        }

        .journal-char-count.multiplier-2x { color: #BFD731; }
        .journal-char-count.multiplier-3x { color: #F59E0B; }
        .journal-char-count.multiplier-5x { color: #EF4444; font-weight: 800; }

        .insight-track-badge {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 3px 12px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .insight-aha {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            opacity: 0.8;
        }

        .insight-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--insight-text);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .insight-source {
            font-size: 0.75rem;
            color: var(--insight-text);
            opacity: 0.5;
            font-style: italic;
            margin-bottom: 20px;
        }

        .insight-close {
            background: var(--lime);
            color: var(--navy);
            border: none;
            padding: 10px 28px;
            border-radius: 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .insight-close:hover {
            opacity: 0.85;
        }

        /* ===== Journal Note in Insight Modal ===== */
        .journal-section {
            margin-top: 16px;
            margin-bottom: 16px;
            text-align: left;
        }

        .journal-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--lime);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .journal-textarea {
            width: 100%;
            min-height: 60px;
            background: rgba(255,255,255,0.08);
            border: 1.5px solid rgba(191, 215, 49, 0.3);
            border-radius: 8px;
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            padding: 10px;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }

        .journal-textarea:focus {
            border-color: var(--lime);
        }

        .journal-textarea::placeholder {
            color: rgba(255,255,255,0.3);
            font-style: italic;
        }

        .journal-saved {
            font-size: 0.65rem;
            color: var(--lime);
            opacity: 0;
            transition: opacity 0.3s;
            margin-top: 4px;
        }

        .journal-saved.show {
            opacity: 0.7;
        }

        /* ===== Token Counter ===== */
        .token-counter {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--amber);
        }

        .token-counter .token-icon {
            font-size: 1rem;
        }

        .token-count {
            font-family: monospace;
            font-size: 0.9rem;
        }

        /* ===== Journal Export Button ===== */
        .btn-journal {
            background: var(--amber);
            color: var(--navy);
        }

        /* ===== Journal View Overlay ===== */
        .journal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 150;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            animation: fadeIn 0.2s ease;
        }

        .journal-overlay.show {
            display: flex;
        }

        .journal-view {
            background: var(--insight-bg);
            border-radius: 16px;
            padding: 32px;
            max-width: 560px;
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
            animation: slideUp 0.3s ease;
        }

        .journal-view h2 {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--lime);
            margin-bottom: 4px;
            text-align: center;
        }

        .journal-view .journal-subtitle {
            font-size: 0.75rem;
            color: var(--insight-text);
            opacity: 0.5;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Journal stats banner */
        .journal-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .journal-stat {
            text-align: center;
            background: rgba(255,255,255,0.06);
            border-radius: 10px;
            padding: 12px 6px;
        }
        .journal-stat-value {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--lime);
        }
        .journal-stat-label {
            font-size: 0.62rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--insight-text);
            opacity: 0.5;
            margin-top: 2px;
        }

        /* Journal day sections */
        .journal-day-section {
            margin-bottom: 16px;
        }
        .journal-day-header {
            font-size: 0.78rem;
            font-weight: 800;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 8px;
        }

        .journal-entry {
            border-bottom: 1px solid rgba(255,255,255,0.06);
            padding: 12px 0;
            position: relative;
        }

        .journal-entry:last-child {
            border-bottom: none;
        }

        .journal-entry-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .journal-entry-aha {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--lime);
            flex: 1;
        }

        .journal-entry-time {
            font-size: 0.65rem;
            color: var(--insight-text);
            opacity: 0.4;
            white-space: nowrap;
        }

        .journal-entry-track {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 2px 8px;
            border-radius: 8px;
            margin-bottom: 6px;
        }

        .journal-entry-note {
            font-size: 0.9rem;
            color: var(--insight-text);
            line-height: 1.5;
            opacity: 0.9;
        }

        /* Inline edit textarea */
        .journal-entry-edit {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--teal);
            border-radius: 8px;
            background: rgba(255,255,255,0.06);
            color: var(--insight-text);
            font-family: 'Barlow', sans-serif;
            font-size: 0.88rem;
            resize: vertical;
            min-height: 60px;
        }
        .journal-entry-edit:focus { outline: none; border-color: var(--lime); }

        /* Entry action buttons */
        .journal-entry-actions {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }
        .journal-entry-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.78rem;
            padding: 2px 6px;
            border-radius: 4px;
            opacity: 0.5;
            transition: opacity 0.15s;
            color: var(--insight-text);
        }
        .journal-entry-actions button:hover { opacity: 1; }
        .journal-entry-actions .je-delete:hover { color: #EF4444; }

        .journal-empty {
            text-align: center;
            color: var(--insight-text);
            opacity: 0.4;
            font-style: italic;
            padding: 32px 0;
        }

        .journal-footer {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .journal-close, .journal-export {
            background: var(--lime);
            color: var(--navy);
            border: none;
            padding: 10px 28px;
            border-radius: 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .journal-export {
            background: rgba(255,255,255,0.1);
            color: var(--insight-text);
        }

        .journal-close:hover, .journal-export:hover {
            opacity: 0.85;
        }

        /* ===== Action Buttons ===== */
        .actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .btn {
            font-family: 'Barlow', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s ease, opacity 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover { opacity: 0.88; }
        .btn:active { transform: scale(0.96); }

        .btn-primary {
            background: var(--teal);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--navy);
            color: var(--white);
        }

        .btn-accent {
            background: var(--lime);
            color: var(--navy);
        }

        /* ===== BINGO Celebration Overlay ===== */
        .bingo-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--overlay-bg);
            z-index: 200;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
            animation: fadeIn 0.3s ease;
        }

        .bingo-overlay.show {
            display: flex;
        }

        .bingo-title {
            font-size: clamp(3rem, 12vw, 6rem);
            font-weight: 900;
            color: var(--lime);
            letter-spacing: 4px;
            text-shadow: 0 4px 20px rgba(191, 215, 49, 0.4);
            animation: bingoPop 0.6s ease;
            text-align: center;
            line-height: 1.1;
        }

        .bingo-subtitle {
            font-size: 1.1rem;
            color: var(--off-white);
            opacity: 0.8;
            text-align: center;
            max-width: 400px;
            padding: 0 20px;
        }

        .bingo-overlay .btn {
            margin-top: 8px;
        }

        @keyframes bingoPop {
            0% { transform: scale(0.3); opacity: 0; }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ===== Confetti Canvas ===== */
        #confettiCanvas {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 210;
        }

        /* ===== Toast ===== */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: var(--toast-bg);
            color: var(--toast-text);
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 300;
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            pointer-events: none;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ===== Footer / Attribution ===== */
        .footer {
            margin-top: 24px;
            padding: 16px;
            background: var(--footer-bg);
            border-radius: 12px;
            text-align: center;
        }

        .footer-primary {
            font-size: 0.78rem;
            color: var(--footer-text);
            line-height: 1.6;
            margin-bottom: 6px;
        }

        .footer-secondary {
            font-size: 0.68rem;
            color: var(--footer-text);
            opacity: 0.6;
            line-height: 1.6;
        }

        .footer strong {
            font-weight: 700;
        }

        .how-to-play {
            font-size: 0.75rem;
            color: var(--text);
            opacity: 0.7;
            margin-top: 12px;
            line-height: 1.5;
            text-align: center;
        }

        .how-to-play strong {
            color: var(--teal);
        }

        /* ===== Mute Button ===== */
        .mute-btn {
            background: none;
            border: 1.5px solid var(--cell-border);
            border-radius: 6px;
            padding: 3px 8px;
            font-family: 'Barlow', sans-serif;
            font-size: 0.72rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .mute-btn:hover { opacity: 1; }

        .mute-btn .mute-icon {
            font-size: 0.85rem;
            line-height: 1;
        }

        /* ===== Animations ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.4s ease; }
        .slide-down { animation: slideDown 0.4s ease; }

        /* ===== Responsive ===== */
        @media (max-width: 520px) {
            body { padding: 10px; }
            .bingo-card { padding: 8px; }
            .grid { gap: 4px; }
            .cell { padding: 4px 3px; border-width: 1.5px; border-radius: 5px; }
            .cell .aha-text { font-size: clamp(0.48rem, 2.8vw, 0.65rem); line-height: 1.2; }
            .cell .track-dot { width: 5px; height: 5px; top: 2px; left: 2px; }
            .actions { gap: 6px; }
            .btn { padding: 8px 14px; font-size: 0.72rem; }
            .bulb-icon { width: 12px; height: 12px; font-size: 10px; top: 1px; right: 1px; }
            .info-btn { width: 15px; height: 15px; font-size: 0.5rem; bottom: 1px; right: 1px; }
            .day-dot { padding: 4px 10px; font-size: 0.65rem; }
            .day-journal-btn { padding: 4px 10px !important; font-size: 0.65rem !important; }
            .header { flex-direction: column; align-items: center; text-align: center; }
            .logo-area { text-align: center; }
            .mountain-header { max-height: 30px; }
            .title { font-size: 1rem; }
        }

        @media (min-width: 521px) and (max-width: 768px) {
            .cell .aha-text { font-size: clamp(0.55rem, 1.7vw, 0.8rem); }
        }

        /* ===== Print ===== */
        @media print {
            body { background: white; }
            .actions, .how-to-play, .day-indicator, .footer-settings { display: none; }
            .bingo-card { box-shadow: none; border: 2px solid var(--navy); }
        }
    </style>
</head>
<body>
    <!-- Welcome / Diagnostic Wizard Overlay -->
    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-card">
            <div class="welcome-logo">
                <img src="https://www.volarisgroup.com/wp-content/uploads/2024/09/Logo-2.png" alt="Volaris Group" id="welcomeLogo">
            </div>
            <h1 class="welcome-title">CSI Accelerator &mdash; Denver 2026</h1>
            <p class="welcome-subtitle">March 3&ndash;6 &middot; Denver, CO</p>
            <div class="welcome-divider"></div>

            <!-- Step progress indicator (hidden on step 0) -->
            <div class="wizard-progress" id="wizardProgress" style="display:none">
                <div class="step-dots">
                    <span class="step-dot active" id="sdot0"></span>
                    <span class="step-dot" id="sdot1"></span>
                    <span class="step-dot" id="sdot2"></span>
                    <span class="step-dot" id="sdot3"></span>
                    <span class="step-dot" id="sdot4"></span>
                </div>
                <span class="wizard-step-label" id="wizardStepLabel">Step 1 of 5</span>
            </div>

            <!-- Step 0: Email lookup -->
            <div class="wizard-step active" id="wizardStep0">
                <p class="welcome-desc">This is your event companion for the week. We&rsquo;ll use your answers to personalise your experience and make the next four days as useful as possible.</p>
                <div class="welcome-field">
                    <label for="welcomeEmail">Email address</label>
                    <input type="email" id="welcomeEmail" placeholder="e.g. james@company.com" autocomplete="email"
                        onkeydown="if(event.key==='Enter'){event.preventDefault();submitEmail();}">
                </div>
                <p class="wizard-lookup-status" id="lookupStatus"></p>
                <button type="button" class="welcome-submit" onclick="submitEmail()">Continue &rarr;</button>
            </div>

            <!-- Step 1: Name + VBU + Q1 Role -->
            <div class="wizard-step" id="wizardStep1">
                <div class="welcome-field">
                    <label for="welcomeName">Your name</label>
                    <input type="text" id="welcomeName" placeholder="e.g. James Whiting" autocomplete="name">
                </div>
                <div class="welcome-field">
                    <label for="welcomeVbu">Business unit</label>
                    <select id="welcomeVbu">
                        <option value="" disabled selected>Select your VBU&hellip;</option>
                        <option value="AssetWorks Facilities">AssetWorks Facilities</option>
                        <option value="AssetWorks Fleet">AssetWorks Fleet</option>
                        <option value="Crealogix Code">Crealogix Code</option>
                        <option value="Data Action">Data Action</option>
                        <option value="Databasics">Databasics</option>
                        <option value="Equivant">Equivant</option>
                        <option value="Godfrey">Godfrey</option>
                        <option value="Helm Operations">Helm Operations</option>
                        <option value="Husk">Husk</option>
                        <option value="Intellicene">Intellicene</option>
                        <option value="InTempo">InTempo</option>
                        <option value="Medpatus">Medpatus</option>
                        <option value="Portfolio+">Portfolio+</option>
                        <option value="Sansio">Sansio</option>
                        <option value="Smartrak">Smartrak</option>
                        <option value="SpecTec">SpecTec</option>
                        <option value="SSP">SSP</option>
                        <option value="Volaris">Volaris</option>
                        <option value="Wellington IT">Wellington IT</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <p class="diag-question">What best describes your role?</p>
                <div class="radio-cards-single">
                    <label class="radio-card">
                        <input type="radio" name="diagRole" value="product">
                        <span class="radio-card-body"><span class="radio-card-icon">&#x1F4E6;</span>Product representative</span>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="diagRole" value="rnd">
                        <span class="radio-card-body"><span class="radio-card-icon">&#x1F9EA;</span>R&amp;D / Engineering</span>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="diagRole" value="leadership">
                        <span class="radio-card-body"><span class="radio-card-icon">&#x1F3AF;</span>Leader / GM</span>
                    </label>
                </div>
                <div class="wizard-nav">
                    <button class="wizard-back" onclick="goToStep(0)" aria-label="Back">&#x2190;</button>
                    <button class="wizard-next" onclick="goToStep(2)">Next &rarr;</button>
                </div>
            </div>

            <!-- Step 2: Q2 Level -->
            <div class="wizard-step" id="wizardStep2">
                <p class="diag-question">Where are you on the AI maturity curve?</p>
                <p class="diag-hint">Refer to your slide deck for level descriptions.</p>
                <div class="radio-cards radio-cards-level">
                    <label class="radio-card">
                        <input type="radio" name="diagLevel" value="0">
                        <span class="radio-card-body"><span class="level-dot level-dot-0"></span>Level 0</span>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="diagLevel" value="1">
                        <span class="radio-card-body"><span class="level-dot level-dot-1"></span>Level 1</span>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="diagLevel" value="2">
                        <span class="radio-card-body"><span class="level-dot level-dot-2"></span>Level 2</span>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="diagLevel" value="3">
                        <span class="radio-card-body"><span class="level-dot level-dot-3"></span>Level 3</span>
                    </label>
                </div>
                <div class="wizard-nav">
                    <button class="wizard-back" onclick="goToStep(1)" aria-label="Back">&#x2190;</button>
                    <button class="wizard-next" onclick="goToStep(3)">Next &rarr;</button>
                </div>
            </div>

            <!-- Step 3: Q3 open text -->
            <div class="wizard-step" id="wizardStep3">
                <p class="diag-question">What&rsquo;s your biggest AI challenge right now?</p>
                <p class="diag-hint">Required &mdash; we&rsquo;ll use this to shape the week for you. No wrong answers.</p>
                <textarea class="diag-textarea" id="diagQ3" placeholder="e.g. Getting my team to actually try it, not just talk about it&hellip;"></textarea>
                <div class="wizard-nav">
                    <button class="wizard-back" onclick="goToStep(2)" aria-label="Back">&#x2190;</button>
                    <button class="wizard-next" onclick="goToStep(4)">Next &rarr;</button>
                </div>
            </div>

            <!-- Step 4: Q4 open text -->
            <div class="wizard-step" id="wizardStep4">
                <p class="diag-question">What would a successful week look like for you?</p>
                <p class="diag-hint">Required &mdash; what would you need to leave with to call this time well spent?</p>
                <textarea class="diag-textarea" id="diagQ4" placeholder="e.g. One live agent working in my product by Friday&hellip;"></textarea>
                <div class="wizard-nav">
                    <button class="wizard-back" onclick="goToStep(3)" aria-label="Back">&#x2190;</button>
                    <button class="wizard-next" id="submitDiagBtn" onclick="submitDiagnostic()">Let&rsquo;s go &#x26A1;</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Landing / Holding Overlay (shown before Day 1 unlocks) -->
    <div class="landing-overlay" id="landingOverlay">
        <div class="landing-card">
            <div class="welcome-logo">
                <img src="https://www.volarisgroup.com/wp-content/uploads/2024/09/Logo-2.png" alt="Volaris Group">
            </div>
            <p class="landing-event-name">CSI Revenue Signals Product Accelerator</p>
            <h1 class="landing-greeting" id="landingGreeting">Welcome!</h1>
            <div class="landing-divider"></div>
            <p class="landing-desc">
                You&rsquo;re in. Everything&rsquo;s confirmed. This is your companion app for the week &mdash; use it to stay oriented, track what lands, and capture what shifts.
            </p>
            <div class="landing-status">
                <span id="landingStatusText">&#x1F4C5; Day 1 unlocks on <span class="landing-date-highlight" id="landingDate">March 3, 2026</span></span>
            </div>
            <div class="landing-agenda">
                <div class="landing-agenda-title">What&rsquo;s ahead</div>
                <div class="landing-day-row">
                    <div class="landing-day-number">D1</div>
                    <div class="landing-day-content">
                        <div class="landing-day-label">Mon 3 Mar</div>
                        <div class="landing-day-theme" id="ldayTheme1">The Shift</div>
                        <div class="landing-day-desc" id="ldayDesc1">[Placeholder: high-level theme for Day 1]</div>
                    </div>
                </div>
                <div class="landing-day-row">
                    <div class="landing-day-number">D2</div>
                    <div class="landing-day-content">
                        <div class="landing-day-label">Tue 4 Mar</div>
                        <div class="landing-day-theme" id="ldayTheme2">Build</div>
                        <div class="landing-day-desc" id="ldayDesc2">[Placeholder: high-level theme for Day 2]</div>
                    </div>
                </div>
                <div class="landing-day-row">
                    <div class="landing-day-number">D3</div>
                    <div class="landing-day-content">
                        <div class="landing-day-label">Wed 5 Mar</div>
                        <div class="landing-day-theme" id="ldayTheme3">Show</div>
                        <div class="landing-day-desc" id="ldayDesc3">[Placeholder: high-level theme for Day 3]</div>
                    </div>
                </div>
                <div class="landing-day-row">
                    <div class="landing-day-number">D4</div>
                    <div class="landing-day-content">
                        <div class="landing-day-label">Thu 6 Mar</div>
                        <div class="landing-day-theme" id="ldayTheme4">Commit</div>
                        <div class="landing-day-desc" id="ldayDesc4">[Placeholder: high-level theme for Day 4]</div>
                    </div>
                </div>
            </div>
            <div class="landing-agenda">
                <div class="landing-agenda-title">Before you arrive</div>
                <div class="landing-logistics-row">
                    <span class="landing-logistics-icon">&#x2705;</span>
                    <span>Ensure you&rsquo;ve submitted all required data and set up accounts</span>
                </div>
                <div class="landing-logistics-row">
                    <span class="landing-logistics-icon">&#x1F4BB;</span>
                    <span>Bring your laptop &mdash; you&rsquo;ll be building, not just watching</span>
                </div>
            </div>
            <a class="landing-change-link" onclick="changeProfile()">Not you? Switch account</a>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header slide-down">
            <div class="logo-area">
                <img src="https://www.volarisgroup.com/wp-content/uploads/2024/09/Logo-2.png" alt="Volaris Group" id="logoImg">
                <div class="logo-subtitle">March 3&ndash;6, 2026 &middot; Denver, CO</div>
            </div>
        </header>
        <!-- Denver mountain skyline -->
        <div class="mountain-header">
            <svg viewBox="0 0 600 80" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <!-- Far range -->
                <path class="mtn-far" d="M0,80 L0,42 L40,48 L80,28 L110,38 L150,18 L180,32 L210,12 L250,30 L280,22 L310,35 L340,15 L380,28 L420,10 L460,25 L500,18 L540,32 L570,24 L600,30 L600,80Z" fill="var(--navy)" opacity="0.07"/>
                <!-- Mid range -->
                <path class="mtn-mid" d="M0,80 L0,52 L50,48 L100,36 L140,44 L190,28 L230,40 L270,24 L310,38 L360,30 L400,42 L440,28 L480,38 L530,32 L580,40 L600,36 L600,80Z" fill="var(--navy)" opacity="0.12"/>
                <!-- Near foothills -->
                <path class="mtn-near" d="M0,80 L0,60 L60,56 L120,62 L180,54 L240,58 L300,52 L360,58 L420,54 L480,60 L540,56 L600,58 L600,80Z" fill="var(--navy)" opacity="0.18"/>
                <!-- Snow caps on tallest peaks -->
                <path d="M205,14 L210,12 L216,17 L210,15Z" fill="white" opacity="0.6"/>
                <path d="M207,16 L210,12 L220,20 L212,18Z" fill="white" opacity="0.25"/>
                <path d="M415,12 L420,10 L426,16 L420,13Z" fill="white" opacity="0.6"/>
                <path d="M417,14 L420,10 L428,18 L422,16Z" fill="white" opacity="0.25"/>
                <path d="M145,20 L150,18 L156,24 L150,21Z" fill="white" opacity="0.55"/>
                <path d="M147,22 L150,18 L158,26 L152,23Z" fill="white" opacity="0.2"/>
                <path d="M335,17 L340,15 L346,21 L340,18Z" fill="white" opacity="0.55"/>
                <path d="M337,19 L340,15 L348,23 L342,20Z" fill="white" opacity="0.2"/>
                <path d="M75,30 L80,28 L86,34 L80,31Z" fill="white" opacity="0.5"/>
                <path d="M77,32 L80,28 L88,36 L82,33Z" fill="white" opacity="0.18"/>
                <path d="M495,20 L500,18 L506,24 L500,21Z" fill="white" opacity="0.5"/>
                <path d="M497,22 L500,18 L508,26 L502,23Z" fill="white" opacity="0.18"/>
                <!-- Additional snow highlights on ridgeline -->
                <path d="M268,23 L272,21 L276,25Z" fill="white" opacity="0.35"/>
                <path d="M108,39 L112,37 L116,41Z" fill="white" opacity="0.3"/>
                <path d="M538,33 L542,31 L546,35Z" fill="white" opacity="0.3"/>
            </svg>
        </div>
        <h1 class="title slide-down" id="mainTitle">CSI Revenue Signals Accelerator</h1>

        <!-- Day Tracker + Journal -->
        <div class="day-indicator fade-in">
            <div class="day-dot active" data-day="1" onclick="selectDay(1)">Day 1</div>
            <div class="day-dot" data-day="2" onclick="selectDay(2)">Day 2</div>
            <div class="day-dot" data-day="3" onclick="selectDay(3)">Day 3</div>
            <div class="day-dot" data-day="4" onclick="selectDay(4)">Day 4</div>
            <button class="btn btn-journal day-journal-btn" onclick="viewJournal()">&#x1F4D3; My Journal</button>
        </div>

        <!-- Card Info -->
        <div class="card-info fade-in">
            <span class="user-greeting" id="userGreeting"></span>
            <span class="card-id" id="cardId">Card #0000</span>
            <span class="token-counter">
                <span class="token-icon">&#x26A1;</span>
                <span class="token-count" id="scoreDisplay">0</span>
                <span style="font-weight:600; font-size:0.7rem; opacity:0.7">tokens</span>
            </span>
        </div>

        <!-- Bingo Card + Side Panel Layout -->
        <div class="card-layout" id="cardLayout">
            <div class="bingo-card fade-in" id="bingoCard">
                <div class="grid" id="bingoGrid" role="grid" aria-label="Breakthrough tracker"></div>
            </div>
            <div class="side-panel" id="sidePanel">
                <button class="side-panel-close" id="sidePanelClose" title="Close">&times;</button>
                <div class="insight-track-badge" id="sideBadge">LEADERSHIP</div>
                <div class="side-panel-aha" id="sideAha"></div>
                <div class="side-panel-insight" id="sideInsight"></div>
                <div class="side-panel-source" id="sideSource"></div>
                <div class="journal-bonus-hint" id="sideBonusHint">
                    &#x26A1; Write a reflection to earn bonus tokens &mdash; <span class="bonus-amount">the more you write, the bigger the bonus!</span>
                </div>
                <div class="side-panel-journal">
                    <div class="journal-label">&#x1F4D3; Capture your reflection</div>
                    <textarea id="sideTextarea" placeholder="What shifted in your thinking? What will you do differently?"></textarea>
                    <div class="journal-char-count" id="sideCharCount">0 chars &mdash; 1x bonus multiplier (write 50+ for 2x!)</div>
                </div>
                <div class="side-panel-bottom">
                    <span class="side-panel-saved" id="sideSaved">&#x2713; Saved</span>
                    <button class="side-panel-share" id="sideShare" onclick="shareSidePanelAha()">&#x1F4E4; Share</button>
                    <button class="side-panel-gotit" id="sideGotit">&#x1F4A1; Got it!</button>
                </div>
            </div>
        </div>

        <!-- How to play -->
        <p class="how-to-play fade-in" id="howToPlay">
            <strong>Tap</strong> a cell the moment something lands. Hit <strong>&#x24D8;</strong> for the insight behind it. <strong>Five in a row</strong> means a breakthrough day.
        </p>

        <!-- Action Buttons -->
        <div class="actions fade-in">
            <button class="btn btn-primary" onclick="generateNewCard()">New Card</button>
            <button class="btn btn-secondary" onclick="resetMarks()">Reset</button>
            <button class="btn btn-accent" onclick="shareCard()">Share My Card</button>
        </div>

        <!-- Footer -->
        <footer class="footer fade-in">
            <div class="footer-settings">
                <div class="toggle-group">
                    <span class="toggle-label">Light</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="themeToggle" aria-label="Toggle dark mode">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">Dark</span>
                </div>
                <button class="mute-btn" id="muteBtn" onclick="toggleMute()" aria-label="Toggle sound">
                    <span class="mute-icon" id="muteIcon">&#x1F50A;</span>
                    <span id="muteLabel">Sound</span>
                </button>
            </div>
            <p class="footer-primary">
                <strong>CSI Revenue Signals Accelerator &mdash; Denver 2026</strong> by <strong>Volaris Business Transformation</strong>
            </p>
            <p class="footer-secondary">
                "Incremental change will NOT work for us this round. Run at this hard!" &mdash; Mark Miller
            </p>
        </footer>
    </div>

    <!-- Insight / Journal Expanded View -->
    <div class="insight-overlay" id="insightOverlay">
        <div class="insight-card">
            <div class="insight-track-badge" id="insightTrackBadge">LEADERSHIP</div>
            <div class="insight-aha" id="insightAha"></div>
            <div class="insight-text" id="insightText"></div>
            <div class="insight-source" id="insightSource"></div>
            <div class="journal-bonus-hint" id="journalBonusHint">
                &#x26A1; Write a reflection to earn <span class="bonus-amount">+1,000&ndash;3,000</span> bonus tokens
            </div>
            <div class="journal-section">
                <div class="journal-label">&#x1F4D3; Capture your aha moment</div>
                <textarea class="journal-textarea" id="journalTextarea" placeholder="What shifted in your thinking? What will you do differently?"></textarea>
                <div class="journal-saved" id="journalSaved">&#x2713; Saved &amp; bonus tokens earned!</div>
            </div>
            <button class="insight-close" onclick="closeInsight()">&#x1F4A1; Got it!</button>
        </div>
    </div>

    <!-- Journal View Overlay -->
    <div class="journal-overlay" id="journalOverlay">
        <div class="journal-view">
            <h2>&#x1F4D3; My Learning Journal</h2>
            <p class="journal-subtitle">Your aha moments from the Denver Accelerator</p>
            <div class="journal-stats" id="journalStats"></div>
            <div id="journalEntries"></div>
            <div class="journal-footer">
                <button class="journal-export" onclick="exportJournal()">&#x1F4CB; Export Journal</button>
                <button class="journal-close" onclick="closeJournal()">Close</button>
            </div>
        </div>
    </div>

    <!-- BINGO Celebration Overlay -->
    <div class="bingo-overlay" id="bingoOverlay">
        <div class="bingo-title" id="bingoTitle">&#x1F4A1; BINGO! &#x1F4A1;</div>
        <div class="bingo-subtitle" id="bingoSubtitle">5 breakthroughs in a row. Keep going.</div>
        <button class="btn btn-accent" onclick="closeBingo()">Keep Collecting!</button>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confettiCanvas"></canvas>

    <!-- Toast -->
    <div class="toast" id="toast">Copied to clipboard!</div>

    <script>
    /* ===================================================================
       AHA MOMENT BINGO - CSI Revenue Signals Accelerator
       =================================================================== */

    // ===== Aha Moment Pool =====
    // Grounded in what people EXPERIENCE when they work AI-first for the first time
    const AHA_POOL = [
        // ===== PRODUCT TRACK =====
        // Radical shifts in how product work happens when agents do the execution
        {
            aha: "I gave an agent a problem statement and it came back with a working product",
            insight: "Not a mockup. Not a wireframe. A clickable, functional application\u2014built from a plain-language brief. You didn't manage a backlog, write tickets, or wait for sprint capacity. You described intent and an agent executed. The entire concept of product-to-dev handover is dead.",
            insightSource: "Agentic PoC Build",
            track: "product"
        },
        {
            aha: "I ran a complete market analysis in a single conversation",
            insight: "Competitive landscape, TAM/SAM/SOM, customer segments, pricing benchmarks, market gaps\u2014all from one agentic session. Not a research phase. Not a consulting engagement. A conversation. The entire market research function just collapsed into a skill, not a team.",
            insightSource: "Agentic Market Research",
            track: "product"
        },
        {
            aha: "I validated and killed three ideas before the planning meeting started",
            insight: "Each concept got stress-tested against customer data, market conditions, and competitive pressure\u2014by an agent, in minutes. Two ideas died. One survived stronger. The politics of prioritisation lose their power when validation is instant and evidence-based.",
            insightSource: "Agentic Validation",
            track: "product"
        },
        {
            aha: "The agent iterated the product three times while I made coffee",
            insight: "Describe the change. Agent builds it. You review. Repeat. Three full iterations in the time it takes to get a drink. The concept of a sprint as a unit of product iteration is absurd when the feedback loop is measured in minutes, not weeks.",
            insightSource: "Agentic Iteration",
            track: "product"
        },
        {
            aha: "My spec became a running application without a developer touching it",
            insight: "A structured markdown document\u2014your product spec\u2014was consumed by an agent that generated the database, API, and frontend. Directly. The translation layer between product intent and working code\u2014the misinterpretations, the re-scoping\u2014just ceased to exist.",
            insightSource: "Spec-to-Software",
            track: "product"
        },
        {
            aha: "A client asked about pricing for something that didn't exist on Monday",
            insight: "Four days: problem \u2192 research \u2192 prototype \u2192 client demo \u2192 revenue signal. The entire discovery-to-validation pipeline that fills your quarterly roadmap happened in a single week. Every timeline assumption in your business case is now wrong.",
            insightSource: "Revenue Signal Generation",
            track: "product"
        },
        {
            aha: "I interrogated a synthetic customer panel at 11pm and got real insights",
            insight: "Built from actual customer data, always available, never fatigued, brutally honest. You ran a user research session with no scheduling, no recruitment, no moderation. The gating function on customer insight just evaporated. Research happens whenever you think of the question.",
            insightSource: "Synthetic User Research",
            track: "product"
        },
        {
            aha: "I'm not a developer\u2014but I just shipped software to a real client",
            insight: "Job title: Product Manager. Output: working application, deployed and client-tested. The entire gatekeeping structure of who can and can't build software just collapsed. In an agentic SDLC, the person closest to the problem IS the builder.",
            insightSource: "Agentic Product Development",
            track: "product"
        },
        {
            aha: "The agent challenged my hypothesis harder than any stakeholder ever has",
            insight: "You asked it to stress-test your concept from the customer's perspective. It found fatal assumptions, asked questions you hadn't considered, and proposed alternatives. It killed your idea in five minutes\u2014saving you six months of building the wrong thing.",
            insightSource: "Agentic Challenge",
            track: "product"
        },
        {
            aha: "I turned a chaotic Miro board into a ranked backlog in one prompt",
            insight: "Sticky notes, fragments, contradictory signals, half-formed hypotheses\u2014all fed into an agent. Out came ranked, testable problem statements with effort estimates. The skill isn't having clear thoughts. It's knowing how to feed your mess to the machine.",
            insightSource: "Agentic Synthesis",
            track: "product"
        },
        {
            aha: "The go-to-market pack built itself as a by-product of building the product",
            insight: "Pitch deck, demo video script, one-pager, competitive positioning\u2014generated by agents from the product itself. GTM is no longer a phase after you build. It's a by-product of building. The weeks between 'we have a product' and 'we can sell it' just vanished.",
            insightSource: "Agentic GTM",
            track: "product"
        },
        {
            aha: "I became dangerous in an unfamiliar vertical in a single afternoon",
            insight: "Someone else's data. An industry you've never worked in. An agent found patterns, proposed use cases, identified revenue opportunities. Domain expertise used to be a moat that took years to build. Now it's a prompt that takes minutes to write.",
            insightSource: "Covert Ops",
            track: "product"
        },
        {
            aha: "The full product lifecycle\u2014research to client demo\u2014happened in four days",
            insight: "Research \u2192 insights \u2192 problem \u2192 ideation \u2192 build \u2192 test \u2192 client feedback \u2192 pitch. Every phase agent-accelerated. What your org plans in quarters happened this week. This isn't a productivity hack. It's a completely different operating model.",
            insightSource: "Agentic SDLC in Action",
            track: "product"
        },
        {
            aha: "I write instructions now, not documents\u2014and machines execute them",
            insight: "Markdown isn't a format choice. It's how you program agents. Structure your thinking in markdown and agents parse it, build from it, execute against it. Product managers aren't writers anymore. They're programmers who write in English.",
            insightSource: "Intent-as-Code",
            track: "product"
        },
        {
            aha: "Waiting for dev capacity to test an idea feels absurd now",
            insight: "The dependency on design, development, and sprint capacity to validate a concept is gone. You can prove or kill an idea before the planning meeting happens. Product management just shifted from requesting builds to doing builds. The backlog is a relic.",
            insightSource: "Agentic Prototyping",
            track: "product"
        },
        {
            aha: "I had a better conversation with an agent than with most stakeholders",
            insight: "It didn't have politics. It didn't protect territory. It didn't say 'that's not my department.' It engaged with your problem purely on merit, challenged your thinking, and proposed solutions. The best sparring partner you've ever had isn't human.",
            insightSource: "Agentic Collaboration",
            track: "product"
        },

        // ===== R&D TRACK =====
        // The shift from writing code to directing agents that write code
        {
            aha: "I gave an agent a codebase and a task\u2014and came back to a pull request",
            insight: "Not autocomplete. Not suggestions. A fully autonomous agent that read the codebase, understood the architecture, wrote the feature, added tests, and opened a PR. You went from coding to reviewing. The developer role just fundamentally changed.",
            insightSource: "Agentic Development",
            track: "rnd"
        },
        {
            aha: "The agent set up the entire environment while I read the architecture doc",
            insight: "Provisioned services, configured dependencies, resolved conflicts, verified everything worked\u2014autonomously. The tribal knowledge, the README lies, the 'works on my machine' ritual\u2014all extinct. Environment setup is now a single instruction to an agent.",
            insightSource: "Agentic Environment Setup",
            track: "rnd"
        },
        {
            aha: "I described the problem and the agent chose a better approach than I would have",
            insight: "You caught yourself about to dictate implementation details. Instead, you described the problem. The agent proposed an approach you hadn't considered\u2014cleaner, more maintainable, better tested. Your implementation instincts are now a liability. Problem description is the skill.",
            insightSource: "L2 Agentic Working",
            track: "rnd"
        },
        {
            aha: "An agent shipped a sprint's worth of features before lunch",
            insight: "Database schema, API endpoints, working UI, tests, documentation\u2014built in a single morning by directing an agent. Not scaffolded. Actually working. Every estimate you've ever given\u2014to your manager, to your team, to your client\u2014is provably wrong now.",
            insightSource: "Agentic Build Sprint",
            track: "rnd"
        },
        {
            aha: "I pasted logs into an agent and it found the root cause in 30 seconds",
            insight: "No code context. No stack trace walkthrough. Raw log output. The agent identified the root cause, explained the failure chain, and wrote the fix. The entire discipline of debugging\u2014the detective work, the intuition, the hours of tracing\u2014just became a prompt.",
            insightSource: "Agentic Debugging",
            track: "rnd"
        },
        {
            aha: "The agent writes better tests than I do\u2014and doesn't skip them under pressure",
            insight: "Test coverage went UP when the agent took over. Edge cases you'd skip on a Friday. Race conditions you'd miss under deadline pressure. It doesn't get lazy. Doesn't negotiate on quality. Quality and speed are no longer a trade-off in an agentic workflow.",
            insightSource: "Agentic Quality",
            track: "rnd"
        },
        {
            aha: "The agent refactored 15 files, updated all references, and every test still passed",
            insight: "A codebase-wide refactor that you'd budget a week for\u2014completed in minutes. The agent understood the dependency graph, made coordinated changes everywhere, and verified the result. Scale is no longer a factor in the decision to improve code.",
            insightSource: "Agentic Refactoring",
            track: "rnd"
        },
        {
            aha: "I told an agent what to deploy and had a working pipeline in ten minutes",
            insight: "Plain language description of deployment needs \u2192 working CI/CD pipeline. Build, test, deploy\u2014configured from a conversation. Infrastructure-as-code is already legacy thinking. Infrastructure-as-conversation is how agents work.",
            insightSource: "Agentic Infrastructure",
            track: "rnd"
        },
        {
            aha: "The product team's vibe-coded prototype is now hitting production APIs",
            insight: "What started as a non-developer's rough PoC\u2014built by directing an agent\u2014is now connected to real endpoints, querying production data. The gap between 'demo' and 'real software' shrank to hours. Throwaway prototypes are dead\u2014everything is a starting point now.",
            insightSource: "Agentic Productionisation",
            track: "rnd"
        },
        {
            aha: "An agent found a bug in my logic\u2014while writing tests for it",
            insight: "You asked for tests. The agent generated a case that failed\u2014exposing a logic error you didn't know existed. It didn't just test your code. It made your code correct. In an agentic workflow, testing and debugging merge into a single activity.",
            insightSource: "Agentic Testing",
            track: "rnd"
        },
        {
            aha: "Documentation generated itself from the codebase\u2014and it's actually good",
            insight: "API docs, architecture diagrams, user guides\u2014all generated by agents, more complete than what you'd write. The 'we'll document later' lie is finally over. Documentation is a by-product of agentic development, not a chore humans skip.",
            insightSource: "Agentic Documentation",
            track: "rnd"
        },
        {
            aha: "We shipped production software in four days from a blank repo",
            insight: "Not a mockup. Working software connected to real services, tested, documented, deployed. Your entire mental model of what a team can accomplish is shattered. The constraint was never talent or effort\u2014it was the speed of the feedback loop. Agents fixed that.",
            insightSource: "Agentic Delivery",
            track: "rnd"
        },
        {
            aha: "I went from writing every line to reviewing agent output\u2014and my code got better",
            insight: "Monday: typing code manually. Thursday: directing agents from specs, reviewing their PRs, validating architecture. Your code quality improved because you stopped being the bottleneck. L2 isn't a slide deck metric. It's what you just lived.",
            insightSource: "L0 to L2 Journey",
            track: "rnd"
        },
        {
            aha: "The agent understood my INTENT, not just my syntax",
            insight: "It didn't complete your line of code. It understood the feature you were building and completed the thought. The jump from code completion to intent completion is the moment you realise: agents aren't typing assistants. They're thinking partners. And that's only L1.",
            insightSource: "Agentic Pair Programming",
            track: "rnd"
        },
        {
            aha: "I directed the architecture while agents wrote every line of implementation",
            insight: "You made the design decisions. Agents handled the code. The ratio flipped: 80% thinking, 20% doing\u2014instead of the reverse. Your value is no longer in the typing. It's in the judgement, the taste, the architectural vision. That's the L2 developer.",
            insightSource: "Agentic Architecture",
            track: "rnd"
        },
        {
            aha: "The agent resolved a crash dump faster than I could open the file",
            insight: "Memory state analysis, stack trace correlation, root cause isolation\u2014resolved in minutes by an agent. Your worst debugging nightmare is now a brief conversation. The years of hard-won debugging intuition? Commoditised. The new skill is knowing what to ask.",
            insightSource: "Agentic Troubleshooting",
            track: "rnd"
        },

        // ===== LEADERSHIP TRACK =====
        // What leaders see when they witness agentic teams in action
        {
            aha: "I watched a product manager build software\u2014without a single developer",
            insight: "They described what they wanted. An agent built it. Clickable, functional, real. No developer dependency. No sprint capacity. The org chart you designed\u2014the handoffs, the specialisations, the team boundaries\u2014is built around bottlenecks that agents just removed.",
            insightSource: "Agentic Teams in Action",
            track: "leadership"
        },
        {
            aha: "Everything I've ever scoped at three months just happened in four days",
            insight: "You watched it happen. Concept to working demo to client feedback in one week. Every estimate, timeline, and resource plan in your portfolio is built on human-only assumptions that are now provably wrong. The question isn't whether to recalibrate\u2014it's how fast.",
            insightSource: "Agentic Delivery Speed",
            track: "leadership"
        },
        {
            aha: "Agents don't just help my dev team\u2014they transform every function I lead",
            insight: "Customer support, sales, marketing, PS, finance\u2014you saw agents transform actual workflows across every function. This isn't an IT initiative or a developer tool. The entire operating model of every department you oversee has a new possibility frontier.",
            insightSource: "Enterprise Agentic Transformation",
            track: "leadership"
        },
        {
            aha: "My instinct shifted from 'how do I solve this' to 'which agent do I send'",
            insight: "It happened mid-week and you barely noticed. Your default cognitive loop changed. That's not delegation\u2014it's a fundamentally different operating system for decision-making. You just upgraded how you think, not just how you work.",
            insightSource: "Agentic Mindset",
            track: "leadership"
        },
        {
            aha: "Tuesday's 'impossible' is Thursday's 'obvious'",
            insight: "The technology didn't change between Tuesday and Thursday\u2014your understanding of it did. Now multiply that gap across your entire org. Everyone who hasn't had this week still thinks Tuesday's reality is true. That's both your biggest risk and your biggest opportunity.",
            insightSource: "Paradigm Shift",
            track: "leadership"
        },
        {
            aha: "I fed my QSR to an agent and got strategic options I hadn't considered",
            insight: "Your actual quarterly data, analysed by an agent, producing benchmarks, variance analysis, and recommendations you'd missed. This isn't something you adopt 'for the team.' It changes how YOU think and decide. The transformation starts with the leader.",
            insightSource: "Agentic Decision Support",
            track: "leadership"
        },
        {
            aha: "Security and compliance are solved\u2014that excuse is now eighteen months expired",
            insight: "Enterprise guardrails, data residency, audit trails, compliance frameworks\u2014all production-ready and battle-tested. The concerns were valid two years ago. They're not anymore. Every leader still citing security is protecting comfort, not data.",
            insightSource: "Enterprise Readiness",
            track: "leadership"
        },
        {
            aha: "The spec-to-code handover\u2014our most expensive friction point\u2014is gone",
            insight: "Product wrote specs. Agents had working code the same day. The sprints of misinterpretation, back-and-forth, and re-scoping collapsed to nothing. The most expensive friction point in your delivery model just ceased to exist. Every process built around that handover is now waste.",
            insightSource: "Agentic SDLC",
            track: "leadership"
        },
        {
            aha: "Every budget and business case I've approved is based on wrong maths",
            insight: "The cost and time assumptions in every plan you own are based on human-only work. You just saw what agent-assisted teams deliver. The maths isn't slightly different\u2014it's fundamentally different. Your margin assumptions, your ROI models, your hiring plans\u2014all need rebuilding.",
            insightSource: "Economic Reset",
            track: "leadership"
        },
        {
            aha: "That team of eight? Three people with agents just matched their output",
            insight: "You watched it happen. Same scope, same quality, fraction of the people. The question isn't 'how many people do we need' anymore. It's 'what's the right human-to-agent ratio?' Your hiring model is built on constraints that agents just eliminated.",
            insightSource: "Agentic Team Economics",
            track: "leadership"
        },
        {
            aha: "A PS ratio of 5 isn't aspirational\u2014it's the floor now",
            insight: "Scoping, delivery, documentation, QA\u2014agents mapped to every stage of professional services. The efficiency gains aren't incremental. The entire economics of service delivery shifted. What you thought was the ceiling is now the starting point.",
            insightSource: "Agentic Professional Services",
            track: "leadership"
        },
        {
            aha: "I showed my actual work being transformed by an agent\u2014live, on screen",
            insight: "Your real QSR, your actual client emails, your live pipeline\u2014processed and improved by agents in front of your peers. Not a vendor demo. YOUR work. When leaders see each other working this way, permission to change spreads faster than any mandate.",
            insightSource: "Leader Show and Tell",
            track: "leadership"
        },

        // ===== GENERAL / CROSS-CUTTING =====
        // The paradigm shifts that hit everyone regardless of role
        {
            aha: "One person with agents is now a team",
            insight: "Same scope. Same quality. One person directing agents instead of eight people in meetings. The unit economics of building software, running research, creating content\u2014all fundamentally changed. Scale is no longer a headcount question. It's an agent question.",
            insightSource: "Agentic Scale",
            track: "general"
        },
        {
            aha: "Half our meetings exist because work used to be slow\u2014agents killed that",
            insight: "Status updates, alignment sessions, review meetings\u2014most exist because work moved slowly and needed coordination. When agents collapse cycle times from days to minutes, the coordination overhead becomes the bottleneck. The calendar clears itself.",
            insightSource: "Agentic Working",
            track: "general"
        },
        {
            aha: "Every plan I own was made before agents\u2014and none account for them",
            insight: "Roadmaps, budgets, hiring plans, strategic goals\u2014all bounded by what humans alone could do. Agents moved the ceiling. Your plans didn't update. The gap between what's now possible and what you're planning for is the biggest risk nobody's managing.",
            insightSource: "Agentic SDLC",
            track: "general"
        },
        {
            aha: "I haven't Googled anything in three days and I'm more productive than ever",
            insight: "Your reflex for finding answers shifted from searching to conversing with agents. That's not a tool preference\u2014it's a fundamentally different relationship with information. Search is already legacy behaviour. The answer comes from the conversation now.",
            insightSource: "Agentic Information",
            track: "general"
        },
        {
            aha: "Years of domain expertise just became a one-paragraph prompt for an agent",
            insight: "You applied the same agentic workflow to a completely unfamiliar domain and it worked. The accumulated knowledge that makes someone an expert\u2014years of experience, pattern recognition, institutional memory\u2014is now context an agent can consume in seconds.",
            insightSource: "Agentic Knowledge Transfer",
            track: "general"
        },
        {
            aha: "My Day 1 fear is embarrassing by Day 4",
            insight: "Tuesday: 'AI will replace us.' Thursday: 'AI amplifies us.' Every fear was either disproven by what you experienced or has a concrete mitigation. The gap between fear and reality is where growth happens\u2014and you just closed it in four days.",
            insightSource: "Paradigm Shift",
            track: "general"
        },
        {
            aha: "The gap between imagining something and having it built is now zero",
            insight: "Describe intent. Agent translates to implementation. Working software appears. The weeks of miscommunication, handoff delays, and re-work between 'I want this' and 'here it is' just collapsed. Agents are the universal translator between imagination and reality.",
            insightSource: "Agentic Execution",
            track: "general"
        },
        {
            aha: "Speed of learning just became the only competitive advantage that matters",
            insight: "Ship rough today, iterate tomorrow, demo-ready by Thursday. The company that learns fastest wins\u2014and agents compress the learning cycle from quarters to days. Perfection is the enemy. Speed of iteration is the strategy. Progress over perfection isn't a slogan\u2014it's survival.",
            insightSource: "Agentic Competitive Advantage",
            track: "general"
        },
        {
            aha: "The ability to direct agents is the new foundational skill\u2014for everyone",
            insight: "Someone shared a prompting pattern. You applied it to a different problem. Better results instantly. The ability to effectively direct agents is transferable across every role, function, and domain. It's not a technical skill. It's the skill. For everyone.",
            insightSource: "Agentic Literacy",
            track: "general"
        },
        {
            aha: "This week wasn't a preview of 2030\u2014it's what's possible RIGHT NOW",
            insight: "Research, build, test, ship, sell\u2014the entire lifecycle, agent-first, in four days. Not future technology. Not a lab demo. Production-ready tools, available today. The only question is how fast your organisation closes the gap between what's possible and what you're doing.",
            insightSource: "The Agentic Present",
            track: "general"
        }
    ];

    const TRACK_COLORS = {
        leadership: '#F59E0B',
        product: '#008AB0',
        rnd: '#BFD731',
        general: '#9CA3AF'
    };

    const TRACK_LABELS = {
        leadership: 'Leadership',
        product: 'Product',
        rnd: 'R&D',
        general: 'General'
    };

    // ===== State =====
    let currentCard = [];
    let markedCells = new Set();
    let cardSeed = 0;
    let bingoDetected = false;
    let celebratedLines = new Set(); // track which bingo lines already celebrated
    let isDarkMode = false;
    let isMuted = false;
    let activeTrack = 'all';
    let activeDay = 1;
    let journalNotes = {}; // { "aha text": { note, track, timestamp, day } }
    let currentInsightIndex = -1;

    // Per-day marked cells: { 1: Set, 2: Set, 3: Set, 4: Set }
    let markedByDay = {
        1: new Set([12]),
        2: new Set([12]),
        3: new Set([12]),
        4: new Set([12])
    };

    function saveMarkedByDay() {
        const serialized = {};
        for (const d of [1,2,3,4]) {
            serialized[d] = [...markedByDay[d]];
        }
        localStorage.setItem('aha-bingo-markedByDay', JSON.stringify(serialized));
    }

    function loadMarkedByDay() {
        try {
            const saved = localStorage.getItem('aha-bingo-markedByDay');
            if (saved) {
                const parsed = JSON.parse(saved);
                for (const d of [1,2,3,4]) {
                    markedByDay[d] = new Set(parsed[d] || [12]);
                }
            }
        } catch(e) {}
    }

    function inferDayFromTimestamp(ts) {
        if (!ts) return 1;
        // Accelerator days: infer from date
        // Fallback: just return 1
        try {
            const d = new Date(ts);
            const dayOfWeek = d.getDay(); // 0=Sun
            // Mon=1, Tue=2, Wed=3, Thu=4 maps to Day 1-4
            if (dayOfWeek >= 1 && dayOfWeek <= 4) return dayOfWeek;
            return 1;
        } catch(e) { return 1; }
    }

    // ===== Web Audio Sound System =====
    let audioCtx = null;

    function getAudioCtx() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        return audioCtx;
    }

    function playStampSound() {
        if (isMuted) return;
        try {
            const ctx = getAudioCtx();
            // Bright "ding" for aha moment
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.05);
            osc.frequency.exponentialRampToValueAtTime(900, ctx.currentTime + 0.15);
            gain.gain.setValueAtTime(0.12, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.2);
        } catch(e) {}
    }

    function playUnmarkSound() {
        if (isMuted) return;
        try {
            const ctx = getAudioCtx();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(150, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.08, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.1);
        } catch(e) {}
    }

    function playBingoSound() {
        if (isMuted) return;
        try {
            const ctx = getAudioCtx();
            // Ascending triumphant arpeggio
            const notes = [523, 659, 784, 1047, 1319]; // C5, E5, G5, C6, E6
            notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'triangle';
                const t = ctx.currentTime + i * 0.1;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.15, t + 0.03);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
                osc.start(t);
                osc.stop(t + 0.4);
            });
        } catch(e) {}
    }

    function toggleMute() {
        isMuted = !isMuted;
        localStorage.setItem('aha-bingo-muted', isMuted ? 'true' : 'false');
        updateMuteUI();
    }

    function updateMuteUI() {
        document.getElementById('muteIcon').innerHTML = isMuted ? '&#x1F507;' : '&#x1F50A;';
        document.getElementById('muteLabel').textContent = isMuted ? 'Muted' : 'Sound';
    }

    // ===== Welcome / Profile =====
    let wizardStep = 0;
    let wizardEmail = '';

    function showWelcome() {
        goToStep(0);
        document.getElementById('welcomeOverlay').classList.add('show');
    }

    // Step 0: check DynamoDB for existing record by email
    async function submitEmail() {
        const email = document.getElementById('welcomeEmail').value.trim();
        if (!email || !email.includes('@')) {
            document.getElementById('lookupStatus').textContent = 'Please enter a valid email.';
            return;
        }
        wizardEmail = email;
        const statusEl = document.getElementById('lookupStatus');
        statusEl.textContent = 'Looking you upâ€¦';

        try {
            const res = await fetch(`${DIAGNOSTIC_API}?userId=${encodeURIComponent(email)}`);
            if (res.ok) {
                const data = await res.json();
                // Record found â€” restore and skip questionnaire
                statusEl.textContent = '';
                const profile = { name: data.name, email, vbu: data.vbu };
                const diagnostic = {
                    role: data.role, level: data.level,
                    q3: data.q3, q4: data.q4,
                    completedAt: data.completedAt
                };
                localStorage.setItem('aha-bingo-profile', JSON.stringify(profile));
                localStorage.setItem('aha-bingo-diagnostic', JSON.stringify(diagnostic));
                document.getElementById('welcomeOverlay').classList.remove('show');
                finishOnboarding(profile, diagnostic);
                return;
            }
        } catch(e) { /* network error â€” proceed to questionnaire */ }

        // No record found â€” proceed to questionnaire steps
        statusEl.textContent = '';
        document.getElementById('welcomeOverlay').classList.add('show');
        goToStep(1);
    }

    function goToStep(n) {
        // Validate current step before advancing
        if (n > wizardStep) {
            if (wizardStep === 1) {
                const name = document.getElementById('welcomeName').value.trim();
                const vbu = document.getElementById('welcomeVbu').value;
                const role = document.querySelector('input[name="diagRole"]:checked')?.value;
                if (!name) { alert('Please enter your name.'); return; }
                if (!vbu) { alert('Please select your business unit.'); return; }
                if (!role) { alert('Please select your role.'); return; }
            }
            if (wizardStep === 2) {
                const level = document.querySelector('input[name="diagLevel"]:checked')?.value;
                if (level === undefined || level === null) { alert('Please select your level.'); return; }
            }
            if (wizardStep === 3) {
                const q3 = document.getElementById('diagQ3').value.trim();
                if (!q3) { alert('Please share your biggest AI challenge â€” this helps us make the week more useful for you.'); return; }
            }
        }

        wizardStep = n;

        // Show/hide steps
        for (let i = 0; i <= 4; i++) {
            document.getElementById(`wizardStep${i}`).classList.toggle('active', i === n);
        }

        // Step progress dots & label (hidden on step 0)
        const progress = document.getElementById('wizardProgress');
        if (n === 0) {
            progress.style.display = 'none';
        } else {
            progress.style.display = 'block';
            document.getElementById('wizardStepLabel').textContent = `Step ${n} of 5`;
            for (let i = 0; i <= 4; i++) {
                const dot = document.getElementById(`sdot${i}`);
                dot.classList.toggle('active', i === n - 1);
                dot.classList.toggle('done', i < n - 1);
            }
        }
    }

    async function submitDiagnostic() {
        const name = document.getElementById('welcomeName').value.trim();
        const vbu = document.getElementById('welcomeVbu').value;
        const role = document.querySelector('input[name="diagRole"]:checked')?.value;
        const level = document.querySelector('input[name="diagLevel"]:checked')?.value;
        const q3 = document.getElementById('diagQ3').value.trim();
        const q4 = document.getElementById('diagQ4').value.trim();

        if (!name || !vbu || !role || level === undefined) {
            alert('Please complete all required fields.');
            return;
        }
        if (!q4) {
            alert('Please tell us what a successful week would look like for you.');
            return;
        }

        const btn = document.getElementById('submitDiagBtn');
        btn.disabled = true;
        btn.textContent = 'Savingâ€¦';

        const payload = {
            userId: wizardEmail,
            name, vbu, role, level,
            q3: q3 || '', q4: q4 || '',
            completedAt: new Date().toISOString()
        };

        try {
            await fetch(DIAGNOSTIC_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        } catch(e) { console.log('Diagnostic API save failed, continuing with localStorage', e); }

        const profile = { name, email: wizardEmail, vbu };
        const diagnostic = { role, level, q3: q3 || '', q4: q4 || '', completedAt: payload.completedAt };
        localStorage.setItem('aha-bingo-profile', JSON.stringify(profile));
        localStorage.setItem('aha-bingo-diagnostic', JSON.stringify(diagnostic));

        btn.disabled = false;
        btn.textContent = "Let's go! âš¡";

        document.getElementById('welcomeOverlay').classList.remove('show');
        finishOnboarding(profile, diagnostic);
    }

    function finishOnboarding(profile, diagnostic) {
        currentUserId = profile.email;
        updateUserGreeting(profile);

        const eventDay = getCurrentEventDay();

        // Apply role-based track regardless of event state
        const roleToTrack = { product: 'product', rnd: 'rnd', leadership: 'leadership' };
        activeTrack = roleToTrack[diagnostic.role] || 'all';

        loadPreferences();
        loadMarkedByDay();
        applyTheme();
        updateMuteUI();

        if (eventDay === 0) {
            // Pre-event: generate card so it's ready when landing is dismissed
            activeDay = 1;
            markedCells = new Set(markedByDay[activeDay]);
            loadJournal();
            generateNewCard();
            updateDayTabs();
            showLanding(profile);
            return;
        }

        // Event is live â€” initialize the full bingo experience
        const savedDay = parseInt(localStorage.getItem('aha-bingo-activeDay'));
        const maxDay = Math.min(eventDay, 4);
        if (savedDay >= 1 && savedDay <= maxDay) {
            activeDay = savedDay;
        } else {
            activeDay = maxDay;
        }
        markedCells = new Set(markedByDay[activeDay]);
        loadJournal();

        generateNewCard();
        selectDay(activeDay);
        updateDayTabs();
    }

    const TRACK_SCHEDULE = {
        product: {
            1: { theme: 'Research & Discover',  desc: 'Use AI to explore your market, understand your users, and build a first prototype.' },
            2: { theme: 'Define & Refine',      desc: 'Sharpen your problem statement, stress-test ideas, and prepare specs for the build.' },
            3: { theme: 'Collaborate & Build',  desc: 'Work alongside R&D to bring your PoC to life and push your thinking further.' },
            4: { theme: 'Refine & Share',       desc: 'Tighten your PoC, incorporate feedback, and close with a short lightning demo.' }
        },
        rnd: {
            1: { theme: 'Set Up & Explore',     desc: 'Get your AI-first environment running and tackle real debugging challenges with AI.' },
            2: { theme: 'Build & Test',         desc: 'Ship your first feature end-to-end, set up CI/CD, and automate your tests.' },
            3: { theme: 'Build & Iterate',      desc: 'Join forces with Product and drive the PoC forward at AI-first velocity.' },
            4: { theme: 'Deliver & Demo',       desc: 'Finalise the PoC and close with a short lightning demo alongside Product.' }
        },
        leadership: {
            1: { theme: 'Experience the Shift', desc: 'See AI in action and explore what it means for your team and business.' },
            2: { theme: 'Meet the Ecosystem',   desc: 'Engage with strategic partners and watch early product ideas take shape.' },
            3: { theme: 'Deepen & Reflect',     desc: "Go hands-on with AI tools and explore how you'll lead others through this change." },
            4: { theme: 'Commit & Close',       desc: 'Watch the final demos, share your plans, and commit to what comes next.' }
        }
    };

    function populateLandingSchedule(role) {
        const sched = TRACK_SCHEDULE[role] || TRACK_SCHEDULE.product;
        for (let d = 1; d <= 4; d++) {
            document.getElementById(`ldayTheme${d}`).textContent = sched[d].theme;
            document.getElementById(`ldayDesc${d}`).textContent  = sched[d].desc;
        }
    }

    function showLanding(profile) {
        const firstName = profile.name.split(' ')[0];
        document.getElementById('landingGreeting').textContent = `Welcome, ${firstName}!`;

        const [y, m, d] = EVENT_CONFIG.startDate.split('-').map(Number);
        const startDt = new Date(y, m - 1, d);
        const dateStr = startDt.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        document.getElementById('landingDate').textContent = dateStr;

        const diag = JSON.parse(localStorage.getItem('aha-bingo-diagnostic') || 'null');
        populateLandingSchedule(diag && diag.role ? diag.role : 'product');

        document.getElementById('landingOverlay').classList.add('show');
    }

    function updateUserGreeting(profile) {
        const el = document.getElementById('userGreeting');
        if (el && profile) {
            el.innerHTML = `Hi, ${profile.name} <a onclick="changeProfile()">(change)</a>`;
        }
    }

    function changeProfile() {
        localStorage.removeItem('aha-bingo-profile');
        localStorage.removeItem('aha-bingo-diagnostic');
        document.getElementById('landingOverlay').classList.remove('show');
        showWelcome();
    }

    function updateDayTabs() {
        const eventDay = getCurrentEventDay();
        document.querySelectorAll('.day-dot').forEach(dot => {
            const dayNum = parseInt(dot.dataset.day);
            if (eventDay > 0 && dayNum > eventDay) {
                dot.classList.add('locked');
            } else {
                dot.classList.remove('locked');
            }
        });
    }

    // ===== Event Configuration =====
    const EVENT_CONFIG = {
        startDate: '2026-03-03',   // Day 1 = 3 March 2026
        endDate:   '2026-03-06',   // Day 4 = 6 March 2026
        startHour: 8,              // Hour (US Mountain) each day unlocks
        timezone:  'America/Denver'
    };

    function getCurrentEventDay() {
        const { startDate, endDate, startHour, timezone } = EVENT_CONFIG;
        const now = new Date();

        // Get current date (YYYY-MM-DD) and hour in the event timezone
        const dateInTz = new Intl.DateTimeFormat('en-CA', { timeZone: timezone }).format(now);
        const hourInTz = parseInt(new Intl.DateTimeFormat('en-US', {
            timeZone: timezone, hour: 'numeric', hour12: false
        }).format(now));

        if (dateInTz < startDate) return 0;
        if (dateInTz === startDate && hourInTz < startHour) return 0;
        if (dateInTz > endDate) return 4;

        const [sy, sm, sd] = startDate.split('-').map(Number);
        const [ty, tm, td] = dateInTz.split('-').map(Number);
        const dayDiff = Math.round(
            (Date.UTC(ty, tm-1, td) - Date.UTC(sy, sm-1, sd)) / 86400000
        );
        const eventDay = dayDiff + 1;

        // Before start hour on days 2-4: still on previous day
        if (hourInTz < startHour) return Math.max(eventDay - 1, 1);

        return Math.min(eventDay, 4);
    }

    // ===== API Endpoints =====
    const BASE_API = 'https://qqkykyeiol.execute-api.us-east-1.amazonaws.com';
    const DIAGNOSTIC_API = BASE_API + '/diagnostic';

    // ===== Journal API =====
    const JOURNAL_API = BASE_API + '/journal';
    let currentUserId = null;

    function getUserId() {
        if (currentUserId) return currentUserId;
        const profile = JSON.parse(localStorage.getItem('aha-bingo-profile') || 'null');
        if (profile) {
            currentUserId = profile.email;
            return currentUserId;
        }
        currentUserId = 'anonymous-' + Math.random().toString(36).slice(2, 8);
        return currentUserId;
    }

    function loadJournal() {
        // Load from localStorage first (fast)
        try {
            const saved = localStorage.getItem('aha-bingo-journal');
            if (saved) journalNotes = JSON.parse(saved);
        } catch(e) {}
        // Then sync from API (background)
        syncFromApi();
    }

    async function syncFromApi() {
        try {
            const uid = getUserId();
            const res = await fetch(`${JOURNAL_API}?userId=${encodeURIComponent(uid)}`);
            if (res.ok) {
                const data = await res.json();
                if (data.entries && data.entries.length > 0) {
                    data.entries.forEach(e => {
                        journalNotes[e.ahaText] = { note: e.note, track: e.track, timestamp: e.timestamp, day: e.day || inferDayFromTimestamp(e.timestamp) };
                    });
                    saveJournalLocal();
                }
            }
        } catch(e) { console.log('API sync failed, using localStorage', e); }
    }

    function saveJournalLocal() {
        localStorage.setItem('aha-bingo-journal', JSON.stringify(journalNotes));
    }

    async function saveJournalToApi(ahaText, note, track, day) {
        try {
            const uid = getUserId();
            await fetch(JOURNAL_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: uid, ahaText, note, track, day: day || activeDay, timestamp: new Date().toISOString() })
            });
        } catch(e) { console.log('API save failed, saved locally', e); }
    }

    async function deleteFromApi(ahaText) {
        try {
            const uid = getUserId();
            await fetch(`${JOURNAL_API}?userId=${encodeURIComponent(uid)}&ahaText=${encodeURIComponent(ahaText)}`, { method: 'DELETE' });
        } catch(e) { console.log('API delete failed', e); }
    }

    function getJournalMultiplier(charCount) {
        if (charCount >= 200) return 5;
        if (charCount >= 100) return 3;
        if (charCount >= 50) return 2;
        return 1;
    }

    function saveCurrentNote() {
        if (currentInsightIndex < 0) return;
        const item = currentCard[currentInsightIndex];
        if (!item || item.isFree) return;

        // Try side panel textarea first, fall back to overlay textarea
        const sideTA = document.getElementById('sideTextarea');
        const overlayTA = document.getElementById('journalTextarea');
        const sideOpen = document.getElementById('sidePanel').classList.contains('show');
        const textarea = sideOpen ? sideTA : overlayTA;
        if (!textarea) return;
        const note = textarea.value.trim();

        // Determine which saved element to use
        const savedEl = sideOpen ? document.getElementById('sideSaved') : document.getElementById('journalSaved');
        const hintEl = sideOpen ? document.getElementById('sideBonusHint') : document.getElementById('journalBonusHint');

        if (note) {
            const isNew = !journalNotes[item.aha]?.note;
            journalNotes[item.aha] = { note, track: item.track, timestamp: new Date().toISOString(), day: activeDay };
            if (savedEl) {
                savedEl.classList.add('show');
                setTimeout(() => savedEl.classList.remove('show'), 3000);
            }
            // Award bonus tokens for new journal entry with multiplier
            if (isNew) {
                const multiplier = getJournalMultiplier(note.length);
                const baseBonus = TOKEN_VALUES.journal();
                const bonus = baseBonus * multiplier;
                addTokens(bonus);
                if (savedEl) savedEl.textContent = `\u2713 Saved! +${bonus.toLocaleString()} tokens (${multiplier}x multiplier!)`;
                if (hintEl) hintEl.style.display = 'none';
            }
            saveJournalToApi(item.aha, note, item.track, activeDay);
        } else {
            delete journalNotes[item.aha];
            deleteFromApi(item.aha);
        }
        saveJournalLocal();
    }

    function formatTime(ts) {
        if (!ts) return '';
        try {
            const d = new Date(ts);
            return d.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
        } catch(e) { return ''; }
    }

    function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

    function viewJournal() {
        const container = document.getElementById('journalEntries');
        const statsEl = document.getElementById('journalStats');
        const entries = Object.entries(journalNotes);

        // Stats
        const ahaCount = entries.length;
        const reflections = entries.filter(([, d]) => d.note && d.note.length > 0).length;
        const bingoCount = celebratedLines.size;
        statsEl.innerHTML = `
            <div class="journal-stat"><div class="journal-stat-value">${ahaCount}</div><div class="journal-stat-label">Aha Moments</div></div>
            <div class="journal-stat"><div class="journal-stat-value">${reflections}</div><div class="journal-stat-label">Reflections</div></div>
            <div class="journal-stat"><div class="journal-stat-value">${totalTokens.toLocaleString()}</div><div class="journal-stat-label">Tokens</div></div>
            <div class="journal-stat"><div class="journal-stat-value">${bingoCount}</div><div class="journal-stat-label">Bingos</div></div>
        `;

        if (entries.length === 0) {
            container.innerHTML = '<div class="journal-empty">No notes yet. Click the \u24D8 on any cell and write your thoughts!</div>';
        } else {
            // Group by day
            const byDay = { 1: [], 2: [], 3: [], 4: [] };
            entries.forEach(([aha, data]) => {
                const day = data.day || inferDayFromTimestamp(data.timestamp);
                if (!byDay[day]) byDay[day] = [];
                byDay[day].push([aha, data]);
            });

            // Sort each day by timestamp
            for (const d of [1,2,3,4]) {
                byDay[d].sort((a, b) => (a[1].timestamp || '').localeCompare(b[1].timestamp || ''));
            }

            let html = '';
            for (const d of [1,2,3,4]) {
                if (byDay[d].length === 0) continue;
                html += `<div class="journal-day-section">
                    <div class="journal-day-header">Day ${d}</div>`;
                html += byDay[d].map(([aha, data]) => {
                    const color = TRACK_COLORS[data.track] || TRACK_COLORS.general;
                    const label = TRACK_LABELS[data.track] || 'General';
                    const textColor = data.track === 'product' ? '#fff' : '#0B2340';
                    const time = formatTime(data.timestamp);
                    const safeAha = escapeHtml(aha);
                    const safeNote = escapeHtml(data.note);
                    return `<div class="journal-entry" data-aha="${safeAha}">
                        <div class="journal-entry-header">
                            <span class="journal-entry-track" style="background:${color};color:${textColor}">${label}</span>
                            <div class="journal-entry-aha">\u{1F4A1} ${safeAha}</div>
                            <span class="journal-entry-time">${time}</span>
                        </div>
                        <div class="journal-entry-note" id="je-note-${safeAha.replace(/[^a-zA-Z0-9]/g,'_')}">${safeNote}</div>
                        <div class="journal-entry-actions">
                            <button class="je-edit" onclick="editJournalEntry(this)" title="Edit">&#x270F;&#xFE0F; Edit</button>
                            <button class="je-share" onclick="shareJournalEntry('${safeAha.replace(/'/g,"\\'")}')" title="Share">&#x1F4E4; Share</button>
                            <button class="je-delete" onclick="deleteJournalEntry('${safeAha.replace(/'/g,"\\'")}')" title="Delete">&#x1F5D1; Delete</button>
                        </div>
                    </div>`;
                }).join('');
                html += '</div>';
            }
            container.innerHTML = html;
        }

        document.getElementById('journalOverlay').classList.add('show');
    }

    function editJournalEntry(btn) {
        const entry = btn.closest('.journal-entry');
        const aha = entry.dataset.aha;
        const noteEl = entry.querySelector('.journal-entry-note');
        const currentNote = journalNotes[aha]?.note || '';

        // Replace note with textarea
        const ta = document.createElement('textarea');
        ta.className = 'journal-entry-edit';
        ta.value = currentNote;
        noteEl.replaceWith(ta);
        ta.focus();

        // Save on blur
        ta.addEventListener('blur', () => {
            const newNote = ta.value.trim();
            if (newNote && journalNotes[aha]) {
                journalNotes[aha].note = newNote;
                saveJournalLocal();
                saveJournalToApi(aha, newNote, journalNotes[aha].track, journalNotes[aha].day);
            }
            // Replace textarea with note div
            const div = document.createElement('div');
            div.className = 'journal-entry-note';
            div.textContent = newNote || currentNote;
            ta.replaceWith(div);
        });
    }

    function deleteJournalEntry(aha) {
        if (!confirm('Delete this aha moment from your journal?')) return;
        delete journalNotes[aha];
        saveJournalLocal();
        deleteFromApi(aha);
        viewJournal(); // Re-render
    }

    function shareJournalEntry(aha) {
        const data = journalNotes[aha];
        if (!data) return;
        const text = `\u{1F4A1} Aha Moment: ${aha}\n\n${data.note}\n\n#AhaMomentBingo #DenverAccelerator`;

        if (navigator.share) {
            navigator.share({ title: 'Aha Moment', text }).catch(() => {});
        } else {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            });
        }
    }

    function exportJournal() {
        const entries = Object.entries(journalNotes);
        if (entries.length === 0) { showToast('No entries to export'); return; }

        const profile = JSON.parse(localStorage.getItem('aha-bingo-profile') || '{}');
        const diag = JSON.parse(localStorage.getItem('aha-bingo-diagnostic') || '{}');
        let md = `# \u{1F4A1} My Aha Moment Journal\n`;
        md += `**${profile.name || 'Participant'}** | ${profile.vbu || ''}${diag.role ? ' | ' + diag.role : ''}\n`;
        md += `CSI Revenue Signals Accelerator \u2014 Denver, CO\n\n`;

        const byDay = { 1: [], 2: [], 3: [], 4: [] };
        entries.forEach(([aha, data]) => {
            const day = data.day || inferDayFromTimestamp(data.timestamp);
            if (!byDay[day]) byDay[day] = [];
            byDay[day].push([aha, data]);
        });

        for (const d of [1,2,3,4]) {
            if (byDay[d].length === 0) continue;
            byDay[d].sort((a, b) => (a[1].timestamp || '').localeCompare(b[1].timestamp || ''));
            md += `## Day ${d}\n\n`;
            byDay[d].forEach(([aha, data]) => {
                const time = formatTime(data.timestamp);
                md += `### \u{1F4A1} ${aha}\n`;
                if (time) md += `*${time}* | ${TRACK_LABELS[data.track] || 'General'}\n\n`;
                md += `${data.note}\n\n`;
            });
        }

        md += `---\n*Exported from Aha Moment Bingo | ${new Date().toLocaleDateString()}*\n`;

        navigator.clipboard.writeText(md).then(() => {
            showToast('Journal copied to clipboard as Markdown!');
        }).catch(() => {
            showToast('Export failed');
        });
    }

    function closeJournal() {
        document.getElementById('journalOverlay').classList.remove('show');
    }

    document.getElementById('journalOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeJournal();
    });

    // Auto-save journal on textarea input
    document.getElementById('journalTextarea').addEventListener('input', debounce(saveCurrentNote, 500));

    function debounce(fn, ms) {
        let timer;
        return function(...args) {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), ms);
        };
    }

    // ===== Initialize =====
    function init() {
        const profile = JSON.parse(localStorage.getItem('aha-bingo-profile') || 'null');
        const diagnostic = JSON.parse(localStorage.getItem('aha-bingo-diagnostic') || 'null');

        // If localStorage has both, skip the wizard entirely
        if (profile && diagnostic) {
            finishOnboarding(profile, diagnostic);
            return;
        }

        // Otherwise show the wizard (Step 0 = email entry)
        showWelcome();
    }

    // ===== Preferences =====
    function loadPreferences() {
        const savedTheme = localStorage.getItem('aha-bingo-theme');
        if (savedTheme === 'dark') {
            isDarkMode = true;
            document.getElementById('themeToggle').checked = true;
        } else if (savedTheme === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                isDarkMode = true;
                document.getElementById('themeToggle').checked = true;
            }
        }

        const savedMute = localStorage.getItem('aha-bingo-muted');
        if (savedMute === 'true') isMuted = true;
    }

    function saveTheme() {
        localStorage.setItem('aha-bingo-theme', isDarkMode ? 'dark' : 'light');
    }

    // ===== Theme Toggle =====
    document.getElementById('themeToggle').addEventListener('change', function() {
        isDarkMode = this.checked;
        saveTheme();
        applyTheme();
    });

    function applyTheme() {
        document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : '');
    }

    // ===== Day Selection =====
    function selectDay(day) {
        // Reject locked days
        const eventDay = getCurrentEventDay();
        if (eventDay > 0 && day > eventDay) return;

        // Save current day's marked cells
        markedByDay[activeDay] = new Set(markedCells);
        saveMarkedByDay();

        activeDay = day;
        localStorage.setItem('aha-bingo-activeDay', day);

        // Load new day's marked cells
        markedCells = new Set(markedByDay[day]);

        document.querySelectorAll('.day-dot').forEach(d => {
            const dayNum = parseInt(d.dataset.day);
            d.classList.toggle('active', dayNum === day);
        });

        // Re-render grid with new day's state
        bingoDetected = false;
        celebratedLines = new Set();
        renderGrid();
        updateScore();
        checkBingo();
        updateAllDayProgress();
    }

    // ===== Day Progress Bars =====
    function updateAllDayProgress() {
        document.querySelectorAll('.day-dot').forEach(dot => {
            const d = parseInt(dot.dataset.day);
            const marked = markedByDay[d] ? markedByDay[d].size : 1;
            // 25 cells total, free space always marked
            const pct = Math.round((marked / 25) * 100);
            dot.style.setProperty('--day-progress', pct);
        });
    }

    // ===== Track Filter =====
    function setTrackFilter(track) {
        activeTrack = track;
        document.querySelectorAll('.track-btn').forEach(b => {
            b.classList.toggle('active', b.dataset.track === track);
        });
        generateNewCard();
    }

    // ===== Card Generation =====
    function generateNewCard() {
        let pool = [...AHA_POOL];

        // Filter by track if not "all"
        if (activeTrack !== 'all') {
            const trackItems = pool.filter(i => i.track === activeTrack);
            const generalItems = pool.filter(i => i.track === 'general');
            // Mix: mostly track-specific, fill with general
            pool = [...trackItems, ...generalItems];
        }

        // Shuffle and pick 24
        const shuffled = pool.sort(() => Math.random() - 0.5);
        const selected = shuffled.slice(0, 24);

        // Insert free space at index 12
        selected.splice(12, 0, {
            aha: "FREE\nAHA\nMOMENT!",
            insight: "This one's free\u2014because showing up to the accelerator is already an aha moment. Now go collect the rest!",
            insightSource: "Denver Accelerator \u2014 You're here!",
            track: "free",
            isFree: true
        });

        currentCard = selected;
        // Use per-day marked cells (don't reset if already loaded)
        if (markedByDay[activeDay].size === 0) {
            markedByDay[activeDay] = new Set([12]);
        }
        markedCells = new Set(markedByDay[activeDay]);
        bingoDetected = false;

        // Generate card seed
        cardSeed = Math.floor(Math.random() * 9000) + 1000;
        document.getElementById('cardId').textContent = `Card #${cardSeed}`;

        renderGrid();
        updateScore();
    }

    function renderGrid() {
        const grid = document.getElementById('bingoGrid');
        grid.innerHTML = '';

        currentCard.forEach((item, index) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.setAttribute('role', 'gridcell');
            cell.setAttribute('tabindex', '0');
            cell.setAttribute('aria-label', item.isFree ? 'Free space, auto-marked' : item.aha);
            cell.setAttribute('aria-pressed', markedCells.has(index) ? 'true' : 'false');
            if (item.isFree) cell.classList.add('free-space');
            if (markedCells.has(index)) cell.classList.add('marked');

            // Track color dot
            if (!item.isFree) {
                const trackDot = document.createElement('span');
                trackDot.className = 'track-dot';
                trackDot.style.background = TRACK_COLORS[item.track] || TRACK_COLORS.general;
                trackDot.title = TRACK_LABELS[item.track] || 'General';
                cell.appendChild(trackDot);
            }

            const ahaSpan = document.createElement('span');
            ahaSpan.className = 'aha-text';
            ahaSpan.textContent = item.aha;

            const bulbSpan = document.createElement('span');
            bulbSpan.className = 'bulb-icon';
            bulbSpan.textContent = '\u{1F4A1}';

            cell.appendChild(ahaSpan);
            cell.appendChild(bulbSpan);

            // Info button (not on free space)
            if (!item.isFree) {
                const infoBtn = document.createElement('button');
                infoBtn.className = 'info-btn';
                infoBtn.setAttribute('aria-label', 'Show insight for: ' + item.aha);
                infoBtn.setAttribute('tabindex', '0');
                infoBtn.textContent = 'i';
                infoBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showInsight(index);
                });
                cell.appendChild(infoBtn);
            }

            cell.dataset.index = index;

            // Click = mark/unmark
            cell.addEventListener('click', () => handleCellClick(index));

            // Keyboard: Enter/Space to mark, i to show info
            cell.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleCellClick(index);
                } else if (e.key === 'i' || e.key === 'I') {
                    e.preventDefault();
                    showInsight(index);
                }
            });

            grid.appendChild(cell);
        });
    }

    // ===== Cell Interaction =====
    function handleCellClick(index) {

        const item = currentCard[index];
        if (item.isFree) return;

        const cell = document.querySelector(`.cell[data-index="${index}"]`);

        if (markedCells.has(index)) {
            // Already marked - unmark it
            markedCells.delete(index);
            markedByDay[activeDay] = new Set(markedCells);
            saveMarkedByDay();
            cell.classList.remove('marked');
            cell.setAttribute('aria-pressed', 'false');
            // Remove tokens
            if (cellTokens[index]) {
                totalTokens -= cellTokens[index];
                delete cellTokens[index];
            }
            playUnmarkSound();
            updateScore();
            checkBingo();
            updateAllDayProgress();
        } else {
            // Mark the cell
            markedCells.add(index);
            markedByDay[activeDay] = new Set(markedCells);
            saveMarkedByDay();
            cell.classList.add('marked');
            cell.setAttribute('aria-pressed', 'true');
            cell.classList.remove('stamp-animate');
            void cell.offsetWidth;
            cell.classList.add('stamp-animate');
            playStampSound();

            // Award tokens for marking
            const markTokens = TOKEN_VALUES.mark();
            cellTokens[index] = markTokens;
            addTokens(markTokens);

            // Expand into journal/insight view after a brief delay
            setTimeout(() => expandCell(index), 400);

            checkBingo();
            updateAllDayProgress();
        }
    }

    // ===== Side Panel Expansion =====
    let activeCellIndex = -1;

    function expandCell(index) {
        currentInsightIndex = index;
        const item = currentCard[index];
        const panel = document.getElementById('sidePanel');

        // Highlight the clicked cell, unhighlight previous
        if (activeCellIndex >= 0) {
            const prevCell = document.querySelector(`.cell[data-index="${activeCellIndex}"]`);
            if (prevCell) prevCell.style.boxShadow = '';
        }
        activeCellIndex = index;
        const cell = document.querySelector(`.cell[data-index="${index}"]`);
        const trackColor = TRACK_COLORS[item.track] || TRACK_COLORS.general;
        cell.style.boxShadow = `0 0 0 3px ${trackColor}, 0 0 16px ${trackColor}40`;

        // Populate the side panel
        const badge = document.getElementById('sideBadge');
        const trackLabel = TRACK_LABELS[item.track] || 'General';
        badge.textContent = trackLabel;
        badge.style.background = trackColor;
        badge.style.color = item.track === 'product' ? '#fff' : '#0B2340';

        document.getElementById('sideAha').textContent = '\u{1F4A1} ' + item.aha;
        document.getElementById('sideInsight').textContent = item.insight;
        document.getElementById('sideSource').textContent = item.insightSource || '';

        const hasPriorNote = !!journalNotes[item.aha]?.note;
        const bonusHint = document.getElementById('sideBonusHint');
        bonusHint.style.display = hasPriorNote ? 'none' : 'block';

        const textarea = document.getElementById('sideTextarea');
        textarea.value = journalNotes[item.aha]?.note || '';
        updateCharCount(textarea.value.length);

        const savedEl = document.getElementById('sideSaved');
        savedEl.classList.remove('show');

        // Show side panel and widen container
        if (!panel.classList.contains('show')) {
            panel.classList.add('show');
            document.querySelector('.container').classList.add('panel-open');
        }

        setTimeout(() => textarea.focus(), 300);
    }

    function closeSidePanel(save) {
        if (save) saveCurrentNote();
        const panel = document.getElementById('sidePanel');
        panel.classList.remove('show');
        document.querySelector('.container').classList.remove('panel-open');

        // Remove cell highlight
        if (activeCellIndex >= 0) {
            const cell = document.querySelector(`.cell[data-index="${activeCellIndex}"]`);
            if (cell) cell.style.boxShadow = '';
            activeCellIndex = -1;
        }
        if (save) currentInsightIndex = -1;
    }

    // Alias for backward compat
    function closeGridExpansion(save) { closeSidePanel(save); }

    // Wire up side panel buttons
    document.getElementById('sidePanelClose').addEventListener('click', () => closeSidePanel(true));
    document.getElementById('sideGotit').addEventListener('click', () => closeSidePanel(true));

    function shareSidePanelAha() {
        if (currentInsightIndex < 0) return;
        const item = currentCard[currentInsightIndex];
        if (!item) return;
        const note = journalNotes[item.aha]?.note || '';
        let text = `\u{1F4A1} Aha Moment: ${item.aha}`;
        if (note) text += `\n\n${note}`;
        text += `\n\n#AhaMomentBingo #DenverAccelerator`;

        if (navigator.share) {
            navigator.share({ title: 'Aha Moment', text }).catch(() => {});
        } else {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            });
        }
    }

    const debouncedSideSave = debounce(saveCurrentNote, 500);

    document.getElementById('sideTextarea').addEventListener('input', function() {
        updateCharCount(this.value.length);
        debouncedSideSave();
    });

    // Character count and multiplier display
    function updateCharCount(len) {
        const el = document.getElementById('sideCharCount');
        if (!el) return;
        let multiplierLabel = '1x';
        let cls = '';
        if (len >= 200) { multiplierLabel = '5x'; cls = 'multiplier-5x'; }
        else if (len >= 100) { multiplierLabel = '3x'; cls = 'multiplier-3x'; }
        else if (len >= 50) { multiplierLabel = '2x'; cls = 'multiplier-2x'; }
        el.textContent = `${len} chars \u2014 ${multiplierLabel} bonus multiplier${len < 50 ? ' (write 50+ for 2x!)' : len < 100 ? ' (write 100+ for 3x!)' : len < 200 ? ' (write 200+ for 5x!)' : ' \u2014 maximum multiplier!'}`;
        el.className = 'journal-char-count ' + cls;
    }

    // ===== Token Score =====
    // Each marked cell = random token cost (like real AI agent work)
    // Journal entries = bonus tokens (reflection multiplier)
    const TOKEN_VALUES = {
        mark: () => Math.floor(Math.random() * 800) + 200,     // 200-1000 tokens per aha
        journal: () => Math.floor(Math.random() * 2000) + 1000, // 1000-3000 bonus for journaling
        bingo: 10000,                                            // 10k bonus for a bingo line
        free: 500                                                // free space
    };
    let totalTokens = parseInt(localStorage.getItem('aha-bingo-totalTokens')) || 500;
    let cellTokens = {}; // track tokens per cell index

    function updateScore() {
        document.getElementById('scoreDisplay').textContent = totalTokens.toLocaleString();
        localStorage.setItem('aha-bingo-totalTokens', totalTokens);
    }

    function addTokens(amount) {
        totalTokens += amount;
        updateScore();
        // Animate the counter
        const el = document.getElementById('scoreDisplay');
        el.style.transform = 'scale(1.3)';
        el.style.color = '#BFD731';
        setTimeout(() => { el.style.transform = 'scale(1)'; el.style.color = ''; }, 300);
    }

    // ===== Insight Modal (via info button) =====
    function showInsight(index) {
        currentInsightIndex = index;
        const item = currentCard[index];

        // Set track badge
        const badge = document.getElementById('insightTrackBadge');
        badge.textContent = TRACK_LABELS[item.track] || 'General';
        badge.style.background = TRACK_COLORS[item.track] || TRACK_COLORS.general;
        badge.style.color = item.track === 'product' ? '#ffffff' : '#0B2340';

        document.getElementById('insightAha').textContent = '\u{1F4A1} ' + item.aha;
        document.getElementById('insightText').textContent = item.insight;
        document.getElementById('insightSource').textContent = item.insightSource || '';

        // Show/hide bonus hint
        const bonusEl = document.getElementById('journalBonusHint');
        if (bonusEl) bonusEl.style.display = journalNotes[item.aha]?.note ? 'none' : 'block';

        // Load existing journal note
        const textarea = document.getElementById('journalTextarea');
        const existing = journalNotes[item.aha];
        textarea.value = existing ? existing.note : '';
        document.getElementById('journalSaved').classList.remove('show');
        document.getElementById('journalSaved').textContent = '\u2713 Saved & bonus tokens earned!';

        document.getElementById('insightOverlay').classList.add('show');
        setTimeout(() => textarea.focus(), 300);
    }

    function closeInsight() {
        saveCurrentNote();
        currentInsightIndex = -1;
        document.getElementById('insightOverlay').classList.remove('show');
    }

    // Close on overlay click
    document.getElementById('insightOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeInsight();
    });

    // Close on Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeInsight();
            closeGridExpansion(true);
            closeBingo();
            closeJournal();
        }
    });

    // ===== Reset =====
    function resetMarks() {
        markedCells = new Set([12]);
        markedByDay[activeDay] = new Set([12]);
        saveMarkedByDay();
        bingoDetected = false;
        celebratedLines = new Set();
        currentInsightIndex = -1;
        closeGridExpansion(false);
        document.querySelectorAll('.cell').forEach(cell => {
            const idx = parseInt(cell.dataset.index);
            cell.classList.toggle('marked', idx === 12);
            cell.classList.remove('bingo-cell');
        });
        updateScore();
        updateAllDayProgress();
    }

    // ===== Win Detection =====
    function checkBingo() {
        const lines = [
            [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
            [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
            [0,6,12,18,24], [4,8,12,16,20]
        ];

        for (let li = 0; li < lines.length; li++) {
            const line = lines[li];
            if (celebratedLines.has(li)) continue; // already celebrated this line
            if (line.every(i => markedCells.has(i))) {
                celebratedLines.add(li);
                bingoDetected = true; // at least one bingo found
                line.forEach(i => {
                    const cell = document.querySelector(`.cell[data-index="${i}"]`);
                    if (cell) cell.classList.add('bingo-cell');
                });
                const bingoCount = celebratedLines.size;
                showBingoCelebration(bingoCount);
                return; // celebrate one at a time
            }
        }
    }

    // ===== BINGO Celebration =====
    function showBingoCelebration(bingoCount) {
        addTokens(TOKEN_VALUES.bingo);
        if (bingoCount === 1) {
            document.getElementById('bingoTitle').innerHTML = '\u{1F4A1} BREAKTHROUGH! \u{1F4A1}';
            document.getElementById('bingoSubtitle').textContent = "5 aha moments in a row! +10,000 bonus tokens. Keep going \u2014 collect them all!";
        } else {
            document.getElementById('bingoTitle').innerHTML = '\u{1F4A1} BINGO x' + bingoCount + '! \u{1F4A1}';
            document.getElementById('bingoSubtitle').textContent = `Another 5 in a row! +10,000 bonus tokens. That's ${bingoCount} breakthroughs and counting!`;
        }
        document.getElementById('bingoOverlay').classList.add('show');
        playBingoSound();
        launchConfetti();
    }

    function closeBingo() {
        document.getElementById('bingoOverlay').classList.remove('show');
    }

    // ===== Confetti =====
    function launchConfetti() {
        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Lightbulb-themed colors
        const colors = ['#BFD731', '#F59E0B', '#008AB0', '#FFD700', '#ffffff', '#FCD34D'];
        const particles = [];

        for (let i = 0; i < 150; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                w: Math.random() * 8 + 4,
                h: Math.random() * 4 + 2,
                color: colors[Math.floor(Math.random() * colors.length)],
                vx: (Math.random() - 0.5) * 4,
                vy: Math.random() * 3 + 2,
                rotation: Math.random() * 360,
                rotSpeed: (Math.random() - 0.5) * 10
            });
        }

        let frame = 0;
        const maxFrames = 180;

        function animate() {
            if (frame > maxFrames) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate((p.rotation * Math.PI) / 180);
                ctx.fillStyle = p.color;
                ctx.globalAlpha = Math.max(0, 1 - frame / maxFrames);
                ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                ctx.restore();
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.05;
                p.rotation += p.rotSpeed;
            });
            frame++;
            requestAnimationFrame(animate);
        }

        animate();
    }

    // ===== Share Card =====
    async function shareCard() {
        try {
            const canvas = document.createElement('canvas');
            const scale = 2;
            const cellSize = 100;
            const gap = 6;
            const padding = 24;
            const headerHeight = 70;
            const gridSize = cellSize * 5 + gap * 4;
            const totalW = gridSize + padding * 2;
            const totalH = gridSize + padding * 2 + headerHeight;

            canvas.width = totalW * scale;
            canvas.height = totalH * scale;
            const ctx = canvas.getContext('2d');
            ctx.scale(scale, scale);

            // Background
            ctx.fillStyle = isDarkMode ? '#1a2744' : '#ffffff';
            ctx.beginPath();
            ctx.roundRect(0, 0, totalW, totalH, 16);
            ctx.fill();

            // Header
            ctx.fillStyle = isDarkMode ? '#FAF9F6' : '#0B2340';
            ctx.font = 'bold 16px Barlow, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('\u{1F4A1} Aha Moment Bingo', totalW / 2, 26);
            ctx.fillStyle = '#008AB0';
            ctx.font = '10px Barlow, sans-serif';
            ctx.fillText('CSI Revenue Signals \u2022 Denver Accelerator', totalW / 2, 42);
            ctx.font = '11px Barlow, sans-serif';
            ctx.fillText(`Card #${cardSeed}  \u2022  ${markedCells.size}/25 lightbulbs`, totalW / 2, 58);

            // Draw cells
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const idx = row * 5 + col;
                    const item = currentCard[idx];
                    const x = padding + col * (cellSize + gap);
                    const y = headerHeight + padding + row * (cellSize + gap);
                    const isMarked = markedCells.has(idx);

                    // Cell background
                    if (item.isFree || isMarked) {
                        ctx.fillStyle = isDarkMode ? '#4a6b0a' : '#BFD731';
                    } else {
                        ctx.fillStyle = isDarkMode ? '#1e2d4a' : '#ffffff';
                    }
                    ctx.beginPath();
                    ctx.roundRect(x, y, cellSize, cellSize, 6);
                    ctx.fill();

                    // Cell border
                    ctx.strokeStyle = isMarked || item.isFree
                        ? (isDarkMode ? '#4a6b0a' : '#BFD731')
                        : (isDarkMode ? '#2a3f66' : '#0B2340');
                    ctx.lineWidth = 1.5;
                    ctx.stroke();

                    // Track dot
                    if (!item.isFree) {
                        ctx.fillStyle = TRACK_COLORS[item.track] || TRACK_COLORS.general;
                        ctx.beginPath();
                        ctx.arc(x + 7, y + 7, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // Lightbulb for marked cells
                    if (isMarked && !item.isFree) {
                        ctx.font = '20px sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('\u{1F4A1}', x + cellSize - 12, y + 16);
                    }

                    // Text
                    ctx.fillStyle = isMarked || item.isFree
                        ? (isDarkMode ? '#FAF9F6' : '#0B2340')
                        : (isDarkMode ? '#FAF9F6' : '#0B2340');
                    ctx.font = item.isFree ? 'bold 11px Barlow, sans-serif' : '9px Barlow, sans-serif';
                    ctx.textAlign = 'center';
                    wrapText(ctx, item.aha, x + cellSize / 2, y + (item.isFree ? 46 : 38), cellSize - 14, 11);
                }
            }

            // Footer
            ctx.fillStyle = isDarkMode ? '#6b7280' : '#9ca3af';
            ctx.font = '9px Barlow, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Volaris Business Transformation \u2022 Progress Over Perfection', totalW / 2, totalH - 6);

            // Copy to clipboard
            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
            if (navigator.clipboard && window.ClipboardItem) {
                await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                showToast('Copied to clipboard!');
            } else {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `aha-bingo-${cardSeed}.png`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('Image downloaded!');
            }
        } catch (err) {
            console.error('Share failed:', err);
            showToast('Could not share card');
        }
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let lines = [];

        for (const word of words) {
            const test = line + (line ? ' ' : '') + word;
            if (ctx.measureText(test).width > maxWidth && line) {
                lines.push(line);
                line = word;
            } else {
                line = test;
            }
        }
        lines.push(line);

        const startY = y - ((lines.length - 1) * lineHeight) / 2;
        lines.forEach((l, i) => {
            ctx.fillText(l, x, startY + i * lineHeight);
        });
    }

    // ===== Toast =====
    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // ===== Dev: Ctrl+Shift+. cycles Landingâ†’D1â†’D2â†’D3â†’D4â†’Landing =====
    let _devStage = 0; // 0=landing, 1-4=days
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.shiftKey && e.code === 'Period') {
            getCurrentEventDay = () => 4;
            _devStage = (_devStage % 5) + 1; // 1â†’2â†’3â†’4â†’5â†’1â€¦
            if (_devStage === 5) {
                _devStage = 0;
                updateDayTabs();
                document.getElementById('landingOverlay').classList.add('show');
            } else {
                document.getElementById('landingOverlay').classList.remove('show');
                updateDayTabs();
                selectDay(_devStage);
            }
        }
    });

    // ===== Start =====
    init();
    </script>
</body>
</html>
